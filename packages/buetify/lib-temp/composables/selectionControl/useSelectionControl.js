import { computed, toRef } from 'vue';
import { isEnterEvent, isSpaceEvent } from '../../utils/eventHelpers';
import { toggleListItem } from '../../utils/helpers';
import { useDisable, UseDisablePropsDefinition } from '../disable';
import { useFocus, UseFocusPropsDefinition } from '../focus';
import { useLabelId, UseLabelIdPropsDefinition } from '../labelId';
import { getUseModelPropsDefinition, useModel } from '../model';
import { getEqPropsDefinition } from '../shared';
export function getUseSelectablePropsDefinition() {
    return {
        trueValue: {
            type: null,
            default: true
        },
        falseValue: {
            type: null,
            default: false
        },
        indeterminateValue: {
            type: null
        },
        isMultiple: {
            type: Boolean,
            default: false
        },
        variant: {
            type: String,
            default: 'is-primary'
        },
        size: {
            type: String,
            default: ''
        },
        isRequired: {
            type: Boolean,
            default: false
        },
        ...getEqPropsDefinition(),
        ...getUseModelPropsDefinition(),
        ...UseDisablePropsDefinition,
        ...UseLabelIdPropsDefinition,
        ...UseFocusPropsDefinition
    };
}
function getIsActive(value, trueValue, isMultiple, eq) {
    if (isMultiple) {
        if (!Array.isArray(value))
            return false;
        return trueValue !== undefined && value.some(item => eq.equals(item, trueValue));
    }
    if (!Array.isArray(value) && trueValue !== undefined) {
        return value !== undefined && eq.equals(value, trueValue);
    }
    return false;
}
function getOnChange(value, trueValue, falseValue, isDisabled, isMultiple, eq) {
    return function onChange() {
        if (isDisabled.value)
            return;
        if (trueValue.value === undefined)
            return;
        const currentValue = value.value;
        const tValue = trueValue.value;
        if (isMultiple.value) {
            if (!Array.isArray(currentValue)) {
                value.value = [];
            }
            else {
                value.value = toggleListItem(eq.value)(tValue, currentValue);
            }
        }
        else if (!Array.isArray(currentValue)) {
            if (currentValue === undefined || (currentValue !== undefined && !eq.value.equals(currentValue, tValue))) {
                value.value = trueValue.value;
            }
            else {
                value.value = falseValue.value;
            }
        }
    };
}
function getInputAttrs(role, type, id, labelId, isActive, isDisabled, isReadonly, isRequired, value, trueValue, falseValue) {
    return {
        role,
        type,
        id,
        value,
        checked: isActive,
        'aria-checked': isActive,
        'aria-disabled': isDisabled,
        'aria-labelledby': labelId,
        tabindex: -1,
        readonly: isReadonly,
        disabled: isDisabled,
        required: isRequired,
        'true-value': JSON.stringify(trueValue),
        'false-value': JSON.stringify(falseValue)
    };
}
export function useSelectionControl(props, ref, role, type) {
    const { modelValue } = useModel(props);
    const focus = useFocus(props, ref);
    const label = useLabelId(props, role);
    const isMultiple = computed(() => props.isMultiple || Array.isArray(modelValue.value));
    const isActive = computed(() => getIsActive(modelValue.value, props.trueValue, isMultiple.value, props.eq));
    const isDisabled = useDisable(props);
    const onChange = getOnChange(modelValue, toRef(props, 'trueValue'), toRef(props, 'falseValue'), isDisabled, isMultiple, toRef(props, 'eq'));
    const attrs = computed(() => getInputAttrs(role, type, label.id.value, label.labelId.value, isActive.value, isDisabled.value, props.isReadonly, props.isRequired, modelValue.value, props.trueValue, props.falseValue));
    function onKeydown(e) {
        if (isEnterEvent(e) || isSpaceEvent(e)) {
            onChange();
        }
    }
    function onClick(e) {
        e.preventDefault();
        e.stopPropagation();
        onChange();
    }
    return {
        modelValue,
        ...focus,
        isDisabled,
        isMultiple,
        isActive,
        attrs,
        onChange,
        onKeydown,
        onClick,
        label
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlU2VsZWN0aW9uQ29udHJvbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb3NhYmxlcy9zZWxlY3Rpb25Db250cm9sL3VzZVNlbGVjdGlvbkNvbnRyb2wudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFpQixRQUFRLEVBQUUsS0FBSyxFQUFFLE1BQU0sS0FBSyxDQUFDO0FBR3JELE9BQU8sRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDdEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxVQUFVLEVBQW1CLHlCQUF5QixFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ3BGLE9BQU8sRUFBRSxRQUFRLEVBQWlCLHVCQUF1QixFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQzVFLE9BQU8sRUFBRSxVQUFVLEVBQW1CLHlCQUF5QixFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ3BGLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxRQUFRLEVBQWlCLE1BQU0sVUFBVSxDQUFDO0FBQy9FLE9BQU8sRUFBVyxvQkFBb0IsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUUxRCxNQUFNLFVBQVUsK0JBQStCO0lBQzdDLE9BQU87UUFDTCxTQUFTLEVBQUU7WUFDVCxJQUFJLEVBQUcsSUFBK0I7WUFDdEMsT0FBTyxFQUFHLElBQXFCO1NBQ2hDO1FBQ0QsVUFBVSxFQUFFO1lBQ1YsSUFBSSxFQUFHLElBQStCO1lBQ3RDLE9BQU8sRUFBRyxLQUFzQjtTQUNqQztRQUNELGtCQUFrQixFQUFFO1lBQ2xCLElBQUksRUFBRyxJQUErQjtTQUN2QztRQUNELFVBQVUsRUFBRTtZQUNWLElBQUksRUFBRSxPQUE0QjtZQUNsQyxPQUFPLEVBQUUsS0FBSztTQUNmO1FBQ0QsT0FBTyxFQUFFO1lBQ1AsSUFBSSxFQUFFLE1BQWdDO1lBQ3RDLE9BQU8sRUFBRSxZQUE0QjtTQUN0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QUVGLE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxHQUFHLEVBQUUsQ0FDMUIsYUFBYSxDQUNYLElBQUksRUFDSixJQUFJLEVBQ0osS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQ2QsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQ25CLFFBQVEsQ0FBQyxLQUFLLEVBQ2QsVUFBVSxDQUFDLEtBQUssRUFDaEIsS0FBSyxDQUFDLFVBQVUsRUFDaEIsS0FBSyxDQUFDLFVBQVUsRUFDaEIsVUFBVSxDQUFDLEtBQUssRUFDaEIsS0FBSyxDQUFDLFNBQVMsRUFDZixLQUFLLENBQUMsVUFBVSxDQUNqQixDQUNGLENBQUM7SUFFRixTQUFTLFNBQVMsQ0FBQyxDQUFnQjtRQUNqQyxJQUFJLFlBQVksQ0FBQyxDQUFDLENBQUMsSUFBSSxZQUFZLENBQUMsQ0FBQyxDQUFDLEVBQUU7WUFDdEMsUUFBUSxFQUFFLENBQUM7U0FDWjtJQUNILENBQUM7SUFFRCxTQUFTLE9BQU8sQ0FBQyxDQUFhO1FBQzVCLENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUNuQixDQUFDLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDcEIsUUFBUSxFQUFFLENBQUM7SUFDYixDQUFDO0lBRUQsT0FBTztRQUNMLFVBQVU7UUFDVixHQUFHLEtBQUs7UUFDUixVQUFVO1FBQ1YsVUFBVTtRQUNWLFFBQVE7UUFDUixLQUFLO1FBQ0wsUUFBUTtRQUNSLFNBQVM7UUFDVCxPQUFPO1FBQ1AsS0FBSztLQUNOLENBQUM7QUFDSixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXEgfSBmcm9tICdmcC10cy9saWIvRXEnO1xuaW1wb3J0IHsgUHJvcFR5cGUsIFJlZiwgY29tcHV0ZWQsIHRvUmVmIH0gZnJvbSAndnVlJztcbmltcG9ydCB7IENvbG9yVmFyaWFudCB9IGZyb20gJy4uLy4uL3R5cGVzL0NvbG9yVmFyaWFudHMnO1xuaW1wb3J0IHsgU2l6ZVZhcmlhbnQgfSBmcm9tICcuLi8uLi90eXBlcy9TaXplVmFyaWFudHMnO1xuaW1wb3J0IHsgaXNFbnRlckV2ZW50LCBpc1NwYWNlRXZlbnQgfSBmcm9tICcuLi8uLi91dGlscy9ldmVudEhlbHBlcnMnO1xuaW1wb3J0IHsgdG9nZ2xlTGlzdEl0ZW0gfSBmcm9tICcuLi8uLi91dGlscy9oZWxwZXJzJztcbmltcG9ydCB7IHVzZURpc2FibGUsIFVzZURpc2FibGVQcm9wcywgVXNlRGlzYWJsZVByb3BzRGVmaW5pdGlvbiB9IGZyb20gJy4uL2Rpc2FibGUnO1xuaW1wb3J0IHsgdXNlRm9jdXMsIFVzZUZvY3VzUHJvcHMsIFVzZUZvY3VzUHJvcHNEZWZpbml0aW9uIH0gZnJvbSAnLi4vZm9jdXMnO1xuaW1wb3J0IHsgdXNlTGFiZWxJZCwgVXNlTGFiZWxJZFByb3BzLCBVc2VMYWJlbElkUHJvcHNEZWZpbml0aW9uIH0gZnJvbSAnLi4vbGFiZWxJZCc7XG5pbXBvcnQgeyBnZXRVc2VNb2RlbFByb3BzRGVmaW5pdGlvbiwgdXNlTW9kZWwsIFVzZU1vZGVsUHJvcHMgfSBmcm9tICcuLi9tb2RlbCc7XG5pbXBvcnQgeyBFcVByb3BzLCBnZXRFcVByb3BzRGVmaW5pdGlvbiB9IGZyb20gJy4uL3NoYXJlZCc7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRVc2VTZWxlY3RhYmxlUHJvcHNEZWZpbml0aW9uPFQ+KCkge1xuICByZXR1cm4ge1xuICAgIHRydWVWYWx1ZToge1xuICAgICAgdHlwZTogKG51bGwgYXMgdW5rbm93bikgYXMgUHJvcFR5cGU8VD4sXG4gICAgICBkZWZhdWx0OiAodHJ1ZSBhcyB1bmtub3duKSBhcyBUXG4gICAgfSxcbiAgICBmYWxzZVZhbHVlOiB7XG4gICAgICB0eXBlOiAobnVsbCBhcyB1bmtub3duKSBhcyBQcm9wVHlwZTxUPixcbiAgICAgIGRlZmF1bHQ6IChmYWxzZSBhcyB1bmtub3duKSBhcyBUXG4gICAgfSxcbiAgICBpbmRldGVybWluYXRlVmFsdWU6IHtcbiAgICAgIHR5cGU6IChudWxsIGFzIHVua25vd24pIGFzIFByb3BUeXBlPFQ+XG4gICAgfSxcbiAgICBpc011bHRpcGxlOiB7XG4gICAgICB0eXBlOiBCb29sZWFuIGFzIFByb3BUeXBlPGJvb2xlYW4+LFxuICAgICAgZGVmYXVsdDogZmFsc2VcbiAgICB9LFxuICAgIHZhcmlhbnQ6IHtcbiAgICAgIHR5cGU6IFN0cmluZyBhcyBQcm9wVHlwZTxDb2xvclZhcmlhbnQ+LFxuICAgICAgZGVmYXVsdDogJ2lzLXByaW1hcnknIGFzIENvbG9yVmFyaWFudFxuICAgIH0sXG4gICAgc2l6ZToge1xuICAgICAgdHlwZTogU3RyaW5nIGFzIFByb3BUeXBlPFNpemVWYXJpYW50PixcbiAgICAgIGRlZmF1bHQ6ICcnIGFzIFNpemVWYXJpYW50XG4gICAgfSxcbiAgICBpc1JlcXVpcmVkOiB7XG4gICAgICB0eXBlOiBCb29sZWFuIGFzIFByb3BUeXBlPGJvb2xlYW4+LFxuICAgICAgZGVmYXVsdDogZmFsc2VcbiAgICB9LFxuICAgIC4uLmdldEVxUHJvcHNEZWZpbml0aW9uPFQ+KCksXG4gICAgLi4uZ2V0VXNlTW9kZWxQcm9wc0RlZmluaXRpb248VD4oKSxcbiAgICAuLi5Vc2VEaXNhYmxlUHJvcHNEZWZpbml0aW9uLFxuICAgIC4uLlVzZUxhYmVsSWRQcm9wc0RlZmluaXRpb24sXG4gICAgLi4uVXNlRm9jdXNQcm9wc0RlZmluaXRpb25cbiAgfTtcbn1cblxuZXhwb3J0IHR5cGUgVXNlU2VsZWN0YWJsZVByb3BzPFQ+ID0ge1xuICB0cnVlVmFsdWU6IFQ7XG4gIGZhbHNlVmFsdWU6IFQ7XG4gIGluZGV0ZXJtaW5hdGVWYWx1ZT86IFQ7XG4gIGlzTXVsdGlwbGU6IGJvb2xlYW47XG4gIHZhcmlhbnQ6IENvbG9yVmFyaWFudDtcbiAgc2l6ZTogU2l6ZVZhcmlhbnQ7XG4gIGlzUmVxdWlyZWQ6IGJvb2xlYW47XG59ICYgRXFQcm9wczxUPiAmXG4gIFVzZU1vZGVsUHJvcHM8VD4gJlxuICBVc2VEaXNhYmxlUHJvcHMgJlxuICBVc2VMYWJlbElkUHJvcHM7XG5cbmZ1bmN0aW9uIGdldElzQWN0aXZlPFQ+KHZhbHVlOiBUIHwgVFtdIHwgdW5kZWZpbmVkLCB0cnVlVmFsdWU6IFQgfCB1bmRlZmluZWQsIGlzTXVsdGlwbGU6IGJvb2xlYW4sIGVxOiBFcTxUPik6IGJvb2xlYW4ge1xuICBpZiAoaXNNdWx0aXBsZSkge1xuICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gdHJ1ZVZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUuc29tZShpdGVtID0+IGVxLmVxdWFscyhpdGVtLCB0cnVlVmFsdWUpKTtcbiAgfVxuICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpICYmIHRydWVWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIHZhbHVlICE9PSB1bmRlZmluZWQgJiYgZXEuZXF1YWxzKHZhbHVlLCB0cnVlVmFsdWUpO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gZ2V0T25DaGFuZ2U8VD4oXG4gIHZhbHVlOiBSZWY8VCB8IFRbXSB8IHVuZGVmaW5lZD4sXG4gIHRydWVWYWx1ZTogUmVmPFQgfCB1bmRlZmluZWQ+LFxuICBmYWxzZVZhbHVlOiBSZWY8VCB8IHVuZGVmaW5lZD4sXG4gIGlzRGlzYWJsZWQ6IFJlZjxib29sZWFuPixcbiAgaXNNdWx0aXBsZTogUmVmPGJvb2xlYW4+LFxuICBlcTogUmVmPEVxPFQ+PlxuKSB7XG4gIHJldHVybiBmdW5jdGlvbiBvbkNoYW5nZSgpIHtcbiAgICBpZiAoaXNEaXNhYmxlZC52YWx1ZSkgcmV0dXJuO1xuICAgIGlmICh0cnVlVmFsdWUudmFsdWUgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xuICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IHZhbHVlLnZhbHVlO1xuICAgIGNvbnN0IHRWYWx1ZSA9IHRydWVWYWx1ZS52YWx1ZTtcblxuICAgIGlmIChpc011bHRpcGxlLnZhbHVlKSB7XG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkoY3VycmVudFZhbHVlKSkge1xuICAgICAgICB2YWx1ZS52YWx1ZSA9IFtdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWUudmFsdWUgPSB0b2dnbGVMaXN0SXRlbShlcS52YWx1ZSkodFZhbHVlLCBjdXJyZW50VmFsdWUpIGFzIFRbXTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCFBcnJheS5pc0FycmF5KGN1cnJlbnRWYWx1ZSkpIHtcbiAgICAgIGlmIChjdXJyZW50VmFsdWUgPT09IHVuZGVmaW5lZCB8fCAoY3VycmVudFZhbHVlICE9PSB1bmRlZmluZWQgJiYgIWVxLnZhbHVlLmVxdWFscyhjdXJyZW50VmFsdWUsIHRWYWx1ZSkpKSB7XG4gICAgICAgIHZhbHVlLnZhbHVlID0gdHJ1ZVZhbHVlLnZhbHVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWUudmFsdWUgPSBmYWxzZVZhbHVlLnZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbn1cblxuZnVuY3Rpb24gZ2V0SW5wdXRBdHRyczxUPihcbiAgcm9sZTogc3RyaW5nLFxuICB0eXBlOiBzdHJpbmcsXG4gIGlkOiBzdHJpbmcsXG4gIGxhYmVsSWQ6IHN0cmluZyxcbiAgaXNBY3RpdmU6IGJvb2xlYW4sXG4gIGlzRGlzYWJsZWQ6IGJvb2xlYW4sXG4gIGlzUmVhZG9ubHk6IGJvb2xlYW4sXG4gIGlzUmVxdWlyZWQ6IGJvb2xlYW4sXG4gIHZhbHVlOiBULFxuICB0cnVlVmFsdWU6IFQsXG4gIGZhbHNlVmFsdWU6IFRcbikge1xuICByZXR1cm4ge1xuICAgIHJvbGUsXG4gICAgdHlwZSxcbiAgICBpZCxcbiAgICB2YWx1ZSxcbiAgICBjaGVja2VkOiBpc0FjdGl2ZSxcbiAgICAnYXJpYS1jaGVja2VkJzogaXNBY3RpdmUsXG4gICAgJ2FyaWEtZGlzYWJsZWQnOiBpc0Rpc2FibGVkLFxuICAgICdhcmlhLWxhYmVsbGVkYnknOiBsYWJlbElkLFxuICAgIHRhYmluZGV4OiAtMSxcbiAgICByZWFkb25seTogaXNSZWFkb25seSxcbiAgICBkaXNhYmxlZDogaXNEaXNhYmxlZCxcbiAgICByZXF1aXJlZDogaXNSZXF1aXJlZCxcbiAgICAndHJ1ZS12YWx1ZSc6IEpTT04uc3RyaW5naWZ5KHRydWVWYWx1ZSksXG4gICAgJ2ZhbHNlLXZhbHVlJzogSlNPTi5zdHJpbmdpZnkoZmFsc2VWYWx1ZSlcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVzZVNlbGVjdGlvbkNvbnRyb2w8VD4oXG4gIHByb3BzOiBVc2VTZWxlY3RhYmxlUHJvcHM8VD4sXG4gIHJlZjogUmVmPEhUTUxFbGVtZW50PixcbiAgcm9sZTogc3RyaW5nLFxuICB0eXBlOiBzdHJpbmdcbikge1xuICBjb25zdCB7IG1vZGVsVmFsdWUgfSA9IHVzZU1vZGVsPFQ+KHByb3BzKTtcbiAgY29uc3QgZm9jdXMgPSB1c2VGb2N1cygocHJvcHMgYXMgdW5rbm93bikgYXMgVXNlRm9jdXNQcm9wcywgcmVmKTtcbiAgY29uc3QgbGFiZWwgPSB1c2VMYWJlbElkKHByb3BzLCByb2xlKTtcbiAgY29uc3QgaXNNdWx0aXBsZSA9IGNvbXB1dGVkKCgpID0+IHByb3BzLmlzTXVsdGlwbGUgfHwgQXJyYXkuaXNBcnJheShtb2RlbFZhbHVlLnZhbHVlKSk7XG4gIGNvbnN0IGlzQWN0aXZlID0gY29tcHV0ZWQoKCkgPT4gZ2V0SXNBY3RpdmUobW9kZWxWYWx1ZS52YWx1ZSwgcHJvcHMudHJ1ZVZhbHVlLCBpc011bHRpcGxlLnZhbHVlLCBwcm9wcy5lcSkpO1xuICBjb25zdCBpc0Rpc2FibGVkID0gdXNlRGlzYWJsZShwcm9wcyk7XG5cbiAgY29uc3Qgb25DaGFuZ2UgPSBnZXRPbkNoYW5nZShcbiAgICBtb2RlbFZhbHVlLFxuICAgIHRvUmVmKHByb3BzLCAndHJ1ZVZhbHVlJyksXG4gICAgdG9SZWYocHJvcHMsICdmYWxzZVZhbHVlJyksXG4gICAgaXNEaXNhYmxlZCxcbiAgICBpc011bHRpcGxlLFxuICAgIHRvUmVmKHByb3BzLCAnZXEnKVxuICApO1xuXG4gIGNvbnN0IGF0dHJzID0gY29tcHV0ZWQoKCkgPT5cbiAgICBnZXRJbnB1dEF0dHJzKFxuICAgICAgcm9sZSxcbiAgICAgIHR5cGUsXG4gICAgICBsYWJlbC5pZC52YWx1ZSxcbiAgICAgIGxhYmVsLmxhYmVsSWQudmFsdWUsXG4gICAgICBpc0FjdGl2ZS52YWx1ZSxcbiAgICAgIGlzRGlzYWJsZWQudmFsdWUsXG4gICAgICBwcm9wcy5pc1JlYWRvbmx5LFxuICAgICAgcHJvcHMuaXNSZXF1aXJlZCxcbiAgICAgIG1vZGVsVmFsdWUudmFsdWUsXG4gICAgICBwcm9wcy50cnVlVmFsdWUsXG4gICAgICBwcm9wcy5mYWxzZVZhbHVlXG4gICAgKVxuICApO1xuXG4gIGZ1bmN0aW9uIG9uS2V5ZG93bihlOiBLZXlib2FyZEV2ZW50KSB7XG4gICAgaWYgKGlzRW50ZXJFdmVudChlKSB8fCBpc1NwYWNlRXZlbnQoZSkpIHtcbiAgICAgIG9uQ2hhbmdlKCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gb25DbGljayhlOiBNb3VzZUV2ZW50KSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgb25DaGFuZ2UoKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgbW9kZWxWYWx1ZSxcbiAgICAuLi5mb2N1cyxcbiAgICBpc0Rpc2FibGVkLFxuICAgIGlzTXVsdGlwbGUsXG4gICAgaXNBY3RpdmUsXG4gICAgYXR0cnMsXG4gICAgb25DaGFuZ2UsXG4gICAgb25LZXlkb3duLFxuICAgIG9uQ2xpY2ssXG4gICAgbGFiZWxcbiAgfTtcbn1cblxuZXhwb3J0IHR5cGUgU2VsZWN0aW9uQ29udHJvbCA9IFJldHVyblR5cGU8dHlwZW9mIHVzZVNlbGVjdGlvbkNvbnRyb2w+O1xuIl19
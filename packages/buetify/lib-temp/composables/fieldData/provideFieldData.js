import { constVoid, not } from 'fp-ts/lib/function';
import { provide, shallowRef, computed, watch, toRef } from 'vue';
import { isEmptyString, isString } from '../../utils/helpers';
import { useLabelId, UseLabelIdPropsDefinition } from '../labelId';
export const PROVIDE_FIELD_DATA_INJECTION_SYMBOL = Symbol('use-field-data');
export const ProvideFieldDataPropsDefinition = {
    ...UseLabelIdPropsDefinition,
    variant: {
        type: [String, Object],
        required: false
    },
    message: {
        type: [String, Array, Object],
        required: false
    },
    isExpanded: {
        type: Boolean,
        default: false
    }
};
export function formatMessage(message) {
    if (isString(message)) {
        return message;
    }
    else {
        const messages = [];
        if (Array.isArray(message)) {
            message.forEach(m => {
                if (isString(m)) {
                    messages.push(m);
                }
                else {
                    for (const key in m) {
                        if (m[key]) {
                            messages.push(key);
                        }
                    }
                }
            });
        }
        else {
            for (const key in message) {
                if (message[key]) {
                    messages.push(key);
                }
            }
        }
        return messages.filter(not(isEmptyString)).join(' <br> ');
    }
}
export const DEFAULT_FIELD_DATA_INJECTION = {
    attrs: {
        label: shallowRef(''),
        isFullwidth: shallowRef(false),
        isExpanded: shallowRef(false),
        message: shallowRef(''),
        messageVariant: shallowRef(),
        id: shallowRef(),
        labelId: shallowRef()
    },
    setters: {
        onNewMessage: constVoid,
        onNewVariant: constVoid
    }
};
export function provideFieldData(props) {
    const label = useLabelId(props, 'field');
    const variant = shallowRef(props.variant);
    watch(toRef(props, 'variant'), newVariant => {
        variant.value = newVariant;
    });
    const message = shallowRef(props.message);
    watch(toRef(props, 'message'), newMessage => {
        message.value = newMessage;
    });
    const formattedMessage = computed(() => formatMessage(message.value));
    const isExpanded = toRef(props, 'isExpanded');
    const attrs = {
        label: toRef(props, 'label'),
        isFullwidth: isExpanded,
        isExpanded: isExpanded,
        message: formattedMessage,
        messageVariant: variant,
        id: label.id,
        labelId: label.labelId
    };
    const setters = {
        onNewMessage: (newMessage) => {
            message.value = newMessage;
        },
        onNewVariant: (newVariant) => {
            variant.value = newVariant;
        }
    };
    const injection = {
        attrs,
        setters
    };
    provide(PROVIDE_FIELD_DATA_INJECTION_SYMBOL, injection);
    return injection;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvdmlkZUZpZWxkRGF0YS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb3NhYmxlcy9maWVsZERhdGEvcHJvdmlkZUZpZWxkRGF0YS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFhLEdBQUcsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQy9ELE9BQU8sRUFBOEIsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBTyxNQUFNLEtBQUssQ0FBQztBQUVuRyxPQUFPLEVBQUUsYUFBYSxFQUFFLFFBQVEsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzlELE9BQU8sRUFBRSxVQUFVLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFFbkUsTUFBTSxDQUFDLE1BQU0sbUNBQW1DLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUM7QUFFNUUsTUFBTSxDQUFDLE1BQU0sK0JBQStCLEdBQUc7SUFDN0MsR0FBRyx5QkFBeUI7SUFDNUIsT0FBTyxFQUFFO1FBQ1AsSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBK0I7UUFDcEQsUUFBUSxFQUFFLEtBQUs7S0FDaEI7SUFDRCxPQUFPLEVBQUU7UUFDUCxJQUFJLEVBQUUsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FFM0I7UUFDRCxRQUFRLEVBQUUsS0FBSztLQUNoQjtJQUNELFVBQVUsRUFBRTtRQUNWLElBQUksRUFBRSxPQUE0QjtRQUNsQyxPQUFPLEVBQUUsS0FBSztLQUNmO0NBQ0YsQ0FBQztBQUlGLE1BQU0sVUFBVSxhQUFhLENBQzNCLE9BQWlHO0lBRWpHLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ3JCLE9BQU8sT0FBTyxDQUFDO0tBQ2hCO1NBQU07UUFDTCxNQUFNLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFDcEIsSUFBSSxLQUFLLENBQUMs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LENBQUM7UUFDN0IsQ0FBQztRQUNELFlBQVksRUFBRSxDQUFDLFVBQTRCLEVBQUUsRUFBRTtZQUM3QyxPQUFPLENBQUMsS0FBSyxHQUFHLFVBQVUsQ0FBQztRQUM3QixDQUFDO0tBQ0YsQ0FBQztJQUVGLE1BQU0sU0FBUyxHQUF1QjtRQUNwQyxLQUFLO1FBQ0wsT0FBTztLQUNSLENBQUM7SUFFRixPQUFPLENBQUMsbUNBQW1DLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFFeEQsT0FBTyxTQUFTLENBQUM7QUFDbkIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNvbnN0Vm9pZCwgRnVuY3Rpb25OLCBub3QgfSBmcm9tICdmcC10cy9saWIvZnVuY3Rpb24nO1xuaW1wb3J0IHsgUHJvcFR5cGUsIEV4dHJhY3RQcm9wVHlwZXMsIHByb3ZpZGUsIHNoYWxsb3dSZWYsIGNvbXB1dGVkLCB3YXRjaCwgdG9SZWYsIFJlZiB9IGZyb20gJ3Z1ZSc7XG5pbXBvcnQgeyBBbGxDb2xvcnNWYXJpYW50IH0gZnJvbSAnLi4vLi4vdHlwZXMvQ29sb3JWYXJpYW50cyc7XG5pbXBvcnQgeyBpc0VtcHR5U3RyaW5nLCBpc1N0cmluZyB9IGZyb20gJy4uLy4uL3V0aWxzL2hlbHBlcnMnO1xuaW1wb3J0IHsgdXNlTGFiZWxJZCwgVXNlTGFiZWxJZFByb3BzRGVmaW5pdGlvbiB9IGZyb20gJy4uL2xhYmVsSWQnO1xuXG5leHBvcnQgY29uc3QgUFJPVklERV9GSUVMRF9EQVRBX0lOSkVDVElPTl9TWU1CT0wgPSBTeW1ib2woJ3VzZS1maWVsZC1kYXRhJyk7XG5cbmV4cG9ydCBjb25zdCBQcm92aWRlRmllbGREYXRhUHJvcHNEZWZpbml0aW9uID0ge1xuICAuLi5Vc2VMYWJlbElkUHJvcHNEZWZpbml0aW9uLFxuICB2YXJpYW50OiB7XG4gICAgdHlwZTogW1N0cmluZywgT2JqZWN0XSBhcyBQcm9wVHlwZTxBbGxDb2xvcnNWYXJpYW50PixcbiAgICByZXF1aXJlZDogZmFsc2VcbiAgfSxcbiAgbWVzc2FnZToge1xuICAgIHR5cGU6IFtTdHJpbmcsIEFycmF5LCBPYmplY3RdIGFzIFByb3BUeXBlPFxuICAgICAgc3RyaW5nIHwgeyBbSzogc3RyaW5nXTogYm9vbGVhbiB9IHwgQXJyYXk8c3RyaW5nIHwgeyBbSzogc3RyaW5nXTogYm9vbGVhbiB9PlxuICAgID4sXG4gICAgcmVxdWlyZWQ6IGZhbHNlXG4gIH0sXG4gIGlzRXhwYW5kZWQ6IHtcbiAgICB0eXBlOiBCb29sZWFuIGFzIFByb3BUeXBlPGJvb2xlYW4+LFxuICAgIGRlZmF1bHQ6IGZhbHNlXG4gIH1cbn07XG5cbmV4cG9ydCB0eXBlIFByb3ZpZGVGaWVsZERhdGFQcm9wcyA9IEV4dHJhY3RQcm9wVHlwZXM8dHlwZW9mIFByb3ZpZGVGaWVsZERhdGFQcm9wc0RlZmluaXRpb24+O1xuXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0TWVzc2FnZShcbiAgbWVzc2FnZTogc3RyaW5nIHwgeyBbSzogc3RyaW5nXTogYm9vbGVhbiB9IHwgQXJyYXk8c3RyaW5nIHwgeyBbSzogc3RyaW5nXTogYm9vbGVhbiB9PiB8IHVuZGVmaW5lZFxuKTogc3RyaW5nIHtcbiAgaWYgKGlzU3RyaW5nKG1lc3NhZ2UpKSB7XG4gICAgcmV0dXJuIG1lc3NhZ2U7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgbWVzc2FnZXMgPSBbXTtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShtZXNzYWdlKSkge1xuICAgICAgbWVzc2FnZS5mb3JFYWNoKG0gPT4ge1xuICAgICAgICBpZiAoaXNTdHJpbmcobSkpIHtcbiAgICAgICAgICBtZXNzYWdlcy5wdXNoKG0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIG0pIHtcbiAgICAgICAgICAgIGlmIChtW2tleV0pIHtcbiAgICAgICAgICAgICAgbWVzc2FnZXMucHVzaChrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAoY29uc3Qga2V5IGluIG1lc3NhZ2UpIHtcbiAgICAgICAgaWYgKG1lc3NhZ2Vba2V5XSkge1xuICAgICAgICAgIG1lc3NhZ2VzLnB1c2goa2V5KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbWVzc2FnZXMuZmlsdGVyKG5vdChpc0VtcHR5U3RyaW5nKSkuam9pbignIDxicj4gJyk7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBGaWVsZERhdGFBdHRycyB7XG4gIGxhYmVsOiBSZWY8c3RyaW5nPjtcbiAgaXNGdWxsd2lkdGg6IFJlZjxib29sZWFuPjtcbiAgaXNFeHBhbmRlZDogUmVmPGJvb2xlYW4+O1xuICBtZXNzYWdlOiBSZWY8c3RyaW5nPjtcbiAgbWVzc2FnZVZhcmlhbnQ6IFJlZjx1bmRlZmluZWQgfCBBbGxDb2xvcnNWYXJpYW50PjtcbiAgaWQ6IFJlZjxzdHJpbmcgfCB1bmRlZmluZWQ+O1xuICBsYWJlbElkOiBSZWY8c3RyaW5nIHwgdW5kZWZpbmVkPjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBGaWVsZERhdGFMaXN0ZW5lcnMge1xuICBvbk5ld01lc3NhZ2U6IEZ1bmN0aW9uTjxbc3RyaW5nIHwgeyBbSzogc3RyaW5nXTogYm9vbGVhbiB9IHwgQXJyYXk8c3RyaW5nIHwgeyBbSzogc3RyaW5nXTogYm9vbGVhbiB9Pl0sIHZvaWQ+O1xuICBvbk5ld1ZhcmlhbnQ6IEZ1bmN0aW9uTjxbQWxsQ29sb3JzVmFyaWFudF0sIHZvaWQ+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpZWxkRGF0YUluamVjdGlvbiB7XG4gIGF0dHJzOiBGaWVsZERhdGFBdHRycztcbiAgc2V0dGVyczogRmllbGREYXRhTGlzdGVuZXJzO1xufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9GSUVMRF9EQVRBX0lOSkVDVElPTjogRmllbGREYXRhSW5qZWN0aW9uID0ge1xuICBhdHRyczoge1xuICAgIGxhYmVsOiBzaGFsbG93UmVmKCcnKSxcbiAgICBpc0Z1bGx3aWR0aDogc2hhbGxvd1JlZihmYWxzZSksXG4gICAgaXNFeHBhbmRlZDogc2hhbGxvd1JlZihmYWxzZSksXG4gICAgbWVzc2FnZTogc2hhbGxvd1JlZignJyksXG4gICAgbWVzc2FnZVZhcmlhbnQ6IHNoYWxsb3dSZWYoKSxcbiAgICBpZDogc2hhbGxvd1JlZigpLFxuICAgIGxhYmVsSWQ6IHNoYWxsb3dSZWYoKVxuICB9LFxuICBzZXR0ZXJzOiB7XG4gICAgb25OZXdNZXNzYWdlOiBjb25zdFZvaWQsXG4gICAgb25OZXdWYXJpYW50OiBjb25zdFZvaWRcbiAgfVxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIHByb3ZpZGVGaWVsZERhdGEocHJvcHM6IFByb3ZpZGVGaWVsZERhdGFQcm9wcykge1xuICBjb25zdCBsYWJlbCA9IHVzZUxhYmVsSWQocHJvcHMsICdmaWVsZCcpO1xuICBjb25zdCB2YXJpYW50ID0gc2hhbGxvd1JlZihwcm9wcy52YXJpYW50KTtcbiAgd2F0Y2godG9SZWYocHJvcHMsICd2YXJpYW50JyksIG5ld1ZhcmlhbnQgPT4ge1xuICAgIHZhcmlhbnQudmFsdWUgPSBuZXdWYXJpYW50O1xuICB9KTtcbiAgY29uc3QgbWVzc2FnZSA9IHNoYWxsb3dSZWYocHJvcHMubWVzc2FnZSk7XG4gIHdhdGNoKHRvUmVmKHByb3BzLCAnbWVzc2FnZScpLCBuZXdNZXNzYWdlID0+IHtcbiAgICBtZXNzYWdlLnZhbHVlID0gbmV3TWVzc2FnZTtcbiAgfSk7XG4gIGNvbnN0IGZvcm1hdHRlZE1lc3NhZ2UgPSBjb21wdXRlZCgoKSA9PiBmb3JtYXRNZXNzYWdlKG1lc3NhZ2UudmFsdWUpKTtcblxuICBjb25zdCBpc0V4cGFuZGVkID0gdG9SZWYocHJvcHMsICdpc0V4cGFuZGVkJyk7XG5cbiAgY29uc3QgYXR0cnMgPSB7XG4gICAgbGFiZWw6IHRvUmVmKHByb3BzLCAnbGFiZWwnKSxcbiAgICBpc0Z1bGx3aWR0aDogaXNFeHBhbmRlZCxcbiAgICBpc0V4cGFuZGVkOiBpc0V4cGFuZGVkLFxuICAgIG1lc3NhZ2U6IGZvcm1hdHRlZE1lc3NhZ2UsXG4gICAgbWVzc2FnZVZhcmlhbnQ6IHZhcmlhbnQsXG4gICAgaWQ6IGxhYmVsLmlkLFxuICAgIGxhYmVsSWQ6IGxhYmVsLmxhYmVsSWRcbiAgfTtcblxuICBjb25zdCBzZXR0ZXJzID0ge1xuICAgIG9uTmV3TWVzc2FnZTogKG5ld01lc3NhZ2U6IHN0cmluZyB8IHsgW0s6IHN0cmluZ106IGJvb2xlYW4gfSB8IEFycmF5PHN0cmluZyB8IHsgW0s6IHN0cmluZ106IGJvb2xlYW4gfT4pID0+IHtcbiAgICAgIG1lc3NhZ2UudmFsdWUgPSBuZXdNZXNzYWdlO1xuICAgIH0sXG4gICAgb25OZXdWYXJpYW50OiAobmV3VmFyaWFudDogQWxsQ29sb3JzVmFyaWFudCkgPT4ge1xuICAgICAgdmFyaWFudC52YWx1ZSA9IG5ld1ZhcmlhbnQ7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGluamVjdGlvbjogRmllbGREYXRhSW5qZWN0aW9uID0ge1xuICAgIGF0dHJzLFxuICAgIHNldHRlcnNcbiAgfTtcblxuICBwcm92aWRlKFBST1ZJREVfRklFTERfREFUQV9JTkpFQ1RJT05fU1lNQk9MLCBpbmplY3Rpb24pO1xuXG4gIHJldHVybiBpbmplY3Rpb247XG59XG4iXX0=
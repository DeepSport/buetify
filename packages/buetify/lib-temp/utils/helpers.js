import { Fragment } from 'vue';
import { snoc, unsafeDeleteAt } from 'fp-ts/lib/Array';
import { constant, not } from 'fp-ts/lib/function';
import { none } from 'fp-ts/lib/Option';
/**
 * Mobile detection
 * https://www.abeautifulsite.net/detecting-mobile-devices-with-javascript
 */
export const isMobile = {
    Android: function () {
        return typeof window !== 'undefined' && window.navigator.userAgent.match(/Android/i);
    },
    BlackBerry: function () {
        return typeof window !== 'undefined' && window.navigator.userAgent.match(/BlackBerry/i);
    },
    iOS: function () {
        return typeof window !== 'undefined' && window.navigator.userAgent.match(/iPhone|iPad|iPod/i);
    },
    Opera: function () {
        return typeof window !== 'undefined' && window.navigator.userAgent.match(/Opera Mini/i);
    },
    Windows: function () {
        return typeof window !== 'undefined' && window.navigator.userAgent.match(/IEMobile/i);
    },
    any: function () {
        return isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows();
    }
};
export function capitalizeFirstLetter(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
}
export function keys(o) {
    return Object.keys(o);
}
// eslint-disable-next-line
export function deepEqual(a, b) {
    if (a === b)
        return true;
    if (a instanceof Date && b instanceof Date) {
        // If the values are Date, they were convert to timestamp with getTime and compare it
        if (a.getTime() !== b.getTime())
            return false;
    }
    if (a !== Object(a) || b !== Object(b)) {
        // If the values aren't objects, they were already checked for equality
        return false;
    }
    const props = Object.keys(a);
    if (props.length !== Object.keys(b).length) {
        // Different number of props, don't bother to check
        return false;
    }
    return props.every(p => deepEqual(a[p], b[p]));
}
// eslint-disable-next-line
export function getNestedValue(obj, path, fallback) {
    const last = path.length - 1;
    if (last < 0)
        return obj === undefined ? fallback : obj;
    for (let i = 0; i < last; i++) {
        if (obj == null) {
            return fallback;
        }
        obj = obj[path[i]];
    }
    if (obj == null)
        return fallback;
    return obj[path[last]] === undefined ? fallback : obj[path[last]];
}
// eslint-disable-next-line
export function getObjectValueByPath(obj, path, fallback) {
    // credit: http://stackoverflow.com/questions/6491463/accessing-nested-javascript-objects-with-string-key#comment55278413_6491621
    if (obj == null || !path || typeof path !== 'string')
        return fallback;
    if (obj[path] !== undefined)
        return obj[path];
    path = path.replace(/\[(\w+)\]/g, '.$1'); // convert indexes to properties
    path = path.replace(/^\./, ''); // strip a leading dot
    return getNestedValue(obj, path.split('.'), fallback);
}
// eslint-disable-next-line
export function isBoolean(val) {
    return typeof val === 'boolean';
}
// eslint-disable-next-line
export function isObject(obj) {
    return obj !== null && typeof obj === 'object';
}
// eslint-disable-next-line
export function isFunction(obj) {
    return typeof obj === 'function';
}
// eslint-disable-next-line
export function isPrimitive(val) {
    return typeof val === 'number' || typeof val === 'string' || typeof val === 'boolean';
}
// eslint-disable-next-line
export function isNil(arg) {
    return arg === null || arg === undefined;
}
export const exists = not(isNil);
// eslint-disable-next-line
export function isString(arg) {
    return typeof arg === 'string';
}
// eslint-disable-next-line
export function isNumber(arg) {
    return typeof arg === 'number';
}
// eslint-disable-next-line
export function isHTMLElement(obj) {
    return typeof HTMLElement === 'object'
        ? obj instanceof HTMLElement //DOM2
        : obj && typeof isObject(obj) && obj.nodeType === 1 && typeof obj.nodeName === 'string';
}
export const constEmptyArray = constant([]);
export const constNone = constant(none);
export const constZero = constant(0);
export const constEmptyString = constant('');
export function removeListItem(E) {
    return (a, as) => {
        const index = as.findIndex(i => E.equals(a, i));
        return index > -1 ? unsafeDeleteAt(index, as) : as;
    };
}
export function toggleListItem(E) {
    return (a, as) => {
        const index = as.findIndex(i => E.equals(a, i));
        return index > -1 ? unsafeDeleteAt(index, as) : snoc(as, a);
    };
}
export function isFragment(node) {
    return node.type === Fragment;
    ;
}
export function isEmptyString(str) {
    return str === '';
}
function prop(key, obj) {
    return obj[key];
}
// eslint-disable-next-line
export function extractProp(extractor, item) {
    if (isFunction(extractor)) {
        return extractor(item);
    }
    else if (isObject(item) && isString(extractor) && Object.hasOwnProperty.call(item, extractor)) {
        // eslint-disable-next-line
        return prop(extractor, item);
    }
    else {
        return item;
    }
}
const camelizeRE = /-(\w)/g;
export function camelize(str) {
    return str.replace(camelizeRE, (_, c) => (c ? c.toUpperCase() : ''));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9oZWxwZXJzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBUyxRQUFRLEVBQUUsTUFBTSxLQUFLLENBQUM7QUFDdEMsT0FBTyxFQUFFLElBQUksRUFBRSxjQUFjLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUV2RCxPQUFPLEVBQUUsUUFBUSxFQUFFLEdBQUcsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUV4Qzs7O0dBR0c7QUFFSCxNQUFNLENBQUMsTUFBTSxRQUFRLEdBQUc7SUFDdEIsT0FBTyxFQUFFO1FBQ1AsT0FBTyxPQUFPLE1BQU0sS0FBSyxXQUFXLElBQUksTUFBTSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3ZGLENBQUM7SUFDRCxVQUFVLEVBQUU7UUFDVixPQUFPLE9BQU8sTUFBTSxLQUFLLFdBQVcsSUFBSSxNQUFNLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDMUYsQ0FBQztJQUNELEdBQUcsRUFBRTtRQUNILE9BQU8sT0FBTyxNQUFNLEtBQUssV0FBVyxJQUFJLE1BQU0sQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0lBQ2hHLENBQUM7SUFDRCxLQUFLLEVBQUU7UUFDTCxPQUFPLE9BQU8sTUFBTSxLQUFLLFdBQVcsSUFBSSxNQUFNLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDMUYsQ0FBQztJQUNELE9BQU8sRUFBRTtRQUNQLE9BQU8sT0FBTyxNQUFNLEtBQUssV0FBVyxJQUFJLE1BQU0sQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FB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QUMsSUFBSSxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsRUFBRTtRQUMvRiwyQkFBMkI7UUFDM0IsT0FBTyxJQUFJLENBQUMsU0FBZ0IsRUFBRSxJQUFJLENBQUMsQ0FBQztLQUNyQztTQUFNO1FBQ0wsT0FBTyxJQUFvQixDQUFDO0tBQzdCO0FBQ0gsQ0FBQztBQUVELE1BQU0sVUFBVSxHQUFHLFFBQVEsQ0FBQztBQUM1QixNQUFNLFVBQVUsUUFBUSxDQUFDLEdBQVc7SUFDbEMsT0FBTyxHQUFHLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDdkUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZOb2RlLCBGcmFnbWVudCB9IGZyb20gJ3Z1ZSc7XG5pbXBvcnQgeyBzbm9jLCB1bnNhZmVEZWxldGVBdCB9IGZyb20gJ2ZwLXRzL2xpYi9BcnJheSc7XG5pbXBvcnQgeyBFcSB9IGZyb20gJ2ZwLXRzL2xpYi9FcSc7XG5pbXBvcnQgeyBjb25zdGFudCwgbm90IH0gZnJvbSAnZnAtdHMvbGliL2Z1bmN0aW9uJztcbmltcG9ydCB7IG5vbmUgfSBmcm9tICdmcC10cy9saWIvT3B0aW9uJztcblxuLyoqXG4gKiBNb2JpbGUgZGV0ZWN0aW9uXG4gKiBodHRwczovL3d3dy5hYmVhdXRpZnVsc2l0ZS5uZXQvZGV0ZWN0aW5nLW1vYmlsZS1kZXZpY2VzLXdpdGgtamF2YXNjcmlwdFxuICovXG5cbmV4cG9ydCBjb25zdCBpc01vYmlsZSA9IHtcbiAgQW5kcm9pZDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9BbmRyb2lkL2kpO1xuICB9LFxuICBCbGFja0JlcnJ5OiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL0JsYWNrQmVycnkvaSk7XG4gIH0sXG4gIGlPUzogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9pUGhvbmV8aVBhZHxpUG9kL2kpO1xuICB9LFxuICBPcGVyYTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9PcGVyYSBNaW5pL2kpO1xuICB9LFxuICBXaW5kb3dzOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL0lFTW9iaWxlL2kpO1xuICB9LFxuICBhbnk6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBpc01vYmlsZS5BbmRyb2lkKCkgfHwgaXNNb2JpbGUuQmxhY2tCZXJyeSgpIHx8IGlzTW9iaWxlLmlPUygpIHx8IGlzTW9iaWxlLk9wZXJhKCkgfHwgaXNNb2JpbGUuV2luZG93cygpO1xuICB9XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gY2FwaXRhbGl6ZUZpcnN0TGV0dGVyKHN0cjogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIHN0ci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0ci5zbGljZSgxKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGtleXM8Tz4obzogTyk6IEFycmF5PGtleW9mIE8+IHtcbiAgcmV0dXJuIE9iamVjdC5rZXlzKG8pIGFzIChrZXlvZiBPKVtdO1xufVxuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbmV4cG9ydCBmdW5jdGlvbiBkZWVwRXF1YWwoYTogYW55LCBiOiBhbnkpOiBib29sZWFuIHtcbiAgaWYgKGEgPT09IGIpIHJldHVybiB0cnVlO1xuXG4gIGlmIChhIGluc3RhbmNlb2YgRGF0ZSAmJiBiIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgIC8vIElmIHRoZSB2YWx1ZXMgYXJlIERhdGUsIHRoZXkgd2VyZSBjb252ZXJ0IHRvIHRpbWVzdGFtcCB3aXRoIGdldFRpbWUgYW5kIGNvbXBhcmUgaXRcbiAgICBpZiAoYS5nZXRUaW1lKCkgIT09IGIuZ2V0VGltZSgpKSByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAoYSAhPT0gT2JqZWN0KGEpIHx8IGIgIT09IE9iamVjdChiKSkge1xuICAgIC8vIElmIHRoZSB2YWx1ZXMgYXJlbid0IG9iamVjdHMsIHRoZXkgd2VyZSBhbHJlYWR5IGNoZWNrZWQgZm9yIGVxdWFsaXR5XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY29uc3QgcHJvcHMgPSBPYmplY3Qua2V5cyhhKTtcblxuICBpZiAocHJvcHMubGVuZ3RoICE9PSBPYmplY3Qua2V5cyhiKS5sZW5ndGgpIHtcbiAgICAvLyBEaWZmZXJlbnQgbnVtYmVyIG9mIHByb3BzLCBkb24ndCBib3RoZXIgdG8gY2hlY2tcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICByZXR1cm4gcHJvcHMuZXZlcnkocCA9PiBkZWVwRXF1YWwoYVtwXSwgYltwXSkpO1xufVxuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbmV4cG9ydCBmdW5jdGlvbiBnZXROZXN0ZWRWYWx1ZShvYmo6IGFueSwgcGF0aDogKHN0cmluZyB8IG51bWJlcilbXSwgZmFsbGJhY2s/OiBhbnkpOiBhbnkge1xuICBjb25zdCBsYXN0ID0gcGF0aC5sZW5ndGggLSAxO1xuXG4gIGlmIChsYXN0IDwgMCkgcmV0dXJuIG9iaiA9PT0gdW5kZWZpbmVkID8gZmFsbGJhY2sgOiBvYmo7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsYXN0OyBpKyspIHtcbiAgICBpZiAob2JqID09IG51bGwpIHtcbiAgICAgIHJldHVybiBmYWxsYmFjaztcbiAgICB9XG4gICAgb2JqID0gb2JqW3BhdGhbaV1dO1xuICB9XG5cbiAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gZmFsbGJhY2s7XG5cbiAgcmV0dXJuIG9ialtwYXRoW2xhc3RdXSA9PT0gdW5kZWZpbmVkID8gZmFsbGJhY2sgOiBvYmpbcGF0aFtsYXN0XV07XG59XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuZXhwb3J0IGZ1bmN0aW9uIGdldE9iamVjdFZhbHVlQnlQYXRoKG9iajogYW55LCBwYXRoOiBzdHJpbmcsIGZhbGxiYWNrPzogYW55KTogYW55IHtcbiAgLy8gY3JlZGl0OiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzY0OTE0NjMvYWNjZXNzaW5nLW5lc3RlZC1qYXZhc2NyaXB0LW9iamVjdHMtd2l0aC1zdHJpbmcta2V5I2NvbW1lbnQ1NTI3ODQxM182NDkxNjIxXG4gIGlmIChvYmogPT0gbnVsbCB8fCAhcGF0aCB8fCB0eXBlb2YgcGF0aCAhPT0gJ3N0cmluZycpIHJldHVybiBmYWxsYmFjaztcbiAgaWYgKG9ialtwYXRoXSAhPT0gdW5kZWZpbmVkKSByZXR1cm4gb2JqW3BhdGhdO1xuICBwYXRoID0gcGF0aC5yZXBsYWNlKC9cXFsoXFx3KylcXF0vZywgJy4kMScpOyAvLyBjb252ZXJ0IGluZGV4ZXMgdG8gcHJvcGVydGllc1xuICBwYXRoID0gcGF0aC5yZXBsYWNlKC9eXFwuLywgJycpOyAvLyBzdHJpcCBhIGxlYWRpbmcgZG90XG4gIHJldHVybiBnZXROZXN0ZWRWYWx1ZShvYmosIHBhdGguc3BsaXQoJy4nKSwgZmFsbGJhY2spO1xufVxuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbmV4cG9ydCBmdW5jdGlvbiBpc0Jvb2xlYW4odmFsOiBhbnkpOiB2YWwgaXMgYm9vbGVhbiB7XG4gIHJldHVybiB0eXBlb2YgdmFsID09PSAnYm9vbGVhbic7XG59XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuZXhwb3J0IGZ1bmN0aW9uIGlzT2JqZWN0KG9iajogYW55KTogb2JqIGlzIG9iamVjdCB7XG4gIHJldHVybiBvYmogIT09IG51bGwgJiYgdHlwZW9mIG9iaiA9PT0gJ29iamVjdCc7XG59XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuZXhwb3J0IGZ1bmN0aW9uIGlzRnVuY3Rpb24ob2JqOiBhbnkpOiBvYmogaXMgRnVuY3Rpb24ge1xuICByZXR1cm4gdHlwZW9mIG9iaiA9PT0gJ2Z1bmN0aW9uJztcbn1cblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG5leHBvcnQgZnVuY3Rpb24gaXNQcmltaXRpdmUodmFsOiBhbnkpOiB2YWwgaXMgbnVtYmVyIHwgc3RyaW5nIHwgYm9vbGVhbiB7XG4gIHJldHVybiB0eXBlb2YgdmFsID09PSAnbnVtYmVyJyB8fCB0eXBlb2YgdmFsID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgdmFsID09PSAnYm9vbGVhbic7XG59XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuZXhwb3J0IGZ1bmN0aW9uIGlzTmlsKGFyZzogYW55KTogYm9vbGVhbiB7XG4gIHJldHVybiBhcmcgPT09IG51bGwgfHwgYXJnID09PSB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBjb25zdCBleGlzdHMgPSBub3QoaXNOaWwpO1xuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbmV4cG9ydCBmdW5jdGlvbiBpc1N0cmluZyhhcmc6IGFueSk6IGFyZyBpcyBzdHJpbmcge1xuICByZXR1cm4gdHlwZW9mIGFyZyA9PT0gJ3N0cmluZyc7XG59XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuZXhwb3J0IGZ1bmN0aW9uIGlzTnVtYmVyKGFyZzogYW55KTogYXJnIGlzIG51bWJlciB7XG4gIHJldHVybiB0eXBlb2YgYXJnID09PSAnbnVtYmVyJztcbn1cblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG5leHBvcnQgZnVuY3Rpb24gaXNIVE1MRWxlbWVudChvYmo6IGFueSk6IG9iaiBpcyBIVE1MRWxlbWVudCB7XG4gIHJldHVybiB0eXBlb2YgSFRNTEVsZW1lbnQgPT09ICdvYmplY3QnXG4gICAgPyBvYmogaW5zdGFuY2VvZiBIVE1MRWxlbWVudCAvL0RPTTJcbiAgICA6IG9iaiAmJiB0eXBlb2YgaXNPYmplY3Qob2JqKSAmJiBvYmoubm9kZVR5cGUgPT09IDEgJiYgdHlwZW9mIG9iai5ub2RlTmFtZSA9PT0gJ3N0cmluZyc7XG59XG5cbmV4cG9ydCBjb25zdCBjb25zdEVtcHR5QXJyYXkgPSBjb25zdGFudChbXSk7XG5cbmV4cG9ydCBjb25zdCBjb25zdE5vbmUgPSBjb25zdGFudChub25lKTtcblxuZXhwb3J0IGNvbnN0IGNvbnN0WmVybyA9IGNvbnN0YW50KDApO1xuXG5leHBvcnQgY29uc3QgY29uc3RFbXB0eVN0cmluZyA9IGNvbnN0YW50KCcnKTtcblxuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZUxpc3RJdGVtPEE+KEU6IEVxPEE+KSB7XG4gIHJldHVybiAoYTogQSwgYXM6IEFbXSkgPT4ge1xuICAgIGNvbnN0IGluZGV4ID0gYXMuZmluZEluZGV4KGkgPT4gRS5lcXVhbHMoYSwgaSkpO1xuICAgIHJldHVybiBpbmRleCA+IC0xID8gdW5zYWZlRGVsZXRlQXQoaW5kZXgsIGFzKSA6IGFzO1xuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9nZ2xlTGlzdEl0ZW08QT4oRTogRXE8QT4pIHtcbiAgcmV0dXJuIChhOiBBLCBhczogQVtdKSA9PiB7XG4gICAgY29uc3QgaW5kZXggPSBhcy5maW5kSW5kZXgoaSA9PiBFLmVxdWFscyhhLCBpKSk7XG4gICAgcmV0dXJuIGluZGV4ID4gLTEgPyB1bnNhZmVEZWxldGVBdChpbmRleCwgYXMpIDogc25vYyhhcywgYSk7XG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0ZyYWdtZW50KG5vZGU6IFZOb2RlKTogYm9vbGVhbiB7XG4gIHJldHVybiBub2RlLnR5cGUgPT09IEZyYWdtZW50Oztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzRW1wdHlTdHJpbmcoc3RyOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgcmV0dXJuIHN0ciA9PT0gJyc7XG59XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuZXhwb3J0IHR5cGUgUmVzdWx0PFQsIFA+ID0gUCBleHRlbmRzIGtleW9mIFQgPyBUW1BdIDogUCBleHRlbmRzIChpdGVtOiBUKSA9PiBhbnkgPyBSZXR1cm5UeXBlPFA+IDogVDtcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuZXhwb3J0IHR5cGUgRXh0cmFjdG9yPFQ+ID0gc3RyaW5nIHwgKChpdGVtOiBUKSA9PiBhbnkpO1xuXG5mdW5jdGlvbiBwcm9wPFQgZXh0ZW5kcyBvYmplY3QsIEsgZXh0ZW5kcyBrZXlvZiBUPihrZXk6IEssIG9iajogVCk6IFRbS10ge1xuICByZXR1cm4gb2JqW2tleV07XG59XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuZXhwb3J0IGZ1bmN0aW9uIGV4dHJhY3RQcm9wPFQsIFAgZXh0ZW5kcyAoaXRlbTogVCkgPT4gYW55IHwga2V5b2YgVD4oZXh0cmFjdG9yOiBFeHRyYWN0b3I8VD4sIGl0ZW06IFQpOiBSZXN1bHQ8VCwgUD4ge1xuICBpZiAoaXNGdW5jdGlvbihleHRyYWN0b3IpKSB7XG4gICAgcmV0dXJuIGV4dHJhY3RvcihpdGVtKTtcbiAgfSBlbHNlIGlmIChpc09iamVjdChpdGVtKSAmJiBpc1N0cmluZyhleHRyYWN0b3IpICYmIE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGl0ZW0sIGV4dHJhY3RvcikpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICByZXR1cm4gcHJvcChleHRyYWN0b3IgYXMgYW55LCBpdGVtKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gaXRlbSBhcyBSZXN1bHQ8VCwgUD47XG4gIH1cbn1cblxuY29uc3QgY2FtZWxpemVSRSA9IC8tKFxcdykvZztcbmV4cG9ydCBmdW5jdGlvbiBjYW1lbGl6ZShzdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBzdHIucmVwbGFjZShjYW1lbGl6ZVJFLCAoXywgYykgPT4gKGMgPyBjLnRvVXBwZXJDYXNlKCkgOiAnJykpO1xufVxuIl19
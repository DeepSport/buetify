import './dropdown.sass';
import { useThemePropsDefinition, useTheme } from '../../composables/theme';
import { getUseTogglePropsDefinition, useToggle } from '../../composables/toggle';
import { FadeTransitionPropsDefinition, useTransition } from '../../composables/transition';
import { useWindowSize } from '../../composables/windowSize';
import { defineComponent, shallowRef, computed, h, withDirectives, vShow, Transition } from 'vue';
import ClickOutside from '../../directives/clickOutside';
import { isString } from '../../utils/helpers';
import { DropdownThemeMap } from './theme';
export const BDropdownPropsDefinition = {
    ...useThemePropsDefinition(DropdownThemeMap),
    ...getUseTogglePropsDefinition('isExpanded'),
    ...FadeTransitionPropsDefinition,
    id: String,
    isDisabled: {
        type: Boolean,
        default: false
    },
    isHoverable: {
        type: Boolean,
        default: false
    },
    isInline: {
        type: Boolean,
        default: false
    },
    position: {
        type: String,
        validator: (value) => {
            return isString(value) && ['is-top-right', 'is-top-left', 'is-bottom-left'].includes(value);
        }
    },
    isMobileModal: {
        type: Boolean,
        default: true
    },
    menuTag: {
        type: String,
        default: 'ul'
    }
};
let id = 0;
function generateTrigger(toggle, id, slots) {
    return h('div', {
        ref: 'trigger',
        class: 'dropdown-trigger',
        role: 'button',
        'aria-owns': id,
        'aria-haspopup': 'listbox',
        'aria-expanded': `${toggle.isOn.value}`,
        onClick: toggle.toggle
    }, slots.trigger && slots.trigger(toggle));
}
function generateTransition(transition, children) {
    return h(Transition, transition, children);
}
function useCloseConditional(toggle, isInWhiteList) {
    return (e) => {
        const target = e.target;
        return toggle.isOn.value && isInWhiteList(target);
    };
}
function generateDropdownContent(menuTag, toggle, computedId, themeClasses, slots) {
    return h(menuTag, {
        class: ['dropdown-content', ...themeClasses],
        role: 'menu',
        id: computedId,
        'aria-hidden': toggle.isOff.value
    }, slots.default && slots.default(toggle));
}
function generateDropdownMenu(menuTag, toggle, computedId, themeClasses, transition, slots, useTransition = true) {
    const menu = () => toggle.isOn.value
        ? h('div', {
            ref: 'dropdownMenu',
            class: 'dropdown-menu'
        }, [generateDropdownContent(menuTag, toggle, computedId, themeClasses, slots)])
        : undefined;
    return useTransition ? generateTransition(transition, menu) : menu();
}
function generateMobileBackground(menuTag, toggle, computedId, themeClasses, transition, slots) {
    return generateTransition(transition, () => withDirectives(h('div', {
        class: 'background',
        'aria-hidden': toggle.isOff.value,
        onClick: toggle.setOff
    }, [generateDropdownMenu(menuTag, toggle, computedId, themeClasses, transition, slots, false)]), [[vShow, toggle.isOn.value]]));
}
function generateChildren(menuTag, isInline, toggle, computedId, transition, themeClasses, shouldDisplayMobileBackground, slots) {
    const children = [];
    if (!isInline) {
        children.push(generateTrigger(toggle, computedId, slots));
    }
    if (shouldDisplayMobileBackground) {
        children.push(generateMobileBackground(menuTag, toggle, computedId, themeClasses, transition, slots));
    }
    else {
        const menu = generateDropdownMenu(menuTag, toggle, computedId, themeClasses, transition, slots);
        if (menu) {
            children.push(menu);
        }
    }
    return children;
}
export default defineComponent({
    name: 'b-dropdown',
    props: BDropdownPropsDefinition,
    setup(props) {
        const windowSize = useWindowSize();
        const toggle = useToggle(props, 'isExpanded');
        const { themeClasses } = useTheme(props);
        const transition = useTransition(props);
        const root = shallowRef(null);
        const trigger = shallowRef(null);
        const dropdownMenu = shallowRef(null);
        const computedId = computed(() => `dropdown-menu-${props.id ?? id++}`);
        const rootClasses = computed(() => [
            props.position,
            {
                'is-disabled': props.isDisabled,
                'is-hoverable': props.isHoverable,
                'is-inline': props.isInline,
                'is-active': toggle.isOn.value || props.isInline,
                'is-mobile-modal': props.isMobileModal
            }
        ]);
        const displayMenu = computed(() => (!props.isDisabled && (toggle.isOn.value || props.isHoverable)) || props.isInline);
        const isMobileModal = computed(() => props.isMobileModal && !props.isInline && !props.isHoverable);
        const displayMobileBackground = computed(() => isMobileModal.value && windowSize.value.isTouch);
        function getDependentElements() {
            return Array.from(dropdownMenu.value?.querySelectorAll('*') ?? []);
        }
        function isInDropdown(el) {
            return dropdownMenu.value !== undefined && dropdownMenu.value.contains(el);
        }
        function isInTrigger(el) {
            return trigger.value !== undefined && trigger.value.contains(el);
        }
        function isInWhiteList(el) {
            if (el === root.value)
                return true;
            if (el === dropdownMenu.value)
                return true;
            if (el === trigger.value)
                return true;
            return isInDropdown(el) || isInTrigger(el);
        }
        const menuToggle = {
            ...toggle,
            isOn: displayMenu,
            isOff: computed(() => !displayMenu.value)
        };
        const closeConditional = useCloseConditional(menuToggle, isInWhiteList);
        const clickOutsideArgs = {
            include: getDependentElements,
            closeConditional
        };
        return {
            root,
            rootClasses,
            clickOutsideArgs,
            toggle,
            transition,
            themeClasses,
            dropdownMenu,
            displayMobileBackground,
            menuToggle,
            trigger,
            computedId
        };
    },
    render() {
        return withDirectives(h('div', { ref: 'root', class: ['dropdown', ...this.rootClasses] }, generateChildren(this.menuTag, this.isInline, this.menuToggle, this.computedId, this.transition, this.themeClasses, this.displayMobileBackground, this.$slots)), [[ClickOutside, this.toggle.setOff, this.clickOutsideArgs]]);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQkRyb3Bkb3duLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvZHJvcGRvd24vQkRyb3Bkb3duLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8saUJBQWlCLENBQUM7QUFHekIsT0FBTyxFQUFFLHVCQUF1QixFQUFFLFFBQVEsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQzVFLE9BQU8sRUFBRSwyQkFBMkIsRUFBVSxTQUFTLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUMxRixPQUFPLEVBQUUsNkJBQTZCLEVBQUUsYUFBYSxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDNUYsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBRTdELE9BQU8sRUFJTCxlQUFlLEVBQ2YsVUFBVSxFQUNWLFFBQVEsRUFFUixDQUFDLEVBQ0QsY0FBYyxFQUNkLEtBQUssRUFFTCxVQUFVLEVBQ1gsTUFBTSxLQUFLLENBQUM7QUFDYixPQUFPLFlBQVksTUFBTSwrQkFBK0IsQ0FBQztBQUN6RCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFL0MsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sU0FBUyxDQUFDO0FBSTNDLE1BQU0sQ0FBQyxNQUFNLHdCQUF3QixHQUFHO0lBQ3RDLEdBQUcsdUJBQXVCLENBQUMsZ0JBQWdCLENBQUM7SUFDNUMsR0FBRywyQkFBMkIsQ0FBQyxZQUFZLENBQUM7SUFDNUMsR0FBRyw2QkFBNkI7SUFDaEMsRUFBRSxFQUFFLE1BQTBCO0lBQzlCLFVBQVUsRUFBRTtRQUNWLElBQUksRUFBRSxPQUE0QjtRQUNsQyxPQUFPLEVBQUUsS0FBSztLQUNmO0lBQ0QsV0FBVyxFQUFFO1FBQ1gsSUFBSSxFQUFFLE9BQTRCO1FBQ2xDLE9BQU8sRUFBRSxLQUFLO0tBQ2Y7SUFDRCxRQUFRLEVBQUU7UUFDUixJQUFJLEVBQUUsT0FBNEI7UUFDbEMsT0FBTyxFQUFF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QUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUcsSUFBSSxDQUFDLGdCQUFzQyxDQUFDLENBQUMsQ0FDbkYsQ0FBQztJQUNKLENBQUM7Q0FDRixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJy4vZHJvcGRvd24uc2Fzcyc7XG5pbXBvcnQgeyBQcmVkaWNhdGUgfSBmcm9tICdmcC10cy9saWIvZnVuY3Rpb24nO1xuaW1wb3J0IHsgSU8gfSBmcm9tICdmcC10cy9saWIvSU8nO1xuaW1wb3J0IHsgdXNlVGhlbWVQcm9wc0RlZmluaXRpb24sIHVzZVRoZW1lIH0gZnJvbSAnLi4vLi4vY29tcG9zYWJsZXMvdGhlbWUnO1xuaW1wb3J0IHsgZ2V0VXNlVG9nZ2xlUHJvcHNEZWZpbml0aW9uLCBUb2dnbGUsIHVzZVRvZ2dsZSB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGVzL3RvZ2dsZSc7XG5pbXBvcnQgeyBGYWRlVHJhbnNpdGlvblByb3BzRGVmaW5pdGlvbiwgdXNlVHJhbnNpdGlvbiB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGVzL3RyYW5zaXRpb24nO1xuaW1wb3J0IHsgdXNlV2luZG93U2l6ZSB9IGZyb20gJy4uLy4uL2NvbXBvc2FibGVzL3dpbmRvd1NpemUnO1xuaW1wb3J0IHsgVHJhbnNpdGlvbkNsYXNzZXMgfSBmcm9tICcuLi8uLi90eXBlcy9UcmFuc2l0aW9uJztcbmltcG9ydCB7XG4gIEV4dHJhY3RQcm9wVHlwZXMsXG4gIFByb3BUeXBlLFxuICBWTm9kZSxcbiAgZGVmaW5lQ29tcG9uZW50LFxuICBzaGFsbG93UmVmLFxuICBjb21wdXRlZCxcbiAgUmVmLFxuICBoLFxuICB3aXRoRGlyZWN0aXZlcyxcbiAgdlNob3csXG4gIFNsb3RzLFxuICBUcmFuc2l0aW9uXG59IGZyb20gJ3Z1ZSc7XG5pbXBvcnQgQ2xpY2tPdXRzaWRlIGZyb20gJy4uLy4uL2RpcmVjdGl2ZXMvY2xpY2tPdXRzaWRlJztcbmltcG9ydCB7IGlzU3RyaW5nIH0gZnJvbSAnLi4vLi4vdXRpbHMvaGVscGVycyc7XG5pbXBvcnQgeyBDbGFzc2VzIH0gZnJvbSAnLi4vLi4vdXRpbHMvbWVyZ2VDbGFzc2VzJztcbmltcG9ydCB7IERyb3Bkb3duVGhlbWVNYXAgfSBmcm9tICcuL3RoZW1lJztcblxuZXhwb3J0IHR5cGUgRHJvcGRvd25Qb3NpdGlvbiA9ICdpcy10b3AtcmlnaHQnIHwgJ2lzLXRvcC1sZWZ0JyB8ICdpcy1ib3R0b20tbGVmdCc7XG5cbmV4cG9ydCBjb25zdCBCRHJvcGRvd25Qcm9wc0RlZmluaXRpb24gPSB7XG4gIC4uLnVzZVRoZW1lUHJvcHNEZWZpbml0aW9uKERyb3Bkb3duVGhlbWVNYXApLFxuICAuLi5nZXRVc2VUb2dnbGVQcm9wc0RlZmluaXRpb24oJ2lzRXhwYW5kZWQnKSxcbiAgLi4uRmFkZVRyYW5zaXRpb25Qcm9wc0RlZmluaXRpb24sXG4gIGlkOiBTdHJpbmcgYXMgUHJvcFR5cGU8c3RyaW5nPixcbiAgaXNEaXNhYmxlZDoge1xuICAgIHR5cGU6IEJvb2xlYW4gYXMgUHJvcFR5cGU8Ym9vbGVhbj4sXG4gICAgZGVmYXVsdDogZmFsc2VcbiAgfSxcbiAgaXNIb3ZlcmFibGU6IHtcbiAgICB0eXBlOiBCb29sZWFuIGFzIFByb3BUeXBlPGJvb2xlYW4+LFxuICAgIGRlZmF1bHQ6IGZhbHNlXG4gIH0sXG4gIGlzSW5saW5lOiB7XG4gICAgdHlwZTogQm9vbGVhbiBhcyBQcm9wVHlwZTxib29sZWFuPixcbiAgICBkZWZhdWx0OiBmYWxzZVxuICB9LFxuICBwb3NpdGlvbjoge1xuICAgIHR5cGU6IFN0cmluZyBhcyBQcm9wVHlwZTxEcm9wZG93blBvc2l0aW9uPixcbiAgICB2YWxpZGF0b3I6ICh2YWx1ZTogdW5rbm93bikgPT4ge1xuICAgICAgcmV0dXJuIGlzU3RyaW5nKHZhbHVlKSAmJiBbJ2lzLXRvcC1yaWdodCcsICdpcy10b3AtbGVmdCcsICdpcy1ib3R0b20tbGVmdCddLmluY2x1ZGVzKHZhbHVlKTtcbiAgICB9XG4gIH0sXG4gIGlzTW9iaWxlTW9kYWw6IHtcbiAgICB0eXBlOiBCb29sZWFuIGFzIFByb3BUeXBlPGJvb2xlYW4+LFxuICAgIGRlZmF1bHQ6IHRydWVcbiAgfSxcbiAgbWVudVRhZzoge1xuICAgIHR5cGU6IFN0cmluZyBhcyBQcm9wVHlwZTxzdHJpbmc+LFxuICAgIGRlZmF1bHQ6ICd1bCdcbiAgfVxufTtcblxuZXhwb3J0IHR5cGUgQkRyb3Bkb3duUHJvcHMgPSBFeHRyYWN0UHJvcFR5cGVzPHR5cGVvZiBCRHJvcGRvd25Qcm9wc0RlZmluaXRpb24+O1xuXG5sZXQgaWQgPSAwO1xuXG5mdW5jdGlvbiBnZW5lcmF0ZVRyaWdnZXIodG9nZ2xlOiBUb2dnbGUsIGlkOiBzdHJpbmcsIHNsb3RzOiBTbG90cykge1xuICByZXR1cm4gaChcbiAgICAnZGl2JyxcbiAgICB7XG4gICAgICByZWY6ICd0cmlnZ2VyJyxcbiAgICAgIGNsYXNzOiAnZHJvcGRvd24tdHJpZ2dlcicsXG4gICAgICByb2xlOiAnYnV0dG9uJyxcbiAgICAgICdhcmlhLW93bnMnOiBpZCxcbiAgICAgICdhcmlhLWhhc3BvcHVwJzogJ2xpc3Rib3gnLFxuICAgICAgJ2FyaWEtZXhwYW5kZWQnOiBgJHt0b2dnbGUuaXNPbi52YWx1ZX1gLFxuICAgICAgb25DbGljazogdG9nZ2xlLnRvZ2dsZVxuICAgIH0sXG4gICAgc2xvdHMudHJpZ2dlciAmJiBzbG90cy50cmlnZ2VyKHRvZ2dsZSlcbiAgKTtcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVUcmFuc2l0aW9uKHRyYW5zaXRpb246IFRyYW5zaXRpb25DbGFzc2VzLCBjaGlsZHJlbjogSU88Vk5vZGUgfCB1bmRlZmluZWQ+KSB7XG4gIHJldHVybiBoKFRyYW5zaXRpb24sIHRyYW5zaXRpb24sIGNoaWxkcmVuKTtcbn1cblxuZnVuY3Rpb24gdXNlQ2xvc2VDb25kaXRpb25hbCh0b2dnbGU6IFRvZ2dsZSwgaXNJbldoaXRlTGlzdDogUHJlZGljYXRlPEhUTUxFbGVtZW50Pik6IFByZWRpY2F0ZTxFdmVudD4ge1xuICByZXR1cm4gKGU6IEV2ZW50KSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgcmV0dXJuIHRvZ2dsZS5pc09uLnZhbHVlICYmIGlzSW5XaGl0ZUxpc3QodGFyZ2V0KTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVEcm9wZG93bkNvbnRlbnQoXG4gIG1lbnVUYWc6IHN0cmluZyxcbiAgdG9nZ2xlOiBUb2dnbGUsXG4gIGNvbXB1dGVkSWQ6IHN0cmluZyxcbiAgdGhlbWVDbGFzc2VzOiBzdHJpbmdbXSxcbiAgc2xvdHM6IFNsb3RzXG4pOiBWTm9kZSB7XG4gIHJldHVybiBoKFxuICAgIG1lbnVUYWcsXG4gICAge1xuICAgICAgY2xhc3M6IFsnZHJvcGRvd24tY29udGVudCcsIC4uLnRoZW1lQ2xhc3Nlc10sXG4gICAgICByb2xlOiAnbWVudScsXG4gICAgICBpZDogY29tcHV0ZWRJZCxcbiAgICAgICdhcmlhLWhpZGRlbic6IHRvZ2dsZS5pc09mZi52YWx1ZVxuICAgIH0sXG4gICAgc2xvdHMuZGVmYXVsdCAmJiBzbG90cy5kZWZhdWx0KHRvZ2dsZSlcbiAgKTtcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVEcm9wZG93bk1lbnUoXG4gIG1lbnVUYWc6IHN0cmluZyxcbiAgdG9nZ2xlOiBUb2dnbGUsXG4gIGNvbXB1dGVkSWQ6IHN0cmluZyxcbiAgdGhlbWVDbGFzc2VzOiBzdHJpbmdbXSxcbiAgdHJhbnNpdGlvbjogVHJhbnNpdGlvbkNsYXNzZXMsXG4gIHNsb3RzOiBTbG90cyxcbiAgdXNlVHJhbnNpdGlvbiA9IHRydWVcbikge1xuICBjb25zdCBtZW51ID0gKCkgPT5cbiAgICB0b2dnbGUuaXNPbi52YWx1ZVxuICAgICAgPyBoKFxuICAgICAgICAgICdkaXYnLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJlZjogJ2Ryb3Bkb3duTWVudScsXG4gICAgICAgICAgICBjbGFzczogJ2Ryb3Bkb3duLW1lbnUnXG4gICAgICAgICAgfSxcbiAgICAgICAgICBbZ2VuZXJhdGVEcm9wZG93bkNvbnRlbnQobWVudVRhZywgdG9nZ2xlLCBjb21wdXRlZElkLCB0aGVtZUNsYXNzZXMsIHNsb3RzKV1cbiAgICAgICAgKVxuICAgICAgOiB1bmRlZmluZWQ7XG4gIHJldHVybiB1c2VUcmFuc2l0aW9uID8gZ2VuZXJhdGVUcmFuc2l0aW9uKHRyYW5zaXRpb24sIG1lbnUpIDogbWVudSgpO1xufVxuXG5mdW5jdGlvbiBnZW5lcmF0ZU1vYmlsZUJhY2tncm91bmQoXG4gIG1lbnVUYWc6IHN0cmluZyxcbiAgdG9nZ2xlOiBUb2dnbGUsXG4gIGNvbXB1dGVkSWQ6IHN0cmluZyxcbiAgdGhlbWVDbGFzc2VzOiBzdHJpbmdbXSxcbiAgdHJhbnNpdGlvbjogVHJhbnNpdGlvbkNsYXNzZXMsXG4gIHNsb3RzOiBTbG90c1xuKTogVk5vZGUge1xuICByZXR1cm4gZ2VuZXJhdGVUcmFuc2l0aW9uKHRyYW5zaXRpb24sICgpID0+XG4gICAgd2l0aERpcmVjdGl2ZXMoXG4gICAgICBoKFxuICAgICAgICAnZGl2JyxcbiAgICAgICAge1xuICAgICAgICAgIGNsYXNzOiAnYmFja2dyb3VuZCcsXG4gICAgICAgICAgJ2FyaWEtaGlkZGVuJzogdG9nZ2xlLmlzT2ZmLnZhbHVlLFxuICAgICAgICAgIG9uQ2xpY2s6IHRvZ2dsZS5zZXRPZmZcbiAgICAgICAgfSxcbiAgICAgICAgW2dlbmVyYXRlRHJvcGRvd25NZW51KG1lbnVUYWcsIHRvZ2dsZSwgY29tcHV0ZWRJZCwgdGhlbWVDbGFzc2VzLCB0cmFuc2l0aW9uLCBzbG90cywgZmFsc2UpXVxuICAgICAgKSxcbiAgICAgIFtbdlNob3csIHRvZ2dsZS5pc09uLnZhbHVlXV1cbiAgICApXG4gICk7XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlQ2hpbGRyZW4oXG4gIG1lbnVUYWc6IHN0cmluZyxcbiAgaXNJbmxpbmU6IGJvb2xlYW4sXG4gIHRvZ2dsZTogVG9nZ2xlLFxuICBjb21wdXRlZElkOiBzdHJpbmcsXG4gIHRyYW5zaXRpb246IFRyYW5zaXRpb25DbGFzc2VzLFxuICB0aGVtZUNsYXNzZXM6IHN0cmluZ1tdLFxuICBzaG91bGREaXNwbGF5TW9iaWxlQmFja2dyb3VuZDogYm9vbGVhbixcbiAgc2xvdHM6IFNsb3RzXG4pIHtcbiAgY29uc3QgY2hpbGRyZW46IFZOb2RlW10gPSBbXTtcbiAgaWYgKCFpc0lubGluZSkge1xuICAgIGNoaWxkcmVuLnB1c2goZ2VuZXJhdGVUcmlnZ2VyKHRvZ2dsZSwgY29tcHV0ZWRJZCwgc2xvdHMpKTtcbiAgfVxuICBpZiAoc2hvdWxkRGlzcGxheU1vYmlsZUJhY2tncm91bmQpIHtcbiAgICBjaGlsZHJlbi5wdXNoKGdlbmVyYXRlTW9iaWxlQmFja2dyb3VuZChtZW51VGFnLCB0b2dnbGUsIGNvbXB1dGVkSWQsIHRoZW1lQ2xhc3NlcywgdHJhbnNpdGlvbiwgc2xvdHMpKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBtZW51ID0gZ2VuZXJhdGVEcm9wZG93bk1lbnUobWVudVRhZywgdG9nZ2xlLCBjb21wdXRlZElkLCB0aGVtZUNsYXNzZXMsIHRyYW5zaXRpb24sIHNsb3RzKTtcbiAgICBpZiAobWVudSkge1xuICAgICAgY2hpbGRyZW4ucHVzaChtZW51KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGNoaWxkcmVuO1xufVxuXG5leHBvcnQgZGVmYXVsdCBkZWZpbmVDb21wb25lbnQoe1xuICBuYW1lOiAnYi1kcm9wZG93bicsXG4gIHByb3BzOiBCRHJvcGRvd25Qcm9wc0RlZmluaXRpb24sXG4gIHNldHVwKHByb3BzKSB7XG4gICAgY29uc3Qgd2luZG93U2l6ZSA9IHVzZVdpbmRvd1NpemUoKTtcbiAgICBjb25zdCB0b2dnbGUgPSB1c2VUb2dnbGUocHJvcHMsICdpc0V4cGFuZGVkJyk7XG4gICAgY29uc3QgeyB0aGVtZUNsYXNzZXMgfSA9IHVzZVRoZW1lKHByb3BzKTtcbiAgICBjb25zdCB0cmFuc2l0aW9uID0gdXNlVHJhbnNpdGlvbihwcm9wcyk7XG4gICAgY29uc3Qgcm9vdCA9IHNoYWxsb3dSZWYoKG51bGwgYXMgdW5rbm93bikgYXMgSFRNTEVsZW1lbnQpO1xuICAgIGNvbnN0IHRyaWdnZXIgPSBzaGFsbG93UmVmKChudWxsIGFzIHVua25vd24pIGFzIEhUTUxFbGVtZW50KTtcbiAgICBjb25zdCBkcm9wZG93bk1lbnUgPSBzaGFsbG93UmVmKChudWxsIGFzIHVua25vd24pIGFzIEhUTUxFbGVtZW50KTtcbiAgICBjb25zdCBjb21wdXRlZElkID0gY29tcHV0ZWQoKCkgPT4gYGRyb3Bkb3duLW1lbnUtJHtwcm9wcy5pZCA/PyBpZCsrfWApO1xuICAgIGNvbnN0IHJvb3RDbGFzc2VzOiBSZWY8Q2xhc3Nlc1tdPiA9IGNvbXB1dGVkKCgpID0+IFtcbiAgICAgIHByb3BzLnBvc2l0aW9uLFxuICAgICAge1xuICAgICAgICAnaXMtZGlzYWJsZWQnOiBwcm9wcy5pc0Rpc2FibGVkLFxuICAgICAgICAnaXMtaG92ZXJhYmxlJzogcHJvcHMuaXNIb3ZlcmFibGUsXG4gICAgICAgICdpcy1pbmxpbmUnOiBwcm9wcy5pc0lubGluZSxcbiAgICAgICAgJ2lzLWFjdGl2ZSc6IHRvZ2dsZS5pc09uLnZhbHVlIHx8IHByb3BzLmlzSW5saW5lLFxuICAgICAgICAnaXMtbW9iaWxlLW1vZGFsJzogcHJvcHMuaXNNb2JpbGVNb2RhbFxuICAgICAgfVxuICAgIF0pO1xuICAgIGNvbnN0IGRpc3BsYXlNZW51ID0gY29tcHV0ZWQoXG4gICAgICAoKSA9PiAoIXByb3BzLmlzRGlzYWJsZWQgJiYgKHRvZ2dsZS5pc09uLnZhbHVlIHx8IHByb3BzLmlzSG92ZXJhYmxlKSkgfHwgcHJvcHMuaXNJbmxpbmVcbiAgICApO1xuICAgIGNvbnN0IGlzTW9iaWxlTW9kYWwgPSBjb21wdXRlZCgoKSA9PiBwcm9wcy5pc01vYmlsZU1vZGFsICYmICFwcm9wcy5pc0lubGluZSAmJiAhcHJvcHMuaXNIb3ZlcmFibGUpO1xuICAgIGNvbnN0IGRpc3BsYXlNb2JpbGVCYWNrZ3JvdW5kID0gY29tcHV0ZWQoKCkgPT4gaXNNb2JpbGVNb2RhbC52YWx1ZSAmJiB3aW5kb3dTaXplLnZhbHVlLmlzVG91Y2gpO1xuXG4gICAgZnVuY3Rpb24gZ2V0RGVwZW5kZW50RWxlbWVudHMoKTogSFRNTEVsZW1lbnRbXSB7XG4gICAgICByZXR1cm4gQXJyYXkuZnJvbShkcm9wZG93bk1lbnUudmFsdWU/LnF1ZXJ5U2VsZWN0b3JBbGwoJyonKSA/PyBbXSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNJbkRyb3Bkb3duKGVsOiBIVE1MRWxlbWVudCk6IGJvb2xlYW4ge1xuICAgICAgcmV0dXJuIGRyb3Bkb3duTWVudS52YWx1ZSAhPT0gdW5kZWZpbmVkICYmIGRyb3Bkb3duTWVudS52YWx1ZS5jb250YWlucyhlbCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNJblRyaWdnZXIoZWw6IEhUTUxFbGVtZW50KTogYm9vbGVhbiB7XG4gICAgICByZXR1cm4gdHJpZ2dlci52YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHRyaWdnZXIudmFsdWUuY29udGFpbnMoZWwpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGlzSW5XaGl0ZUxpc3QoZWw6IEhUTUxFbGVtZW50KSB7XG4gICAgICBpZiAoZWwgPT09IHJvb3QudmFsdWUpIHJldHVybiB0cnVlO1xuICAgICAgaWYgKGVsID09PSBkcm9wZG93bk1lbnUudmFsdWUpIHJldHVybiB0cnVlO1xuICAgICAgaWYgKGVsID09PSB0cmlnZ2VyLnZhbHVlKSByZXR1cm4gdHJ1ZTtcbiAgICAgIHJldHVybiBpc0luRHJvcGRvd24oZWwpIHx8IGlzSW5UcmlnZ2VyKGVsKTtcbiAgICB9XG5cbiAgICBjb25zdCBtZW51VG9nZ2xlID0ge1xuICAgICAgLi4udG9nZ2xlLFxuICAgICAgaXNPbjogZGlzcGxheU1lbnUsXG4gICAgICBpc09mZjogY29tcHV0ZWQoKCkgPT4gIWRpc3BsYXlNZW51LnZhbHVlKVxuICAgIH07XG5cbiAgICBjb25zdCBjbG9zZUNvbmRpdGlvbmFsID0gdXNlQ2xvc2VDb25kaXRpb25hbChtZW51VG9nZ2xlLCBpc0luV2hpdGVMaXN0KTtcblxuICAgIGNvbnN0IGNsaWNrT3V0c2lkZUFyZ3MgPSB7XG4gICAgICBpbmNsdWRlOiBnZXREZXBlbmRlbnRFbGVtZW50cyxcbiAgICAgIGNsb3NlQ29uZGl0aW9uYWxcbiAgICB9O1xuICAgIHJldHVybiB7XG4gICAgICByb290LFxuICAgICAgcm9vdENsYXNzZXMsXG4gICAgICBjbGlja091dHNpZGVBcmdzLFxuICAgICAgdG9nZ2xlLFxuICAgICAgdHJhbnNpdGlvbixcbiAgICAgIHRoZW1lQ2xhc3NlcyxcbiAgICAgIGRyb3Bkb3duTWVudSxcbiAgICAgIGRpc3BsYXlNb2JpbGVCYWNrZ3JvdW5kLFxuICAgICAgbWVudVRvZ2dsZSxcbiAgICAgIHRyaWdnZXIsXG4gICAgICBjb21wdXRlZElkXG4gICAgfTtcbiAgfSxcbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiB3aXRoRGlyZWN0aXZlcyhcbiAgICAgIGgoXG4gICAgICAgICdkaXYnLFxuICAgICAgICB7IHJlZjogJ3Jvb3QnLCBjbGFzczogWydkcm9wZG93bicsIC4uLnRoaXMucm9vdENsYXNzZXNdIH0sXG4gICAgICAgIGdlbmVyYXRlQ2hpbGRyZW4oXG4gICAgICAgICAgdGhpcy5tZW51VGFnLFxuICAgICAgICAgIHRoaXMuaXNJbmxpbmUsXG4gICAgICAgICAgdGhpcy5tZW51VG9nZ2xlLFxuICAgICAgICAgIHRoaXMuY29tcHV0ZWRJZCxcbiAgICAgICAgICB0aGlzLnRyYW5zaXRpb24sXG4gICAgICAgICAgdGhpcy50aGVtZUNsYXNzZXMsXG4gICAgICAgICAgdGhpcy5kaXNwbGF5TW9iaWxlQmFja2dyb3VuZCxcbiAgICAgICAgICB0aGlzLiRzbG90c1xuICAgICAgICApXG4gICAgICApLFxuICAgICAgW1tDbGlja091dHNpZGUsIHRoaXMudG9nZ2xlLnNldE9mZiwgKHRoaXMuY2xpY2tPdXRzaWRlQXJncyBhcyB1bmtub3duKSBhcyBzdHJpbmddXVxuICAgICk7XG4gIH1cbn0pO1xuIl19
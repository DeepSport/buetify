import './datepicker.sass';
import BDatepickerTableCell from './BDatepickerTableCell';
import { elemSerialDate, isDate, isOnOrAfterDate, isOnOrBeforeDate, isSameDay } from './utils';
import { constEmptyArray, constNone } from '../../../utils/helpers';
import { isNonEmpty } from 'fp-ts/lib/Array';
import { constTrue, identity } from 'fp-ts/lib/function';
import { fold } from 'fp-ts/lib/Option';
import { pipe } from 'fp-ts/lib/pipeable';
import { defineComponent, computed, h } from 'vue';
export const BDatepickerTableRowPropsDefinition = {
    modelValue: {
        type: [Date, Array],
        required: true
    },
    'onUpdate:modelValue': {
        type: Function,
        required: true
    },
    focusedDate: {
        type: Object,
        required: true
    },
    'onUpdate:focusedDate': {
        type: Function,
        required: true
    },
    showWeekNumber: {
        type: Boolean,
        default: false
    },
    weekNumber: {
        type: Number,
        required: true
    },
    week: {
        type: Array,
        required: true
    },
    month: {
        type: Number,
        required: true
    },
    minDate: {
        type: Object,
        required: true
    },
    maxDate: {
        type: Object,
        required: true
    },
    isDisabled: {
        type: Boolean,
        default: false
    },
    unselectableDates: {
        type: Array,
        default: constEmptyArray
    },
    unselectableDaysOfWeek: {
        type: Array,
        default: constEmptyArray
    },
    selectableDates: {
        type: Object,
        default: constNone
    },
    events: {
        type: Array,
        default: constEmptyArray
    },
    indicators: {
        type: String,
        required: true
    }
};
function getIsAfterMinDate(props) {
    return function isAfterMinDate(date) {
        return pipe(props.minDate, fold(constTrue, d => isOnOrAfterDate(date, d)));
    };
}
function getIsBeforeMaxDate(props) {
    return function isBeforeMaxDate(date) {
        return pipe(props.maxDate, fold(constTrue, d => isOnOrBeforeDate(date, d)));
    };
}
function getIsWithinMonth(props) {
    return function isWithinMonth(date) {
        return date.getMonth() === props.month;
    };
}
function getIsEnabled(props) {
    return function isEnabled(date) {
        return (!elemSerialDate(date, props.unselectableDates) &&
            pipe(props.selectableDates, fold(constTrue, dates => elemSerialDate(date, dates))));
    };
}
function getIsOnSelectableDayOfWeek(props) {
    return function isOnSelectableDayOfWeek(date) {
        return !props.unselectableDaysOfWeek.includes(date.getDay());
    };
}
function getDatePredicates(props) {
    const isAfterMinDate = getIsAfterMinDate(props);
    const isBeforeMaxDate = getIsBeforeMaxDate(props);
    const isWithinMonth = getIsWithinMonth(props);
    const isEnabled = getIsEnabled(props);
    const isOnSelectableDayOfWeek = getIsOnSelectableDayOfWeek(props);
    function isSelectedDate(date) {
        return Array.isArray(props.modelValue)
            ? props.modelValue.some(d => isSameDay(d, date))
            : isSameDay(props.modelValue, date);
    }
    function isSelectableDate(date) {
        return [
            isAfterMinDate(date),
            isBeforeMaxDate(date),
            isWithinMonth(date),
            isEnabled(date),
            isOnSelectableDayOfWeek(date)
        ].every(identity);
    }
    return {
        isAfterMinDate,
        isBeforeMaxDate,
        isWithinMonth,
        isEnabled,
        isOnSelectableDayOfWeek,
        isSelectableDate,
        isSelectedDate
    };
}
function getDateClassesGenerator(props, predicates) {
    const today = new Date();
    return function getDateClasses(date, hasEvents = false) {
        if (isDate(date)) {
            const isSelectable = predicates.isSelectableDate(date);
            return {
                'is-selected': predicates.isSelectedDate(date),
                'is-today': isSameDay(date, today),
                'is-selectable': isSelectable && !props.isDisabled,
                'is-unselectable': !isSelectable || props.isDisabled,
                'has-event': hasEvents
            };
        }
        else {
            return {};
        }
    };
}
function generateWeekNumber(weekNumber) {
    return h('td', [`${weekNumber}`]);
}
function getGenerateCell(props) {
    return function generateCell(cell) {
        return h(BDatepickerTableCell, {
            key: cell.date.toLocaleDateString(),
            cell,
            modelValue: props.modelValue,
            'onUpdate:modelValue': props['onUpdate:modelValue'],
            focusedDate: props.focusedDate,
            'onUpdate:focusedDate': props['onUpdate:focusedDate'],
            indicators: props.indicators
        });
    };
}
export default defineComponent({
    name: 'b-datepicker-table-row',
    props: BDatepickerTableRowPropsDefinition,
    setup(props) {
        const formattedEvents = computed(() => props.events.map(event => (isDate(event) ? { date: event, variant: 'is-primary' } : event)));
        const predicates = getDatePredicates(props);
        const getDateClasses = getDateClassesGenerator(props, predicates);
        const cells = computed(() => props.week.map(date => {
            const events = formattedEvents.value.filter(event => isSameDay(date, event.date));
            const hasEvents = isNonEmpty(events);
            return {
                date,
                events,
                hasEvents,
                isSelected: predicates.isSelectedDate(date),
                isDisabled: props.isDisabled || !predicates.isSelectableDate(date),
                number: date.getDate(),
                ariaLabel: date.toLocaleDateString(),
                classes: getDateClasses(date, hasEvents)
            };
        }));
        const generateCell = getGenerateCell(props);
        return () => {
            return h('tr', { class: 'datepicker-row' }, props.showWeekNumber
                ? [generateWeekNumber(props.weekNumber), ...cells.value.map(generateCell)]
                : cells.value.map(generateCell));
        };
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQkRhdGVwaWNrZXJUYWJsZVJvdy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2Zvcm0vZGF0ZXBpY2tlci9CRGF0ZXBpY2tlclRhYmxlUm93LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sbUJBQW1CLENBQUM7QUFDM0IsT0FBTyxvQkFBb0IsTUFBTSx3QkFBd0IsQ0FBQztBQUUxRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxlQUFlLEVBQUUsZ0JBQWdCLEVBQUUsU0FBUyxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQy9GLE9BQU8sRUFBRSxlQUFlLEVBQUUsU0FBUyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDcEUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxTQUFTLEVBQWEsUUFBUSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDcEUsT0FBTyxFQUFFLElBQUksRUFBVSxNQUFNLGtCQUFrQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUMxQyxPQUFPLEVBQUUsZUFBZSxFQUFtQixRQUFRLEVBQXlCLENBQUMsRUFBRSxNQUFNLEtBQUssQ0FBQztBQUUzRixNQUFNLENBQUMsTUFBTSxrQ0FBa0MsR0FBRztJQUNoRCxVQUFVLEVBQUU7UUFDVixJQUFJLEVBQUUsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUE0QjtRQUM5QyxRQUFRLEVBQUUsSUFBYTtLQUN4QjtJQUNELHFCQUFxQixFQUFFO1FBQ3JCLElBQUksRUFBRSxRQUFzRDtRQUM1RCxRQUFRLEVBQUUsSUFBYTtLQUN4QjtJQUNELFdBQVcsRUFBRTtRQUNYLElBQUksRUFBRSxNQUFnQztRQUN0QyxRQUFRLEVBQUUsSUFBYTtLQUN4QjtJQUNELHNCQUFzQixFQUFFO1FBQ3RCLElBQUksRUFBRSxRQUFvRDtRQUMxRCxRQUFRLEVB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LEVBQUUsSUFBSSxDQUFDLGtCQUFrQixFQUFFO2dCQUNwQyxPQUFPLEVBQUUsY0FBYyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUM7YUFDekMsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUNILENBQUM7UUFDRixNQUFNLFlBQVksR0FBRyxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDNUMsT0FBTyxHQUFHLEVBQUU7WUFDVixPQUFPLENBQUMsQ0FDTixJQUFJLEVBQ0osRUFBRSxLQUFLLEVBQUUsZ0JBQWdCLEVBQUUsRUFDM0IsS0FBSyxDQUFDLGNBQWM7Z0JBQ2xCLENBQUMsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsRUFBRSxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUMxRSxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQ2xDLENBQUM7UUFDSixDQUFDLENBQUM7SUFDSixDQUFDO0NBQ0YsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICcuL2RhdGVwaWNrZXIuc2Fzcyc7XG5pbXBvcnQgQkRhdGVwaWNrZXJUYWJsZUNlbGwgZnJvbSAnLi9CRGF0ZXBpY2tlclRhYmxlQ2VsbCc7XG5pbXBvcnQgeyBEYXRlQ2VsbCwgRGF0ZUV2ZW50LCBEZXRhaWxlZERhdGVFdmVudCB9IGZyb20gJy4vc2hhcmVkJztcbmltcG9ydCB7IGVsZW1TZXJpYWxEYXRlLCBpc0RhdGUsIGlzT25PckFmdGVyRGF0ZSwgaXNPbk9yQmVmb3JlRGF0ZSwgaXNTYW1lRGF5IH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgeyBjb25zdEVtcHR5QXJyYXksIGNvbnN0Tm9uZSB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2hlbHBlcnMnO1xuaW1wb3J0IHsgaXNOb25FbXB0eSB9IGZyb20gJ2ZwLXRzL2xpYi9BcnJheSc7XG5pbXBvcnQgeyBjb25zdFRydWUsIEZ1bmN0aW9uTiwgaWRlbnRpdHkgfSBmcm9tICdmcC10cy9saWIvZnVuY3Rpb24nO1xuaW1wb3J0IHsgZm9sZCwgT3B0aW9uIH0gZnJvbSAnZnAtdHMvbGliL09wdGlvbic7XG5pbXBvcnQgeyBwaXBlIH0gZnJvbSAnZnAtdHMvbGliL3BpcGVhYmxlJztcbmltcG9ydCB7IGRlZmluZUNvbXBvbmVudCwgUHJvcFR5cGUsIFZOb2RlLCBjb21wdXRlZCwgUmVmLCBFeHRyYWN0UHJvcFR5cGVzLCBoIH0gZnJvbSAndnVlJztcblxuZXhwb3J0IGNvbnN0IEJEYXRlcGlja2VyVGFibGVSb3dQcm9wc0RlZmluaXRpb24gPSB7XG4gIG1vZGVsVmFsdWU6IHtcbiAgICB0eXBlOiBbRGF0ZSwgQXJyYXldIGFzIFByb3BUeXBlPERhdGUgfCBEYXRlW10+LFxuICAgIHJlcXVpcmVkOiB0cnVlIGFzIGNvbnN0XG4gIH0sXG4gICdvblVwZGF0ZTptb2RlbFZhbHVlJzoge1xuICAgIHR5cGU6IEZ1bmN0aW9uIGFzIFByb3BUeXBlPEZ1bmN0aW9uTjxbRGF0ZSB8IERhdGVbXV0sIHZvaWQ+PixcbiAgICByZXF1aXJlZDogdHJ1ZSBhcyBjb25zdFxuICB9LFxuICBmb2N1c2VkRGF0ZToge1xuICAgIHR5cGU6IE9iamVjdCBhcyBQcm9wVHlwZTxPcHRpb248RGF0ZT4+LFxuICAgIHJlcXVpcmVkOiB0cnVlIGFzIGNvbnN0XG4gIH0sXG4gICdvblVwZGF0ZTpmb2N1c2VkRGF0ZSc6IHtcbiAgICB0eXBlOiBGdW5jdGlvbiBhcyBQcm9wVHlwZTxGdW5jdGlvbk48W09wdGlvbjxEYXRlPl0sIGFueT4+LFxuICAgIHJlcXVpcmVkOiB0cnVlIGFzIGNvbnN0XG4gIH0sXG4gIHNob3dXZWVrTnVtYmVyOiB7XG4gICAgdHlwZTogQm9vbGVhbiBhcyBQcm9wVHlwZTxib29sZWFuPixcbiAgICBkZWZhdWx0OiBmYWxzZSBhcyBjb25zdFxuICB9LFxuICB3ZWVrTnVtYmVyOiB7XG4gICAgdHlwZTogTnVtYmVyIGFzIFByb3BUeXBlPG51bWJlcj4sXG4gICAgcmVxdWlyZWQ6IHRydWUgYXMgY29uc3RcbiAgfSxcbiAgd2Vlazoge1xuICAgIHR5cGU6IEFycmF5IGFzIFByb3BUeXBlPERhdGVbXT4sXG4gICAgcmVxdWlyZWQ6IHRydWUgYXMgY29uc3RcbiAgfSxcbiAgbW9udGg6IHtcbiAgICB0eXBlOiBOdW1iZXIgYXMgUHJvcFR5cGU8bnVtYmVyPixcbiAgICByZXF1aXJlZDogdHJ1ZSBhcyBjb25zdFxuICB9LFxuICBtaW5EYXRlOiB7XG4gICAgdHlwZTogT2JqZWN0IGFzIFByb3BUeXBlPE9wdGlvbjxEYXRlPj4sXG4gICAgcmVxdWlyZWQ6IHRydWUgYXMgY29uc3RcbiAgfSxcbiAgbWF4RGF0ZToge1xuICAgIHR5cGU6IE9iamVjdCBhcyBQcm9wVHlwZTxPcHRpb248RGF0ZT4+LFxuICAgIHJlcXVpcmVkOiB0cnVlIGFzIGNvbnN0XG4gIH0sXG4gIGlzRGlzYWJsZWQ6IHtcbiAgICB0eXBlOiBCb29sZWFuIGFzIFByb3BUeXBlPGJvb2xlYW4+LFxuICAgIGRlZmF1bHQ6IGZhbHNlIGFzIGNvbnN0XG4gIH0sXG4gIHVuc2VsZWN0YWJsZURhdGVzOiB7XG4gICAgdHlwZTogQXJyYXkgYXMgUHJvcFR5cGU8RGF0ZVtdPixcbiAgICBkZWZhdWx0OiBjb25zdEVtcHR5QXJyYXlcbiAgfSxcbiAgdW5zZWxlY3RhYmxlRGF5c09mV2Vlazoge1xuICAgIHR5cGU6IEFycmF5IGFzIFByb3BUeXBlPG51bWJlcltdPixcbiAgICBkZWZhdWx0OiBjb25zdEVtcHR5QXJyYXlcbiAgfSxcbiAgc2VsZWN0YWJsZURhdGVzOiB7XG4gICAgdHlwZTogT2JqZWN0IGFzIFByb3BUeXBlPE9wdGlvbjxEYXRlW10+PixcbiAgICBkZWZhdWx0OiBjb25zdE5vbmVcbiAgfSxcbiAgZXZlbnRzOiB7XG4gICAgdHlwZTogQXJyYXkgYXMgUHJvcFR5cGU8RGF0ZUV2ZW50W10+LFxuICAgIGRlZmF1bHQ6IGNvbnN0RW1wdHlBcnJheVxuICB9LFxuICBpbmRpY2F0b3JzOiB7XG4gICAgdHlwZTogU3RyaW5nIGFzIFByb3BUeXBlPCdkb3RzJyB8ICdiYXJzJz4sXG4gICAgcmVxdWlyZWQ6IHRydWUgYXMgY29uc3RcbiAgfVxufTtcblxuZXhwb3J0IHR5cGUgQkRhdGVQaWNrZXJUYWJsZVJvd1Byb3BzID0gRXh0cmFjdFByb3BUeXBlczx0eXBlb2YgQkRhdGVwaWNrZXJUYWJsZVJvd1Byb3BzRGVmaW5pdGlvbj47XG5cbmZ1bmN0aW9uIGdldElzQWZ0ZXJNaW5EYXRlKHByb3BzOiBCRGF0ZVBpY2tlclRhYmxlUm93UHJvcHMpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIGlzQWZ0ZXJNaW5EYXRlKGRhdGU6IERhdGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gcGlwZShcbiAgICAgIHByb3BzLm1pbkRhdGUsXG4gICAgICBmb2xkKGNvbnN0VHJ1ZSwgZCA9PiBpc09uT3JBZnRlckRhdGUoZGF0ZSwgZCkpXG4gICAgKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gZ2V0SXNCZWZvcmVNYXhEYXRlKHByb3BzOiBCRGF0ZVBpY2tlclRhYmxlUm93UHJvcHMpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIGlzQmVmb3JlTWF4RGF0ZShkYXRlOiBEYXRlKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHBpcGUoXG4gICAgICBwcm9wcy5tYXhEYXRlLFxuICAgICAgZm9sZChjb25zdFRydWUsIGQgPT4gaXNPbk9yQmVmb3JlRGF0ZShkYXRlLCBkKSlcbiAgICApO1xuICB9O1xufVxuXG5mdW5jdGlvbiBnZXRJc1dpdGhpbk1vbnRoKHByb3BzOiBCRGF0ZVBpY2tlclRhYmxlUm93UHJvcHMpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIGlzV2l0aGluTW9udGgoZGF0ZTogRGF0ZSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBkYXRlLmdldE1vbnRoKCkgPT09IHByb3BzLm1vbnRoO1xuICB9O1xufVxuXG5mdW5jdGlvbiBnZXRJc0VuYWJsZWQocHJvcHM6IEJEYXRlUGlja2VyVGFibGVSb3dQcm9wcykge1xuICByZXR1cm4gZnVuY3Rpb24gaXNFbmFibGVkKGRhdGU6IERhdGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgIWVsZW1TZXJpYWxEYXRlKGRhdGUsIHByb3BzLnVuc2VsZWN0YWJsZURhdGVzKSAmJlxuICAgICAgcGlwZShcbiAgICAgICAgcHJvcHMuc2VsZWN0YWJsZURhdGVzLFxuICAgICAgICBmb2xkKGNvbnN0VHJ1ZSwgZGF0ZXMgPT4gZWxlbVNlcmlhbERhdGUoZGF0ZSwgZGF0ZXMpKVxuICAgICAgKVxuICAgICk7XG4gIH07XG59XG5cbmZ1bmN0aW9uIGdldElzT25TZWxlY3RhYmxlRGF5T2ZXZWVrKHByb3BzOiBCRGF0ZVBpY2tlclRhYmxlUm93UHJvcHMpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIGlzT25TZWxlY3RhYmxlRGF5T2ZXZWVrKGRhdGU6IERhdGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gIXByb3BzLnVuc2VsZWN0YWJsZURheXNPZldlZWsuaW5jbHVkZXMoZGF0ZS5nZXREYXkoKSk7XG4gIH07XG59XG5cbmZ1bmN0aW9uIGdldERhdGVQcmVkaWNhdGVzKHByb3BzOiBCRGF0ZVBpY2tlclRhYmxlUm93UHJvcHMpIHtcbiAgY29uc3QgaXNBZnRlck1pbkRhdGUgPSBnZXRJc0FmdGVyTWluRGF0ZShwcm9wcyk7XG4gIGNvbnN0IGlzQmVmb3JlTWF4RGF0ZSA9IGdldElzQmVmb3JlTWF4RGF0ZShwcm9wcyk7XG4gIGNvbnN0IGlzV2l0aGluTW9udGggPSBnZXRJc1dpdGhpbk1vbnRoKHByb3BzKTtcbiAgY29uc3QgaXNFbmFibGVkID0gZ2V0SXNFbmFibGVkKHByb3BzKTtcbiAgY29uc3QgaXNPblNlbGVjdGFibGVEYXlPZldlZWsgPSBnZXRJc09uU2VsZWN0YWJsZURheU9mV2Vlayhwcm9wcyk7XG4gIGZ1bmN0aW9uIGlzU2VsZWN0ZWREYXRlKGRhdGU6IERhdGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gQXJyYXkuaXNBcnJheShwcm9wcy5tb2RlbFZhbHVlKVxuICAgICAgPyBwcm9wcy5tb2RlbFZhbHVlLnNvbWUoZCA9PiBpc1NhbWVEYXkoZCwgZGF0ZSkpXG4gICAgICA6IGlzU2FtZURheShwcm9wcy5tb2RlbFZhbHVlLCBkYXRlKTtcbiAgfVxuICBmdW5jdGlvbiBpc1NlbGVjdGFibGVEYXRlKGRhdGU6IERhdGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gW1xuICAgICAgaXNBZnRlck1pbkRhdGUoZGF0ZSksXG4gICAgICBpc0JlZm9yZU1heERhdGUoZGF0ZSksXG4gICAgICBpc1dpdGhpbk1vbnRoKGRhdGUpLFxuICAgICAgaXNFbmFibGVkKGRhdGUpLFxuICAgICAgaXNPblNlbGVjdGFibGVEYXlPZldlZWsoZGF0ZSlcbiAgICBdLmV2ZXJ5KGlkZW50aXR5KTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGlzQWZ0ZXJNaW5EYXRlLFxuICAgIGlzQmVmb3JlTWF4RGF0ZSxcbiAgICBpc1dpdGhpbk1vbnRoLFxuICAgIGlzRW5hYmxlZCxcbiAgICBpc09uU2VsZWN0YWJsZURheU9mV2VlayxcbiAgICBpc1NlbGVjdGFibGVEYXRlLFxuICAgIGlzU2VsZWN0ZWREYXRlXG4gIH07XG59XG5cbnR5cGUgRGF0ZVByZWRpY2F0ZXMgPSBSZXR1cm5UeXBlPHR5cGVvZiBnZXREYXRlUHJlZGljYXRlcz47XG5cbmZ1bmN0aW9uIGdldERhdGVDbGFzc2VzR2VuZXJhdG9yKHByb3BzOiBCRGF0ZVBpY2tlclRhYmxlUm93UHJvcHMsIHByZWRpY2F0ZXM6IERhdGVQcmVkaWNhdGVzKSB7XG4gIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKTtcbiAgcmV0dXJuIGZ1bmN0aW9uIGdldERhdGVDbGFzc2VzKGRhdGU6IERhdGUgfCB1bmRlZmluZWQgfCBudWxsLCBoYXNFdmVudHMgPSBmYWxzZSkge1xuICAgIGlmIChpc0RhdGUoZGF0ZSkpIHtcbiAgICAgIGNvbnN0IGlzU2VsZWN0YWJsZSA9IHByZWRpY2F0ZXMuaXNTZWxlY3RhYmxlRGF0ZShkYXRlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgICdpcy1zZWxlY3RlZCc6IHByZWRpY2F0ZXMuaXNTZWxlY3RlZERhdGUoZGF0ZSksXG4gICAgICAgICdpcy10b2RheSc6IGlzU2FtZURheShkYXRlLCB0b2RheSksXG4gICAgICAgICdpcy1zZWxlY3RhYmxlJzogaXNTZWxlY3RhYmxlICYmICFwcm9wcy5pc0Rpc2FibGVkLFxuICAgICAgICAnaXMtdW5zZWxlY3RhYmxlJzogIWlzU2VsZWN0YWJsZSB8fCBwcm9wcy5pc0Rpc2FibGVkLFxuICAgICAgICAnaGFzLWV2ZW50JzogaGFzRXZlbnRzXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuICB9O1xufVxuXG5mdW5jdGlvbiBnZW5lcmF0ZVdlZWtOdW1iZXIod2Vla051bWJlcjogbnVtYmVyKTogVk5vZGUge1xuICByZXR1cm4gaCgndGQnLCBbYCR7d2Vla051bWJlcn1gXSk7XG59XG5cbmZ1bmN0aW9uIGdldEdlbmVyYXRlQ2VsbChwcm9wczogQkRhdGVQaWNrZXJUYWJsZVJvd1Byb3BzKSB7XG4gIHJldHVybiBmdW5jdGlvbiBnZW5lcmF0ZUNlbGwoY2VsbDogRGF0ZUNlbGwpOiBWTm9kZSB7XG4gICAgcmV0dXJuIGgoQkRhdGVwaWNrZXJUYWJsZUNlbGwsIHtcbiAgICAgIGtleTogY2VsbC5kYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygpLFxuICAgICAgY2VsbCxcbiAgICAgIG1vZGVsVmFsdWU6IHByb3BzLm1vZGVsVmFsdWUsXG4gICAgICAnb25VcGRhdGU6bW9kZWxWYWx1ZSc6IHByb3BzWydvblVwZGF0ZTptb2RlbFZhbHVlJ10sXG4gICAgICBmb2N1c2VkRGF0ZTogcHJvcHMuZm9jdXNlZERhdGUsXG4gICAgICAnb25VcGRhdGU6Zm9jdXNlZERhdGUnOiBwcm9wc1snb25VcGRhdGU6Zm9jdXNlZERhdGUnXSxcbiAgICAgIGluZGljYXRvcnM6IHByb3BzLmluZGljYXRvcnNcbiAgICB9KTtcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgZGVmaW5lQ29tcG9uZW50KHtcbiAgbmFtZTogJ2ItZGF0ZXBpY2tlci10YWJsZS1yb3cnLFxuICBwcm9wczogQkRhdGVwaWNrZXJUYWJsZVJvd1Byb3BzRGVmaW5pdGlvbixcbiAgc2V0dXAocHJvcHMpIHtcbiAgICBjb25zdCBmb3JtYXR0ZWRFdmVudHM6IFJlZjxEZXRhaWxlZERhdGVFdmVudFtdPiA9IGNvbXB1dGVkKCgpID0+XG4gICAgICBwcm9wcy5ldmVudHMubWFwKGV2ZW50ID0+IChpc0RhdGUoZXZlbnQpID8geyBkYXRlOiBldmVudCwgdmFyaWFudDogJ2lzLXByaW1hcnknIH0gOiBldmVudCkpXG4gICAgKTtcbiAgICBjb25zdCBwcmVkaWNhdGVzID0gZ2V0RGF0ZVByZWRpY2F0ZXMocHJvcHMpO1xuICAgIGNvbnN0IGdldERhdGVDbGFzc2VzID0gZ2V0RGF0ZUNsYXNzZXNHZW5lcmF0b3IocHJvcHMsIHByZWRpY2F0ZXMpO1xuICAgIGNvbnN0IGNlbGxzID0gY29tcHV0ZWQoKCkgPT5cbiAgICAgIHByb3BzLndlZWsubWFwKGRhdGUgPT4ge1xuICAgICAgICBjb25zdCBldmVudHMgPSBmb3JtYXR0ZWRFdmVudHMudmFsdWUuZmlsdGVyKGV2ZW50ID0+IGlzU2FtZURheShkYXRlLCBldmVudC5kYXRlKSk7XG4gICAgICAgIGNvbnN0IGhhc0V2ZW50cyA9IGlzTm9uRW1wdHkoZXZlbnRzKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkYXRlLFxuICAgICAgICAgIGV2ZW50cyxcbiAgICAgICAgICBoYXNFdmVudHMsXG4gICAgICAgICAgaXNTZWxlY3RlZDogcHJlZGljYXRlcy5pc1NlbGVjdGVkRGF0ZShkYXRlKSxcbiAgICAgICAgICBpc0Rpc2FibGVkOiBwcm9wcy5pc0Rpc2FibGVkIHx8ICFwcmVkaWNhdGVzLmlzU2VsZWN0YWJsZURhdGUoZGF0ZSksXG4gICAgICAgICAgbnVtYmVyOiBkYXRlLmdldERhdGUoKSxcbiAgICAgICAgICBhcmlhTGFiZWw6IGRhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCksXG4gICAgICAgICAgY2xhc3NlczogZ2V0RGF0ZUNsYXNzZXMoZGF0ZSwgaGFzRXZlbnRzKVxuICAgICAgICB9O1xuICAgICAgfSlcbiAgICApO1xuICAgIGNvbnN0IGdlbmVyYXRlQ2VsbCA9IGdldEdlbmVyYXRlQ2VsbChwcm9wcyk7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIHJldHVybiBoKFxuICAgICAgICAndHInLFxuICAgICAgICB7IGNsYXNzOiAnZGF0ZXBpY2tlci1yb3cnIH0sXG4gICAgICAgIHByb3BzLnNob3dXZWVrTnVtYmVyXG4gICAgICAgICAgPyBbZ2VuZXJhdGVXZWVrTnVtYmVyKHByb3BzLndlZWtOdW1iZXIpLCAuLi5jZWxscy52YWx1ZS5tYXAoZ2VuZXJhdGVDZWxsKV1cbiAgICAgICAgICA6IGNlbGxzLnZhbHVlLm1hcChnZW5lcmF0ZUNlbGwpXG4gICAgICApO1xuICAgIH07XG4gIH1cbn0pO1xuIl19
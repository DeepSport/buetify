import { elem } from 'fp-ts/lib/Array';
import { fromEquals } from 'fp-ts/lib/Eq';
import { fromCompare, geq, leq } from 'fp-ts/lib/Ord';
export function isDate(value) {
    // from date-fns
    return (value instanceof Date || (typeof value === 'object' && Object.prototype.toString.call(value) === '[object Date]'));
}
export function getStartOfDay(date) {
    const clone = new Date(date.getTime());
    clone.setHours(0, 0, 0, 0);
    return clone;
}
export function getEndOfDay(date) {
    const clone = new Date(date.getTime());
    clone.setHours(23, 59, 59, 999);
    return clone;
}
export function isSameDay(x, y) {
    return getStartOfDay(x).getTime() === getStartOfDay(y).getTime();
}
export function isBeforeDay(date, isBefore) {
    return date.getTime() < getStartOfDay(isBefore).getTime();
}
export function isAfterDay(date, isAfter) {
    return date.getTime() > getEndOfDay(isAfter).getTime();
}
function compareSerialDate(x, y) {
    return isBeforeDay(x, y) ? -1 : isAfterDay(x, y) ? 1 : 0;
}
export function isSameMonth(x, y) {
    return x.getFullYear() === y.getFullYear() && x.getMonth() === y.getMonth();
}
export const eqSerialDate = fromEquals(isSameDay);
export const ordSerialDate = fromCompare(compareSerialDate);
export const isOnOrAfterDate = geq(ordSerialDate);
export const isOnOrBeforeDate = leq(ordSerialDate);
export const elemSerialDate = elem(ordSerialDate);
export function getStartOfMonth(date) {
    const clone = new Date(date.getTime());
    clone.setDate(1);
    clone.setHours(0, 0, 0, 0);
    return clone;
}
export function getEndOfMonth(date) {
    const clone = new Date(date.getTime());
    const month = clone.getMonth();
    clone.setFullYear(clone.getFullYear(), month + 1, 0);
    clone.setHours(23, 59, 59, 999);
    return clone;
}
export function getStartOfWeek(date, weekStartsOn = 0) {
    const clone = new Date(date.getTime());
    const day = clone.getDay();
    const diff = (day < weekStartsOn ? 7 : 0) + day - weekStartsOn;
    clone.setDate(clone.getDate() - diff);
    clone.setHours(0, 0, 0, 0);
    return clone;
}
export function getEndOfWeek(date, weekStartsOn = 0) {
    const clone = new Date(date.getTime());
    const day = clone.getDay();
    const diff = (day < weekStartsOn ? -7 : 0) + 6 - (day - weekStartsOn);
    clone.setDate(clone.getDate() + diff);
    clone.setHours(23, 59, 59, 999);
    return clone;
}
export function isWithinWeek(date, secondDate, weekStartsOn = 0) {
    return (isOnOrAfterDate(date, getStartOfWeek(secondDate, weekStartsOn)) &&
        isOnOrBeforeDate(date, getEndOfWeek(secondDate, weekStartsOn)));
}
export function getDaysInMonth(date) {
    const clone = new Date(date.getTime());
    const year = clone.getFullYear();
    const monthIndex = clone.getMonth();
    const lastDayOfMonth = new Date(0);
    lastDayOfMonth.setFullYear(year, monthIndex + 1, 0);
    lastDayOfMonth.setHours(0, 0, 0, 0);
    return lastDayOfMonth.getDate();
}
export function addDays(date, days) {
    const clone = new Date(date.getTime());
    clone.setDate(clone.getDate() + days);
    return clone;
}
export function getDatesInWeek(date, weekStartsOn = 0) {
    const dates = [];
    let day = getStartOfWeek(date, weekStartsOn);
    const end = getEndOfWeek(date, weekStartsOn);
    while (isOnOrBeforeDate(day, end)) {
        dates.push(day);
        day = addDays(day, 1);
    }
    return dates;
}
export function addMonths(date, months) {
    const clone = new Date(date.getTime());
    const newMonth = clone.getMonth() + months;
    const dateWithDesiredMonth = new Date(0);
    dateWithDesiredMonth.setFullYear(clone.getFullYear(), newMonth, 1);
    dateWithDesiredMonth.setHours(0, 0, 0, 0);
    const daysInMonth = getDaysInMonth(dateWithDesiredMonth);
    clone.setMonth(newMonth, Math.min(daysInMonth, clone.getDate()));
    return clone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9mb3JtL2RhdGVwaWNrZXIvdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3ZDLE9BQU8sRUFBTSxVQUFVLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDOUMsT0FBTyxFQUFFLFdBQVcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFPLE1BQU0sZUFBZSxDQUFDO0FBRzNELE1BQU0sVUFBVSxNQUFNLENBQUMsS0FBYztJQUNuQyxnQkFBZ0I7SUFDaEIsT0FBTyxDQUNMLEtBQUssWUFBWSxJQUFJLElBQUksQ0FBQyxPQUFPLEtBQUssS0FBSyxRQUFRLElBQUksTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLGVBQWUsQ0FBQyxDQUNsSCxDQUFDO0FBQ0osQ0FBQztBQUVELE1BQU0sVUFBVSxhQUFhLENBQUMsSUFBVTtJQUN0QyxNQUFNLEtBQUssR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztJQUN2QyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzNCLE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELE1BQU0sVUFBVSxXQUFXLENBQUMsSUFBVTtJQUNwQyxNQUFNLEtBQUssR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztJQUN2QyxLQUFLLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ2hDLE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELE1BQU0sVUFBVSxTQUFTLENBQUMsQ0FB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QyxDQUFDO1FBQ2hCLEdBQUcsR0FBRyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO0tBQ3ZCO0lBQ0QsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDO0FBRUQsTUFBTSxVQUFVLFNBQVMsQ0FBQyxJQUFVLEVBQUUsTUFBYztJQUNsRCxNQUFNLEtBQUssR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztJQUN2QyxNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsUUFBUSxFQUFFLEdBQUcsTUFBTSxDQUFDO0lBQzNDLE1BQU0sb0JBQW9CLEdBQUcsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDekMsb0JBQW9CLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUUsRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDbkUsb0JBQW9CLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzFDLE1BQU0sV0FBVyxHQUFHLGNBQWMsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0lBQ3pELEtBQUssQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDakUsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZWxlbSB9IGZyb20gJ2ZwLXRzL2xpYi9BcnJheSc7XG5pbXBvcnQgeyBFcSwgZnJvbUVxdWFscyB9IGZyb20gJ2ZwLXRzL2xpYi9FcSc7XG5pbXBvcnQgeyBmcm9tQ29tcGFyZSwgZ2VxLCBsZXEsIE9yZCB9IGZyb20gJ2ZwLXRzL2xpYi9PcmQnO1xuaW1wb3J0IHsgT3JkZXJpbmcgfSBmcm9tICdmcC10cy9saWIvT3JkZXJpbmcnO1xuXG5leHBvcnQgZnVuY3Rpb24gaXNEYXRlKHZhbHVlOiB1bmtub3duKTogdmFsdWUgaXMgRGF0ZSB7XG4gIC8vIGZyb20gZGF0ZS1mbnNcbiAgcmV0dXJuIChcbiAgICB2YWx1ZSBpbnN0YW5jZW9mIERhdGUgfHwgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbHVlKSA9PT0gJ1tvYmplY3QgRGF0ZV0nKVxuICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0U3RhcnRPZkRheShkYXRlOiBEYXRlKTogRGF0ZSB7XG4gIGNvbnN0IGNsb25lID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpO1xuICBjbG9uZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcbiAgcmV0dXJuIGNsb25lO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RW5kT2ZEYXkoZGF0ZTogRGF0ZSk6IERhdGUge1xuICBjb25zdCBjbG9uZSA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpKTtcbiAgY2xvbmUuc2V0SG91cnMoMjMsIDU5LCA1OSwgOTk5KTtcbiAgcmV0dXJuIGNsb25lO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNTYW1lRGF5KHg6IERhdGUsIHk6IERhdGUpOiBib29sZWFuIHtcbiAgcmV0dXJuIGdldFN0YXJ0T2ZEYXkoeCkuZ2V0VGltZSgpID09PSBnZXRTdGFydE9mRGF5KHkpLmdldFRpbWUoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzQmVmb3JlRGF5KGRhdGU6IERhdGUsIGlzQmVmb3JlOiBEYXRlKTogYm9vbGVhbiB7XG4gIHJldHVybiBkYXRlLmdldFRpbWUoKSA8IGdldFN0YXJ0T2ZEYXkoaXNCZWZvcmUpLmdldFRpbWUoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzQWZ0ZXJEYXkoZGF0ZTogRGF0ZSwgaXNBZnRlcjogRGF0ZSk6IGJvb2xlYW4ge1xuICByZXR1cm4gZGF0ZS5nZXRUaW1lKCkgPiBnZXRFbmRPZkRheShpc0FmdGVyKS5nZXRUaW1lKCk7XG59XG5cbmZ1bmN0aW9uIGNvbXBhcmVTZXJpYWxEYXRlKHg6IERhdGUsIHk6IERhdGUpOiBPcmRlcmluZyB7XG4gIHJldHVybiBpc0JlZm9yZURheSh4LCB5KSA/IC0xIDogaXNBZnRlckRheSh4LCB5KSA/IDEgOiAwO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNTYW1lTW9udGgoeDogRGF0ZSwgeTogRGF0ZSk6IGJvb2xlYW4ge1xuICByZXR1cm4geC5nZXRGdWxsWWVhcigpID09PSB5LmdldEZ1bGxZZWFyKCkgJiYgeC5nZXRNb250aCgpID09PSB5LmdldE1vbnRoKCk7XG59XG5cbmV4cG9ydCBjb25zdCBlcVNlcmlhbERhdGU6IEVxPERhdGU+ID0gZnJvbUVxdWFscyhpc1NhbWVEYXkpO1xuZXhwb3J0IGNvbnN0IG9yZFNlcmlhbERhdGU6IE9yZDxEYXRlPiA9IGZyb21Db21wYXJlKGNvbXBhcmVTZXJpYWxEYXRlKTtcblxuZXhwb3J0IGNvbnN0IGlzT25PckFmdGVyRGF0ZSA9IGdlcShvcmRTZXJpYWxEYXRlKTtcblxuZXhwb3J0IGNvbnN0IGlzT25PckJlZm9yZURhdGUgPSBsZXEob3JkU2VyaWFsRGF0ZSk7XG5cbmV4cG9ydCBjb25zdCBlbGVtU2VyaWFsRGF0ZSA9IGVsZW0ob3JkU2VyaWFsRGF0ZSk7XG5cbmV4cG9ydCB0eXBlIFdlZWtkYXlOdW1iZXIgPSAwIHwgMSB8IDIgfCAzIHwgNCB8IDUgfCA2O1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0U3RhcnRPZk1vbnRoKGRhdGU6IERhdGUpOiBEYXRlIHtcbiAgY29uc3QgY2xvbmUgPSBuZXcgRGF0ZShkYXRlLmdldFRpbWUoKSk7XG4gIGNsb25lLnNldERhdGUoMSk7XG4gIGNsb25lLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuICByZXR1cm4gY2xvbmU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRFbmRPZk1vbnRoKGRhdGU6IERhdGUpOiBEYXRlIHtcbiAgY29uc3QgY2xvbmUgPSBuZXcgRGF0ZShkYXRlLmdldFRpbWUoKSk7XG4gIGNvbnN0IG1vbnRoID0gY2xvbmUuZ2V0TW9udGgoKTtcbiAgY2xvbmUuc2V0RnVsbFllYXIoY2xvbmUuZ2V0RnVsbFllYXIoKSwgbW9udGggKyAxLCAwKTtcbiAgY2xvbmUuc2V0SG91cnMoMjMsIDU5LCA1OSwgOTk5KTtcbiAgcmV0dXJuIGNsb25lO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0U3RhcnRPZldlZWsoZGF0ZTogRGF0ZSwgd2Vla1N0YXJ0c09uOiBXZWVrZGF5TnVtYmVyID0gMCk6IERhdGUge1xuICBjb25zdCBjbG9uZSA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpKTtcbiAgY29uc3QgZGF5ID0gY2xvbmUuZ2V0RGF5KCk7XG4gIGNvbnN0IGRpZmYgPSAoZGF5IDwgd2Vla1N0YXJ0c09uID8gNyA6IDApICsgZGF5IC0gd2Vla1N0YXJ0c09uO1xuICBjbG9uZS5zZXREYXRlKGNsb25lLmdldERhdGUoKSAtIGRpZmYpO1xuICBjbG9uZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcbiAgcmV0dXJuIGNsb25lO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RW5kT2ZXZWVrKGRhdGU6IERhdGUsIHdlZWtTdGFydHNPbjogV2Vla2RheU51bWJlciA9IDApOiBEYXRlIHtcbiAgY29uc3QgY2xvbmUgPSBuZXcgRGF0ZShkYXRlLmdldFRpbWUoKSk7XG4gIGNvbnN0IGRheSA9IGNsb25lLmdldERheSgpO1xuICBjb25zdCBkaWZmID0gKGRheSA8IHdlZWtTdGFydHNPbiA/IC03IDogMCkgKyA2IC0gKGRheSAtIHdlZWtTdGFydHNPbik7XG4gIGNsb25lLnNldERhdGUoY2xvbmUuZ2V0RGF0ZSgpICsgZGlmZik7XG4gIGNsb25lLnNldEhvdXJzKDIzLCA1OSwgNTksIDk5OSk7XG4gIHJldHVybiBjbG9uZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzV2l0aGluV2VlayhkYXRlOiBEYXRlLCBzZWNvbmREYXRlOiBEYXRlLCB3ZWVrU3RhcnRzT246IFdlZWtkYXlOdW1iZXIgPSAwKTogYm9vbGVhbiB7XG4gIHJldHVybiAoXG4gICAgaXNPbk9yQWZ0ZXJEYXRlKGRhdGUsIGdldFN0YXJ0T2ZXZWVrKHNlY29uZERhdGUsIHdlZWtTdGFydHNPbikpICYmXG4gICAgaXNPbk9yQmVmb3JlRGF0ZShkYXRlLCBnZXRFbmRPZldlZWsoc2Vjb25kRGF0ZSwgd2Vla1N0YXJ0c09uKSlcbiAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldERheXNJbk1vbnRoKGRhdGU6IERhdGUpOiBudW1iZXIge1xuICBjb25zdCBjbG9uZSA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpKTtcbiAgY29uc3QgeWVhciA9IGNsb25lLmdldEZ1bGxZZWFyKCk7XG4gIGNvbnN0IG1vbnRoSW5kZXggPSBjbG9uZS5nZXRNb250aCgpO1xuICBjb25zdCBsYXN0RGF5T2ZNb250aCA9IG5ldyBEYXRlKDApO1xuICBsYXN0RGF5T2ZNb250aC5zZXRGdWxsWWVhcih5ZWFyLCBtb250aEluZGV4ICsgMSwgMCk7XG4gIGxhc3REYXlPZk1vbnRoLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuICByZXR1cm4gbGFzdERheU9mTW9udGguZ2V0RGF0ZSgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWRkRGF5cyhkYXRlOiBEYXRlLCBkYXlzOiBudW1iZXIpOiBEYXRlIHtcbiAgY29uc3QgY2xvbmUgPSBuZXcgRGF0ZShkYXRlLmdldFRpbWUoKSk7XG4gIGNsb25lLnNldERhdGUoY2xvbmUuZ2V0RGF0ZSgpICsgZGF5cyk7XG4gIHJldHVybiBjbG9uZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldERhdGVzSW5XZWVrKGRhdGU6IERhdGUsIHdlZWtTdGFydHNPbjogV2Vla2RheU51bWJlciA9IDApOiBEYXRlW10ge1xuICBjb25zdCBkYXRlcyA9IFtdO1xuICBsZXQgZGF5ID0gZ2V0U3RhcnRPZldlZWsoZGF0ZSwgd2Vla1N0YXJ0c09uKTtcbiAgY29uc3QgZW5kID0gZ2V0RW5kT2ZXZWVrKGRhdGUsIHdlZWtTdGFydHNPbik7XG4gIHdoaWxlIChpc09uT3JCZWZvcmVEYXRlKGRheSwgZW5kKSkge1xuICAgIGRhdGVzLnB1c2goZGF5KTtcbiAgICBkYXkgPSBhZGREYXlzKGRheSwgMSk7XG4gIH1cbiAgcmV0dXJuIGRhdGVzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWRkTW9udGhzKGRhdGU6IERhdGUsIG1vbnRoczogbnVtYmVyKTogRGF0ZSB7XG4gIGNvbnN0IGNsb25lID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpO1xuICBjb25zdCBuZXdNb250aCA9IGNsb25lLmdldE1vbnRoKCkgKyBtb250aHM7XG4gIGNvbnN0IGRhdGVXaXRoRGVzaXJlZE1vbnRoID0gbmV3IERhdGUoMCk7XG4gIGRhdGVXaXRoRGVzaXJlZE1vbnRoLnNldEZ1bGxZZWFyKGNsb25lLmdldEZ1bGxZZWFyKCksIG5ld01vbnRoLCAxKTtcbiAgZGF0ZVdpdGhEZXNpcmVkTW9udGguc2V0SG91cnMoMCwgMCwgMCwgMCk7XG4gIGNvbnN0IGRheXNJbk1vbnRoID0gZ2V0RGF5c0luTW9udGgoZGF0ZVdpdGhEZXNpcmVkTW9udGgpO1xuICBjbG9uZS5zZXRNb250aChuZXdNb250aCwgTWF0aC5taW4oZGF5c0luTW9udGgsIGNsb25lLmdldERhdGUoKSkpO1xuICByZXR1cm4gY2xvbmU7XG59XG4iXX0=
import './datepicker.sass';
import { toggleListItem } from '../../../utils/helpers';
import { eqSerialDate, isSameDay } from './utils';
import { exists, getEq, some } from 'fp-ts/lib/Option';
import { pipe } from 'fp-ts/lib/pipeable';
import { defineComponent, shallowRef, h, watch, onMounted } from 'vue';
function generateEvents(events) {
    return h('div', { class: 'events' }, events.map((event, index) => h('div', {
        key: index,
        class: ['event', event.variant]
    })));
}
const toggleSerialDate = toggleListItem(eqSerialDate);
const eqOptionSerialDate = getEq(eqSerialDate);
export default defineComponent({
    name: 'b-datepicker-table-cell',
    props: {
        modelValue: {
            type: [Date, Array],
            required: true
        },
        'onUpdate:modelValue': {
            type: Function,
            required: true
        },
        focusedDate: {
            type: Object,
            required: true
        },
        'onUpdate:focusedDate': {
            type: Function,
            required: true
        },
        indicators: {
            type: String,
            required: true
        },
        cell: {
            type: Object,
            required: true
        }
    },
    setup(props) {
        const buttonRef = shallowRef(null);
        function onClick(e) {
            e && e.preventDefault();
            const currentValue = props.modelValue;
            props['onUpdate:modelValue'](Array.isArray(currentValue) ? toggleSerialDate(props.cell.date, currentValue) : props.cell.date);
        }
        const onFocus = () => {
            props['onUpdate:focusedDate'](some(props.cell.date));
        };
        onMounted(() => watch(() => props.focusedDate, (newVal, oldVal) => {
            if (((oldVal && !eqOptionSerialDate.equals(newVal, oldVal)) || oldVal === undefined) &&
                buttonRef.value &&
                pipe(newVal, exists(d => isSameDay(d, props.cell.date))) &&
                document.activeElement !== buttonRef.value) {
                buttonRef.value.focus({ preventScroll: true });
            }
        }, {
            immediate: true
        }));
        return () => {
            return h('td', [
                h('button', {
                    ref: buttonRef,
                    class: ['datepicker-cell', props.cell.classes, props.indicators],
                    disabled: props.cell.isDisabled,
                    tabindex: props.cell.isDisabled || props.cell.isSelected ? -1 : 0,
                    'aria-label': props.cell.ariaLabel,
                    onClick,
                    onFocus,
                    onMouseenter: onFocus
                }, [props.cell.date.getDate(), props.cell.hasEvents ? generateEvents(props.cell.events) : undefined])
            ]);
        };
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQkRhdGVwaWNrZXJUYWJsZUNlbGwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9mb3JtL2RhdGVwaWNrZXIvQkRhdGVwaWNrZXJUYWJsZUNlbGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxtQkFBbUIsQ0FBQztBQUUzQixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFFeEQsT0FBTyxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDbEQsT0FBTyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQVUsSUFBSSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDL0QsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzFDLE9BQU8sRUFBbUIsZUFBZSxFQUFFLFVBQVUsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxNQUFNLEtBQUssQ0FBQztBQUV4RixTQUFTLGNBQWMsQ0FBQyxNQUEyQjtJQUNqRCxPQUFPLENBQUMsQ0FDTixLQUFLLEVBQ0wsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQ25CLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FDMUIsQ0FBQyxDQUFDLEtBQUssRUFBRTtRQUNQLEdBQUcsRUFBRSxLQUFLO1FBQ1YsS0FBSyxFQUFFLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUM7S0FDaEMsQ0FBQyxDQUNILENBQ0YsQ0FBQztBQUNKLENBQUM7QUFFRCxNQUFNLGdCQUFnQixHQUFHLGNBQWMsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUV0RCxNQUFNLGtCQUFrQixHQUFHLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUUvQyxlQUFlLGVBQWUsQ0FBQztJQUM3QixJQUFJLEVBQUUseUJBQXlCO0lBQy9CLEtBQUssRUFBRTtRQUNM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QUMsU0FBUztvQkFDbEMsT0FBTztvQkFDUCxPQUFPO29CQUNQLFlBQVksRUFBRSxPQUFPO2lCQUN0QixFQUNELENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FDbEc7YUFDRixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUM7SUFDSixDQUFDO0NBQ0YsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICcuL2RhdGVwaWNrZXIuc2Fzcyc7XG5pbXBvcnQgeyBGdW5jdGlvbk4gfSBmcm9tICdmcC10cy9saWIvZnVuY3Rpb24nO1xuaW1wb3J0IHsgdG9nZ2xlTGlzdEl0ZW0gfSBmcm9tICcuLi8uLi8uLi91dGlscy9oZWxwZXJzJztcbmltcG9ydCB7IERhdGVDZWxsLCBEZXRhaWxlZERhdGVFdmVudCwgRXZlbnRJbmRpY2F0b3IgfSBmcm9tICcuL3NoYXJlZCc7XG5pbXBvcnQgeyBlcVNlcmlhbERhdGUsIGlzU2FtZURheSB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHsgZXhpc3RzLCBnZXRFcSwgT3B0aW9uLCBzb21lIH0gZnJvbSAnZnAtdHMvbGliL09wdGlvbic7XG5pbXBvcnQgeyBwaXBlIH0gZnJvbSAnZnAtdHMvbGliL3BpcGVhYmxlJztcbmltcG9ydCB7IFByb3BUeXBlLCBWTm9kZSwgZGVmaW5lQ29tcG9uZW50LCBzaGFsbG93UmVmLCBoLCB3YXRjaCwgb25Nb3VudGVkIH0gZnJvbSAndnVlJztcblxuZnVuY3Rpb24gZ2VuZXJhdGVFdmVudHMoZXZlbnRzOiBEZXRhaWxlZERhdGVFdmVudFtdKTogVk5vZGUge1xuICByZXR1cm4gaChcbiAgICAnZGl2JyxcbiAgICB7IGNsYXNzOiAnZXZlbnRzJyB9LFxuICAgIGV2ZW50cy5tYXAoKGV2ZW50LCBpbmRleCkgPT5cbiAgICAgIGgoJ2RpdicsIHtcbiAgICAgICAga2V5OiBpbmRleCxcbiAgICAgICAgY2xhc3M6IFsnZXZlbnQnLCBldmVudC52YXJpYW50XVxuICAgICAgfSlcbiAgICApXG4gICk7XG59XG5cbmNvbnN0IHRvZ2dsZVNlcmlhbERhdGUgPSB0b2dnbGVMaXN0SXRlbShlcVNlcmlhbERhdGUpO1xuXG5jb25zdCBlcU9wdGlvblNlcmlhbERhdGUgPSBnZXRFcShlcVNlcmlhbERhdGUpO1xuXG5leHBvcnQgZGVmYXVsdCBkZWZpbmVDb21wb25lbnQoe1xuICBuYW1lOiAnYi1kYXRlcGlja2VyLXRhYmxlLWNlbGwnLFxuICBwcm9wczoge1xuICAgIG1vZGVsVmFsdWU6IHtcbiAgICAgIHR5cGU6IFtEYXRlLCBBcnJheV0gYXMgUHJvcFR5cGU8RGF0ZSB8IERhdGVbXT4sXG4gICAgICByZXF1aXJlZDogdHJ1ZVxuICAgIH0sXG4gICAgJ29uVXBkYXRlOm1vZGVsVmFsdWUnOiB7XG4gICAgICB0eXBlOiBGdW5jdGlvbiBhcyBQcm9wVHlwZTxGdW5jdGlvbk48W0RhdGUgfCBEYXRlW11dLCB2b2lkPj4sXG4gICAgICByZXF1aXJlZDogdHJ1ZVxuICAgIH0sXG4gICAgZm9jdXNlZERhdGU6IHtcbiAgICAgIHR5cGU6IE9iamVjdCBhcyBQcm9wVHlwZTxPcHRpb248RGF0ZT4+LFxuICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICB9LFxuICAgICdvblVwZGF0ZTpmb2N1c2VkRGF0ZSc6IHtcbiAgICAgIHR5cGU6IEZ1bmN0aW9uIGFzIFByb3BUeXBlPEZ1bmN0aW9uTjxbT3B0aW9uPERhdGU+XSwgdm9pZD4+LFxuICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICB9LFxuICAgIGluZGljYXRvcnM6IHtcbiAgICAgIHR5cGU6IFN0cmluZyBhcyBQcm9wVHlwZTxFdmVudEluZGljYXRvcj4sXG4gICAgICByZXF1aXJlZDogdHJ1ZVxuICAgIH0sXG4gICAgY2VsbDoge1xuICAgICAgdHlwZTogT2JqZWN0IGFzIFByb3BUeXBlPERhdGVDZWxsPixcbiAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgfVxuICB9LFxuICBzZXR1cChwcm9wcykge1xuICAgIGNvbnN0IGJ1dHRvblJlZiA9IHNoYWxsb3dSZWYoKG51bGwgYXMgdW5rbm93bikgYXMgSFRNTEVsZW1lbnQpO1xuXG4gICAgZnVuY3Rpb24gb25DbGljayhlPzogTW91c2VFdmVudCkge1xuICAgICAgZSAmJiBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBjb25zdCBjdXJyZW50VmFsdWUgPSBwcm9wcy5tb2RlbFZhbHVlO1xuICAgICAgcHJvcHNbJ29uVXBkYXRlOm1vZGVsVmFsdWUnXShcbiAgICAgICAgQXJyYXkuaXNBcnJheShjdXJyZW50VmFsdWUpID8gdG9nZ2xlU2VyaWFsRGF0ZShwcm9wcy5jZWxsLmRhdGUsIGN1cnJlbnRWYWx1ZSkgOiBwcm9wcy5jZWxsLmRhdGVcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3Qgb25Gb2N1cyA9ICgpID0+IHtcbiAgICAgIHByb3BzWydvblVwZGF0ZTpmb2N1c2VkRGF0ZSddKHNvbWUocHJvcHMuY2VsbC5kYXRlKSk7XG4gICAgfTtcblxuICAgIG9uTW91bnRlZCgoKSA9PlxuICAgICAgd2F0Y2goXG4gICAgICAgICgpID0+IHByb3BzLmZvY3VzZWREYXRlLFxuICAgICAgICAobmV3VmFsLCBvbGRWYWwpID0+IHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAoKG9sZFZhbCAmJiAhZXFPcHRpb25TZXJpYWxEYXRlLmVxdWFscyhuZXdWYWwsIG9sZFZhbCkpIHx8IG9sZFZhbCA9PT0gdW5kZWZpbmVkKSAmJlxuICAgICAgICAgICAgYnV0dG9uUmVmLnZhbHVlICYmXG4gICAgICAgICAgICBwaXBlKFxuICAgICAgICAgICAgICBuZXdWYWwsXG4gICAgICAgICAgICAgIGV4aXN0cyhkID0+IGlzU2FtZURheShkLCBwcm9wcy5jZWxsLmRhdGUpKVxuICAgICAgICAgICAgKSAmJlxuICAgICAgICAgICAgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAhPT0gYnV0dG9uUmVmLnZhbHVlXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBidXR0b25SZWYudmFsdWUuZm9jdXMoeyBwcmV2ZW50U2Nyb2xsOiB0cnVlIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGltbWVkaWF0ZTogdHJ1ZVxuICAgICAgICB9XG4gICAgICApXG4gICAgKTtcblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICByZXR1cm4gaCgndGQnLCBbXG4gICAgICAgIGgoXG4gICAgICAgICAgJ2J1dHRvbicsXG4gICAgICAgICAge1xuICAgICAgICAgICAgcmVmOiBidXR0b25SZWYsXG4gICAgICAgICAgICBjbGFzczogWydkYXRlcGlja2VyLWNlbGwnLCBwcm9wcy5jZWxsLmNsYXNzZXMsIHByb3BzLmluZGljYXRvcnNdLFxuICAgICAgICAgICAgZGlzYWJsZWQ6IHByb3BzLmNlbGwuaXNEaXNhYmxlZCxcbiAgICAgICAgICAgIHRhYmluZGV4OiBwcm9wcy5jZWxsLmlzRGlzYWJsZWQgfHwgcHJvcHMuY2VsbC5pc1NlbGVjdGVkID8gLTEgOiAwLFxuICAgICAgICAgICAgJ2FyaWEtbGFiZWwnOiBwcm9wcy5jZWxsLmFyaWFMYWJlbCxcbiAgICAgICAgICAgIG9uQ2xpY2ssXG4gICAgICAgICAgICBvbkZvY3VzLFxuICAgICAgICAgICAgb25Nb3VzZWVudGVyOiBvbkZvY3VzXG4gICAgICAgICAgfSxcbiAgICAgICAgICBbcHJvcHMuY2VsbC5kYXRlLmdldERhdGUoKSwgcHJvcHMuY2VsbC5oYXNFdmVudHMgPyBnZW5lcmF0ZUV2ZW50cyhwcm9wcy5jZWxsLmV2ZW50cykgOiB1bmRlZmluZWRdXG4gICAgICAgIClcbiAgICAgIF0pO1xuICAgIH07XG4gIH1cbn0pO1xuIl19
import './b-numberinput.sass';
import { getUseInputPropsDefinition } from '../../../composables/input/useInput';
import { constant, constVoid } from 'fp-ts/lib/function';
import { h, defineComponent, defineAsyncComponent, computed } from 'vue';
import BButton from '../../button/BButton';
import { BInput } from '../input/BInput';
import { DEFAULT_INPUT_ICONS } from '../shared/types';
const DEFAULT_NUMBER_INPUT_ICONS = {
    minus: defineAsyncComponent(() => import('../../icons/minus')),
    plus: defineAsyncComponent(() => import('../../icons/plus'))
};
const BNumberInputPropsDefinition = {
    ...getUseInputPropsDefinition(),
    modelValue: {
        type: Number,
        default: 0
    },
    'onUpdate:modelValue': {
        type: Function,
        default: constant(constVoid)
    },
    min: {
        type: Number,
        default: Number.MIN_SAFE_INTEGER
    },
    max: {
        type: Number,
        default: Number.MAX_SAFE_INTEGER
    },
    step: {
        type: Number,
        default: 1
    },
    displayControls: {
        type: Boolean,
        default: true
    },
    controlsRounded: {
        type: Boolean,
        default: false
    },
    controlsPosition: {
        type: String,
        default: ''
    },
    inputIcons: {
        type: Object,
        default: constant(DEFAULT_INPUT_ICONS)
    },
    numberInputIcons: {
        type: Object,
        default: constant(DEFAULT_NUMBER_INPUT_ICONS)
    }
};
export function getNumberInputIcons(icons) {
    return { ...DEFAULT_NUMBER_INPUT_ICONS, ...icons };
}
function getFieldClasses(controlsPosition) {
    const isCompact = controlsPosition === 'compact';
    return {
        'has-addons': isCompact,
        'is-grouped': !isCompact
    };
}
function generateControl(props, data, isDecrement) {
    return h('p', {
        class: 'control'
    }, [
        h(BButton, {
            variant: props.variant,
            size: props.size,
            isRounded: props.controlsRounded,
            isDisabled: isDecrement ? !data.canDecrement : !data.canIncrement,
            onClick: isDecrement ? data.onDecrement : data.onIncrement
        }, () => h((isDecrement ? props.numberInputIcons.minus : props.numberInputIcons.plus), {
            size: props.size
        }))
    ]);
}
function generateInput(props) {
    return h(BInput, {
        modelValue: props.modelValue,
        'onUpdate:modelValue': props['onUpdate:modelValue'],
        type: 'number',
        size: props.size,
        inputIcons: props.inputIcons,
        isReadonly: props.isReadonly,
        isLoading: props.isLoading,
        isRounded: props.isRounded,
        icon: props.icon,
        isExpanded: props.isExpanded,
        step: props.step,
        max: props.max,
        min: props.min
    });
}
export default defineComponent({
    name: 'b-number-input',
    props: BNumberInputPropsDefinition,
    setup(props) {
        const canDecrement = computed(() => props.modelValue - props.step > props.min);
        function onDecrement() {
            if (canDecrement.value) {
                props['onUpdate:modelValue'](props.modelValue - props.step);
            }
        }
        const canIncrement = computed(() => props.modelValue + props.step < props.max);
        function onIncrement() {
            if (canIncrement.value) {
                props['onUpdate:modelValue'](props.modelValue + props.step);
            }
        }
        return () => {
            const data = {
                canDecrement: canDecrement.value,
                canIncrement: canIncrement.value,
                onDecrement,
                onIncrement
            };
            const nodes = props.displayControls
                ? [generateControl(props, data, true), generateInput(props), generateControl(props, data, false)]
                : [generateInput(props)];
            return h('div', { class: ['b-number-input field', getFieldClasses(props.controlsPosition)] }, nodes);
        };
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQk51bWJlcklucHV0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvZm9ybS9udW1iZXJJbnB1dC9CTnVtYmVySW5wdXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxzQkFBc0IsQ0FBQztBQUU5QixPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUNqRixPQUFPLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBYSxNQUFNLG9CQUFvQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxDQUFDLEVBQVMsZUFBZSxFQUFFLG9CQUFvQixFQUE4QixRQUFRLEVBQUUsTUFBTSxLQUFLLENBQUM7QUFDNUcsT0FBTyxPQUFPLE1BQU0sc0JBQXNCLENBQUM7QUFDM0MsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3pDLE9BQU8sRUFBZ0MsbUJBQW1CLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUlwRixNQUFNLDBCQUEwQixHQUFxQjtJQUNuRCxLQUFLLEVBQUUsb0JBQW9CLENBQUMsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLG1CQUFtQixDQUFDLENBQUM7SUFDOUQsSUFBSSxFQUFFLG9CQUFvQixDQUFDLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0NBQzdELENBQUM7QUFFRixNQUFNLDJCQUEyQixHQUFHO0lBQ2xDLEdBQUcsMEJBQTBCLEVBQVU7SUFDdkMsVUFBVSxFQUFFO1FBQ1YsSUFBSSxFQUFFLE1BQTBCO1FBQ2hDLE9BQU8sRUFBRSxDQUFDO0tBQ1g7SUFDRCxxQkFBcUIsRUFBRTtRQUNyQixJQUFJLEVBQUUsUUFBK0M7UUFDckQsT0FBTyxFQUFFLFFBQVEsQ0FBQyxTQUFTLENBQUM7S0FDN0I7SUFDRCxHQUFHLEVBQUU7UUFDSCxJQUFJLEVBQUUsTUFBMEI7UUFDaEMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxnQkFBZ0I7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QUFlLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztnQkFDakcsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDM0IsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsS0FBSyxFQUFFLENBQUMsc0JBQXNCLEVBQUUsZUFBZSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN2RyxDQUFDLENBQUM7SUFDSixDQUFDO0NBQ0YsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICcuL2ItbnVtYmVyaW5wdXQuc2Fzcyc7XG5pbXBvcnQgeyBJTyB9IGZyb20gJ2ZwLXRzL2xpYi9JTyc7XG5pbXBvcnQgeyBnZXRVc2VJbnB1dFByb3BzRGVmaW5pdGlvbiB9IGZyb20gJy4uLy4uLy4uL2NvbXBvc2FibGVzL2lucHV0L3VzZUlucHV0JztcbmltcG9ydCB7IGNvbnN0YW50LCBjb25zdFZvaWQsIEZ1bmN0aW9uTiB9IGZyb20gJ2ZwLXRzL2xpYi9mdW5jdGlvbic7XG5pbXBvcnQgeyBoLCBWTm9kZSwgZGVmaW5lQ29tcG9uZW50LCBkZWZpbmVBc3luY0NvbXBvbmVudCwgUHJvcFR5cGUsIEV4dHJhY3RQcm9wVHlwZXMsIGNvbXB1dGVkIH0gZnJvbSAndnVlJztcbmltcG9ydCBCQnV0dG9uIGZyb20gJy4uLy4uL2J1dHRvbi9CQnV0dG9uJztcbmltcG9ydCB7IEJJbnB1dCB9IGZyb20gJy4uL2lucHV0L0JJbnB1dCc7XG5pbXBvcnQgeyBJbnB1dEljb25zLCBOdW1iZXJJbnB1dEljb25zLCBERUZBVUxUX0lOUFVUX0lDT05TIH0gZnJvbSAnLi4vc2hhcmVkL3R5cGVzJztcblxuZXhwb3J0IHR5cGUgQk51bWJlcklucHV0Q29udHJvbHNQb3NpdGlvbiA9ICdjb21wYWN0JyB8ICcnO1xuXG5jb25zdCBERUZBVUxUX05VTUJFUl9JTlBVVF9JQ09OUzogTnVtYmVySW5wdXRJY29ucyA9IHtcbiAgbWludXM6IGRlZmluZUFzeW5jQ29tcG9uZW50KCgpID0+IGltcG9ydCgnLi4vLi4vaWNvbnMvbWludXMnKSksXG4gIHBsdXM6IGRlZmluZUFzeW5jQ29tcG9uZW50KCgpID0+IGltcG9ydCgnLi4vLi4vaWNvbnMvcGx1cycpKVxufTtcblxuY29uc3QgQk51bWJlcklucHV0UHJvcHNEZWZpbml0aW9uID0ge1xuICAuLi5nZXRVc2VJbnB1dFByb3BzRGVmaW5pdGlvbjxudW1iZXI+KCksXG4gIG1vZGVsVmFsdWU6IHtcbiAgICB0eXBlOiBOdW1iZXIgYXMgUHJvcFR5cGU8bnVtYmVyPixcbiAgICBkZWZhdWx0OiAwXG4gIH0sXG4gICdvblVwZGF0ZTptb2RlbFZhbHVlJzoge1xuICAgIHR5cGU6IEZ1bmN0aW9uIGFzIFByb3BUeXBlPEZ1bmN0aW9uTjxbbnVtYmVyXSwgdm9pZD4+LFxuICAgIGRlZmF1bHQ6IGNvbnN0YW50KGNvbnN0Vm9pZClcbiAgfSxcbiAgbWluOiB7XG4gICAgdHlwZTogTnVtYmVyIGFzIFByb3BUeXBlPG51bWJlcj4sXG4gICAgZGVmYXVsdDogTnVtYmVyLk1JTl9TQUZFX0lOVEVHRVJcbiAgfSxcbiAgbWF4OiB7XG4gICAgdHlwZTogTnVtYmVyIGFzIFByb3BUeXBlPG51bWJlcj4sXG4gICAgZGVmYXVsdDogTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVJcbiAgfSxcbiAgc3RlcDoge1xuICAgIHR5cGU6IE51bWJlciBhcyBQcm9wVHlwZTxudW1iZXI+LFxuICAgIGRlZmF1bHQ6IDFcbiAgfSxcbiAgZGlzcGxheUNvbnRyb2xzOiB7XG4gICAgdHlwZTogQm9vbGVhbiBhcyBQcm9wVHlwZTxib29sZWFuPixcbiAgICBkZWZhdWx0OiB0cnVlXG4gIH0sXG4gIGNvbnRyb2xzUm91bmRlZDoge1xuICAgIHR5cGU6IEJvb2xlYW4gYXMgUHJvcFR5cGU8Ym9vbGVhbj4sXG4gICAgZGVmYXVsdDogZmFsc2VcbiAgfSxcbiAgY29udHJvbHNQb3NpdGlvbjoge1xuICAgIHR5cGU6IFN0cmluZyBhcyBQcm9wVHlwZTxCTnVtYmVySW5wdXRDb250cm9sc1Bvc2l0aW9uPixcbiAgICBkZWZhdWx0OiAnJyBhcyBjb25zdFxuICB9LFxuICBpbnB1dEljb25zOiB7XG4gICAgdHlwZTogT2JqZWN0IGFzIFByb3BUeXBlPElucHV0SWNvbnM+LFxuICAgIGRlZmF1bHQ6IGNvbnN0YW50KERFRkFVTFRfSU5QVVRfSUNPTlMpXG4gIH0sXG4gIG51bWJlcklucHV0SWNvbnM6IHtcbiAgICB0eXBlOiBPYmplY3QgYXMgUHJvcFR5cGU8TnVtYmVySW5wdXRJY29ucz4sXG4gICAgZGVmYXVsdDogY29uc3RhbnQoREVGQVVMVF9OVU1CRVJfSU5QVVRfSUNPTlMpXG4gIH1cbn07XG5cbmV4cG9ydCB0eXBlIEJOdW1iZXJJbnB1dFByb3BzID0gRXh0cmFjdFByb3BUeXBlczx0eXBlb2YgQk51bWJlcklucHV0UHJvcHNEZWZpbml0aW9uPjtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldE51bWJlcklucHV0SWNvbnMoaWNvbnM6IFBhcnRpYWw8TnVtYmVySW5wdXRJY29ucz4pOiBOdW1iZXJJbnB1dEljb25zIHtcbiAgcmV0dXJuIHsgLi4uREVGQVVMVF9OVU1CRVJfSU5QVVRfSUNPTlMsIC4uLmljb25zIH07XG59XG5cbmZ1bmN0aW9uIGdldEZpZWxkQ2xhc3Nlcyhjb250cm9sc1Bvc2l0aW9uOiBCTnVtYmVySW5wdXRDb250cm9sc1Bvc2l0aW9uKSB7XG4gIGNvbnN0IGlzQ29tcGFjdCA9IGNvbnRyb2xzUG9zaXRpb24gPT09ICdjb21wYWN0JztcbiAgcmV0dXJuIHtcbiAgICAnaGFzLWFkZG9ucyc6IGlzQ29tcGFjdCxcbiAgICAnaXMtZ3JvdXBlZCc6ICFpc0NvbXBhY3RcbiAgfTtcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVDb250cm9sKHByb3BzOiBCTnVtYmVySW5wdXRQcm9wcywgZGF0YTogQk51bWJlcklucHV0RGF0YSwgaXNEZWNyZW1lbnQ6IGJvb2xlYW4pOiBWTm9kZSB7XG4gIHJldHVybiBoKFxuICAgICdwJyxcbiAgICB7XG4gICAgICBjbGFzczogJ2NvbnRyb2wnXG4gICAgfSxcbiAgICBbXG4gICAgICBoKFxuICAgICAgICBCQnV0dG9uLFxuICAgICAgICB7XG4gICAgICAgICAgdmFyaWFudDogcHJvcHMudmFyaWFudCxcbiAgICAgICAgICBzaXplOiBwcm9wcy5zaXplLFxuICAgICAgICAgIGlzUm91bmRlZDogcHJvcHMuY29udHJvbHNSb3VuZGVkLFxuICAgICAgICAgIGlzRGlzYWJsZWQ6IGlzRGVjcmVtZW50ID8gIWRhdGEuY2FuRGVjcmVtZW50IDogIWRhdGEuY2FuSW5jcmVtZW50LFxuICAgICAgICAgIG9uQ2xpY2s6IGlzRGVjcmVtZW50ID8gZGF0YS5vbkRlY3JlbWVudCA6IGRhdGEub25JbmNyZW1lbnRcbiAgICAgICAgfSxcbiAgICAgICAgKCkgPT5cbiAgICAgICAgICBoKChpc0RlY3JlbWVudCA/IHByb3BzLm51bWJlcklucHV0SWNvbnMubWludXMgOiBwcm9wcy5udW1iZXJJbnB1dEljb25zLnBsdXMpIGFzIGFueSwge1xuICAgICAgICAgICAgc2l6ZTogcHJvcHMuc2l6ZVxuICAgICAgICAgIH0pXG4gICAgICApXG4gICAgXVxuICApO1xufVxuXG5mdW5jdGlvbiBnZW5lcmF0ZUlucHV0KHByb3BzOiBCTnVtYmVySW5wdXRQcm9wcyk6IFZOb2RlIHtcbiAgcmV0dXJuIGgoQklucHV0LCB7XG4gICAgbW9kZWxWYWx1ZTogcHJvcHMubW9kZWxWYWx1ZSxcbiAgICAnb25VcGRhdGU6bW9kZWxWYWx1ZSc6IHByb3BzWydvblVwZGF0ZTptb2RlbFZhbHVlJ10sXG4gICAgdHlwZTogJ251bWJlcicsXG4gICAgc2l6ZTogcHJvcHMuc2l6ZSxcbiAgICBpbnB1dEljb25zOiBwcm9wcy5pbnB1dEljb25zLFxuICAgIGlzUmVhZG9ubHk6IHByb3BzLmlzUmVhZG9ubHksXG4gICAgaXNMb2FkaW5nOiBwcm9wcy5pc0xvYWRpbmcsXG4gICAgaXNSb3VuZGVkOiBwcm9wcy5pc1JvdW5kZWQsXG4gICAgaWNvbjogcHJvcHMuaWNvbixcbiAgICBpc0V4cGFuZGVkOiBwcm9wcy5pc0V4cGFuZGVkLFxuICAgIHN0ZXA6IHByb3BzLnN0ZXAsXG4gICAgbWF4OiBwcm9wcy5tYXgsXG4gICAgbWluOiBwcm9wcy5taW5cbiAgfSk7XG59XG5cbmludGVyZmFjZSBCTnVtYmVySW5wdXREYXRhIHtcbiAgY2FuSW5jcmVtZW50OiBib29sZWFuO1xuICBvbkRlY3JlbWVudDogSU88dm9pZD47XG4gIG9uSW5jcmVtZW50OiBJTzx2b2lkPjtcbiAgY2FuRGVjcmVtZW50OiBib29sZWFuO1xufVxuXG5leHBvcnQgZGVmYXVsdCBkZWZpbmVDb21wb25lbnQoe1xuICBuYW1lOiAnYi1udW1iZXItaW5wdXQnLFxuICBwcm9wczogQk51bWJlcklucHV0UHJvcHNEZWZpbml0aW9uLFxuICBzZXR1cChwcm9wcykge1xuICAgIGNvbnN0IGNhbkRlY3JlbWVudCA9IGNvbXB1dGVkKCgpID0+IHByb3BzLm1vZGVsVmFsdWUgLSBwcm9wcy5zdGVwID4gcHJvcHMubWluKTtcbiAgICBmdW5jdGlvbiBvbkRlY3JlbWVudCgpIHtcbiAgICAgIGlmIChjYW5EZWNyZW1lbnQudmFsdWUpIHtcbiAgICAgICAgcHJvcHNbJ29uVXBkYXRlOm1vZGVsVmFsdWUnXShwcm9wcy5tb2RlbFZhbHVlIC0gcHJvcHMuc3RlcCk7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGNhbkluY3JlbWVudCA9IGNvbXB1dGVkKCgpID0+IHByb3BzLm1vZGVsVmFsdWUgKyBwcm9wcy5zdGVwIDwgcHJvcHMubWF4KTtcbiAgICBmdW5jdGlvbiBvbkluY3JlbWVudCgpIHtcbiAgICAgIGlmIChjYW5JbmNyZW1lbnQudmFsdWUpIHtcbiAgICAgICAgcHJvcHNbJ29uVXBkYXRlOm1vZGVsVmFsdWUnXShwcm9wcy5tb2RlbFZhbHVlICsgcHJvcHMuc3RlcCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGE6IEJOdW1iZXJJbnB1dERhdGEgPSB7XG4gICAgICAgIGNhbkRlY3JlbWVudDogY2FuRGVjcmVtZW50LnZhbHVlLFxuICAgICAgICBjYW5JbmNyZW1lbnQ6IGNhbkluY3JlbWVudC52YWx1ZSxcbiAgICAgICAgb25EZWNyZW1lbnQsXG4gICAgICAgIG9uSW5jcmVtZW50XG4gICAgICB9O1xuICAgICAgY29uc3Qgbm9kZXMgPSBwcm9wcy5kaXNwbGF5Q29udHJvbHNcbiAgICAgICAgPyBbZ2VuZXJhdGVDb250cm9sKHByb3BzLCBkYXRhLCB0cnVlKSwgZ2VuZXJhdGVJbnB1dChwcm9wcyksIGdlbmVyYXRlQ29udHJvbChwcm9wcywgZGF0YSwgZmFsc2UpXVxuICAgICAgICA6IFtnZW5lcmF0ZUlucHV0KHByb3BzKV07XG4gICAgICByZXR1cm4gaCgnZGl2JywgeyBjbGFzczogWydiLW51bWJlci1pbnB1dCBmaWVsZCcsIGdldEZpZWxkQ2xhc3Nlcyhwcm9wcy5jb250cm9sc1Bvc2l0aW9uKV0gfSwgbm9kZXMpO1xuICAgIH07XG4gIH1cbn0pO1xuIl19
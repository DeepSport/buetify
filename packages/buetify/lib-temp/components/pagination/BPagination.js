import './pagination.sass';
import { extractPaginationState, usePagination, UsePaginationPropsDefinition } from '../../composables/pagination';
import { DefaultThemePropsDefinition, useTheme } from '../../composables/theme';
import AngleLeftIcon from '../icons/angleLeft/AngleLeftIcon';
import AngleRightIcon from '../icons/angleRight/AngleRightIcon';
import { range } from 'fp-ts/lib/Array';
import { defineComponent, h } from 'vue';
export const BPaginationPropsDefinition = {
    ...UsePaginationPropsDefinition,
    ...DefaultThemePropsDefinition,
    size: {
        type: String,
        default: ''
    },
    isSimple: {
        type: Boolean,
        default: false
    },
    isRounded: {
        type: Boolean,
        default: false
    },
    position: {
        type: String,
        default: ''
    }
};
function getAriaLabel(num, total) {
    return `Go to page ${num} of ${total}`;
}
const ellipsis = h('li', [
    h('span', {
        class: 'pagination-ellipsis',
        innerHTML: `&hellip;`
    })
]);
function generatePreviousButton(context, pagination, themeClasses) {
    return h('button', {
        class: ['pagination-previous', ...themeClasses],
        disabled: pagination.hasPrevious.value,
        'aria-label': getAriaLabel(pagination.previousPage.value, pagination.numberOfPages.value),
        onClick: pagination.previous
    }, context.slots.previous ? context.slots.previous() : h(AngleLeftIcon));
}
function generateNextButton(context, pagination, themeClasses) {
    return h('button', {
        class: ['pagination-next', ...themeClasses],
        disabled: pagination.hasNext.value,
        'aria-label': getAriaLabel(pagination.nextPage.value, pagination.numberOfPages.value),
        onClick: pagination.next
    }, context.slots.next ? context.slots.next() : h(AngleRightIcon));
}
function getGeneratePaginationListItem(pagination, themeClasses) {
    return (page) => h('li', {
        key: page.number
    }, [
        h('button', {
            class: ['pagination-link', ...themeClasses, { 'is-current': page.isCurrent }],
            'aria-label': getAriaLabel(page.number, pagination.numberOfPages.value),
            'aria-current': page.isCurrent,
            onClick: (e) => {
                e.preventDefault();
                pagination.set(page.number);
            }
        }, `${page.number}`)
    ]);
}
function getPageRange(props, pagination) {
    if (props.isSimple) {
        return [];
    }
    else {
        const currentValue = pagination.current.value;
        const numberOfPages = pagination.numberOfPages.value;
        const left = currentValue === numberOfPages ? numberOfPages - 3 : Math.max(0, currentValue - 2); // internal value is 1 indexed
        const right = Math.min(left + 3, numberOfPages);
        return range(1, numberOfPages)
            .map(number => ({
            number,
            isCurrent: number === currentValue
        }))
            .slice(left, right);
    }
}
function generatePaginationList(props, pagination, themeClasses) {
    const generatePaginationListItem = getGeneratePaginationListItem(pagination, themeClasses);
    const currentValue = pagination.current.value;
    const numberOfPages = pagination.numberOfPages.value;
    const nodes = getPageRange(props, pagination).map(generatePaginationListItem);
    if (currentValue >= 5) {
        nodes.unshift(ellipsis);
    }
    if (currentValue >= 3) {
        nodes.unshift(generatePaginationListItem({ number: 1, isCurrent: currentValue === 1 }));
    }
    if (currentValue < numberOfPages - 3) {
        nodes.push(ellipsis);
    }
    if (currentValue <= numberOfPages - 2) {
        nodes.push(generatePaginationListItem({ number: numberOfPages, isCurrent: currentValue === numberOfPages }));
    }
    return h('ul', { class: 'pagination-list' }, nodes);
}
function generateSimpleSummary(props, pagination) {
    return h('small', { class: 'info' }, props.perPage === 1
        ? `${pagination.after.value + 1} / ${props.total}`
        : `${pagination.after.value + 1} - ${Math.min(pagination.after.value + props.perPage, props.total || 0)} / ${props.total || 0}`);
}
function generatePaginationControls(props, context, pagination, themeClasses) {
    return h('section', {
        'aria-label': 'Pagination Controls',
        class: ['pagination', props.position, props.size, { 'is-simple': props.isSimple, 'is-rounded': props.isRounded }]
    }, props.isSimple
        ? [
            generatePreviousButton(context, pagination, themeClasses),
            generateNextButton(context, pagination, themeClasses),
            generateSimpleSummary(props, pagination)
        ]
        : [
            generatePreviousButton(context, pagination, themeClasses),
            generateNextButton(context, pagination, themeClasses),
            generatePaginationList(props, pagination, themeClasses)
        ]);
}
export default defineComponent({
    name: 'b-pagination',
    props: BPaginationPropsDefinition,
    setup(props, context) {
        const pagination = usePagination(props);
        const { themeClasses } = useTheme(props);
        return () => {
            return context.slots.default
                ? h('article', [
                    context.slots.default(extractPaginationState(pagination)),
                    generatePaginationControls(props, context, pagination, themeClasses.value)
                ])
                : [generatePaginationControls(props, context, pagination, themeClasses.value)];
        };
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQlBhZ2luYXRpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9wYWdpbmF0aW9uL0JQYWdpbmF0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sbUJBQW1CLENBQUM7QUFDM0IsT0FBTyxFQUNMLHNCQUFzQixFQUV0QixhQUFhLEVBQ2IsNEJBQTRCLEVBQzdCLE1BQU0sOEJBQThCLENBQUM7QUFDdEMsT0FBTyxFQUFFLDJCQUEyQixFQUFFLFFBQVEsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ2hGLE9BQU8sYUFBYSxNQUFNLGtDQUFrQyxDQUFDO0FBQzdELE9BQU8sY0FBYyxNQUFNLG9DQUFvQyxDQUFDO0FBQ2hFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN4QyxPQUFPLEVBQW1CLGVBQWUsRUFBb0IsQ0FBQyxFQUFnQixNQUFNLEtBQUssQ0FBQztBQU0xRixNQUFNLENBQUMsTUFBTSwwQkFBMEIsR0FBRztJQUN4QyxHQUFHLDRCQUE0QjtJQUMvQixHQUFHLDJCQUEyQjtJQUM5QixJQUFJLEVBQUU7UUFDSixJQUFJLEVBQUUsTUFBa0M7UUFDeEMsT0FBTyxFQUFFLEVBQVc7S0FDckI7SUFDRCxRQUFRLEVBQUU7UUFDUixJQUFJLEVBQUUsT0FBNEI7UUFDbEMsT0FBTyxFQUFFLEtBQUs7S0FDZjtJQUNELFNBQVMsRUFBRTtRQUNULElBQUksRUFBRSxPQUE0QjtRQUNsQyxPQUFPLEVBQUUsS0FBSztLQUNmO0lBQ0QsUUFBUSxFQUFFO1FBQ1IsSUFBSSxFQUFFLE1BQXNDO1FBQzVDLE9BQU8sRUFBRSxFQUFXO0tBQ3JCO0NBQ0YsQ0FBQztBQUlGLFNBQVMsWUFBWSxDQUFDLEdBQVcsRUFBRSxLQUFhO0lBQzlDLE9BQU8sY0FBYyxHQUFHLE9BQU8sS0FBSyxFQUFFLENBQUM7QUFDekMsQ0FBQztBQUVELE1BQU0sUUFBUSxHQUFHLENBQUMsQ0FBQyxJQUFJ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RSxVQUFVLEVBQUUsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDbkYsQ0FBQyxDQUFDO0lBQ0osQ0FBQztDQUNGLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnLi9wYWdpbmF0aW9uLnNhc3MnO1xuaW1wb3J0IHtcbiAgZXh0cmFjdFBhZ2luYXRpb25TdGF0ZSxcbiAgUGFnaW5hdGlvbixcbiAgdXNlUGFnaW5hdGlvbixcbiAgVXNlUGFnaW5hdGlvblByb3BzRGVmaW5pdGlvblxufSBmcm9tICcuLi8uLi9jb21wb3NhYmxlcy9wYWdpbmF0aW9uJztcbmltcG9ydCB7IERlZmF1bHRUaGVtZVByb3BzRGVmaW5pdGlvbiwgdXNlVGhlbWUgfSBmcm9tICcuLi8uLi9jb21wb3NhYmxlcy90aGVtZSc7XG5pbXBvcnQgQW5nbGVMZWZ0SWNvbiBmcm9tICcuLi9pY29ucy9hbmdsZUxlZnQvQW5nbGVMZWZ0SWNvbic7XG5pbXBvcnQgQW5nbGVSaWdodEljb24gZnJvbSAnLi4vaWNvbnMvYW5nbGVSaWdodC9BbmdsZVJpZ2h0SWNvbic7XG5pbXBvcnQgeyByYW5nZSB9IGZyb20gJ2ZwLXRzL2xpYi9BcnJheSc7XG5pbXBvcnQgeyBWTm9kZSwgUHJvcFR5cGUsIGRlZmluZUNvbXBvbmVudCwgRXh0cmFjdFByb3BUeXBlcywgaCwgU2V0dXBDb250ZXh0IH0gZnJvbSAndnVlJztcblxuZXhwb3J0IHR5cGUgUGFnaW5hdGlvblNpemUgPSAnaXMtc21hbGwnIHwgJ2lzLW1lZGl1bScgfCAnaXMtbGFyZ2UnIHwgJyc7XG5cbmV4cG9ydCB0eXBlIFBhZ2luYXRpb25Qb3NpdGlvbiA9ICdpcy1jZW50ZXJlZCcgfCAnaXMtcmlnaHQnIHwgJyc7XG5cbmV4cG9ydCBjb25zdCBCUGFnaW5hdGlvblByb3BzRGVmaW5pdGlvbiA9IHtcbiAgLi4uVXNlUGFnaW5hdGlvblByb3BzRGVmaW5pdGlvbixcbiAgLi4uRGVmYXVsdFRoZW1lUHJvcHNEZWZpbml0aW9uLFxuICBzaXplOiB7XG4gICAgdHlwZTogU3RyaW5nIGFzIFByb3BUeXBlPFBhZ2luYXRpb25TaXplPixcbiAgICBkZWZhdWx0OiAnJyBhcyBjb25zdFxuICB9LFxuICBpc1NpbXBsZToge1xuICAgIHR5cGU6IEJvb2xlYW4gYXMgUHJvcFR5cGU8Ym9vbGVhbj4sXG4gICAgZGVmYXVsdDogZmFsc2VcbiAgfSxcbiAgaXNSb3VuZGVkOiB7XG4gICAgdHlwZTogQm9vbGVhbiBhcyBQcm9wVHlwZTxib29sZWFuPixcbiAgICBkZWZhdWx0OiBmYWxzZVxuICB9LFxuICBwb3NpdGlvbjoge1xuICAgIHR5cGU6IFN0cmluZyBhcyBQcm9wVHlwZTxQYWdpbmF0aW9uUG9zaXRpb24+LFxuICAgIGRlZmF1bHQ6ICcnIGFzIGNvbnN0XG4gIH1cbn07XG5cbmV4cG9ydCB0eXBlIEJQYWdpbmF0aW9uUHJvcHMgPSBFeHRyYWN0UHJvcFR5cGVzPHR5cGVvZiBCUGFnaW5hdGlvblByb3BzRGVmaW5pdGlvbj47XG5cbmZ1bmN0aW9uIGdldEFyaWFMYWJlbChudW06IG51bWJlciwgdG90YWw6IG51bWJlcik6IHN0cmluZyB7XG4gIHJldHVybiBgR28gdG8gcGFnZSAke251bX0gb2YgJHt0b3RhbH1gO1xufVxuXG5jb25zdCBlbGxpcHNpcyA9IGgoJ2xpJywgW1xuICBoKCdzcGFuJywge1xuICAgIGNsYXNzOiAncGFnaW5hdGlvbi1lbGxpcHNpcycsXG4gICAgaW5uZXJIVE1MOiBgJmhlbGxpcDtgXG4gIH0pXG5dKTtcblxuZnVuY3Rpb24gZ2VuZXJhdGVQcmV2aW91c0J1dHRvbihjb250ZXh0OiBTZXR1cENvbnRleHQsIHBhZ2luYXRpb246IFBhZ2luYXRpb24sIHRoZW1lQ2xhc3Nlczogc3RyaW5nW10pOiBWTm9kZSB7XG4gIHJldHVybiBoKFxuICAgICdidXR0b24nLFxuICAgIHtcbiAgICAgIGNsYXNzOiBbJ3BhZ2luYXRpb24tcHJldmlvdXMnLCAuLi50aGVtZUNsYXNzZXNdLFxuICAgICAgZGlzYWJsZWQ6IHBhZ2luYXRpb24uaGFzUHJldmlvdXMudmFsdWUsXG4gICAgICAnYXJpYS1sYWJlbCc6IGdldEFyaWFMYWJlbChwYWdpbmF0aW9uLnByZXZpb3VzUGFnZS52YWx1ZSwgcGFnaW5hdGlvbi5udW1iZXJPZlBhZ2VzLnZhbHVlKSxcbiAgICAgIG9uQ2xpY2s6IHBhZ2luYXRpb24ucHJldmlvdXNcbiAgICB9LFxuICAgIGNvbnRleHQuc2xvdHMucHJldmlvdXMgPyBjb250ZXh0LnNsb3RzLnByZXZpb3VzKCkgOiBoKEFuZ2xlTGVmdEljb24pXG4gICk7XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlTmV4dEJ1dHRvbihjb250ZXh0OiBTZXR1cENvbnRleHQsIHBhZ2luYXRpb246IFBhZ2luYXRpb24sIHRoZW1lQ2xhc3Nlczogc3RyaW5nW10pOiBWTm9kZSB7XG4gIHJldHVybiBoKFxuICAgICdidXR0b24nLFxuICAgIHtcbiAgICAgIGNsYXNzOiBbJ3BhZ2luYXRpb24tbmV4dCcsIC4uLnRoZW1lQ2xhc3Nlc10sXG4gICAgICBkaXNhYmxlZDogcGFnaW5hdGlvbi5oYXNOZXh0LnZhbHVlLFxuICAgICAgJ2FyaWEtbGFiZWwnOiBnZXRBcmlhTGFiZWwocGFnaW5hdGlvbi5uZXh0UGFnZS52YWx1ZSwgcGFnaW5hdGlvbi5udW1iZXJPZlBhZ2VzLnZhbHVlKSxcbiAgICAgIG9uQ2xpY2s6IHBhZ2luYXRpb24ubmV4dFxuICAgIH0sXG4gICAgY29udGV4dC5zbG90cy5uZXh0ID8gY29udGV4dC5zbG90cy5uZXh0KCkgOiBoKEFuZ2xlUmlnaHRJY29uKVxuICApO1xufVxuXG5mdW5jdGlvbiBnZXRHZW5lcmF0ZVBhZ2luYXRpb25MaXN0SXRlbShwYWdpbmF0aW9uOiBQYWdpbmF0aW9uLCB0aGVtZUNsYXNzZXM6IHN0cmluZ1tdKSB7XG4gIHJldHVybiAocGFnZTogUGFnZSkgPT5cbiAgICBoKFxuICAgICAgJ2xpJyxcbiAgICAgIHtcbiAgICAgICAga2V5OiBwYWdlLm51bWJlclxuICAgICAgfSxcbiAgICAgIFtcbiAgICAgICAgaChcbiAgICAgICAgICAnYnV0dG9uJyxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBjbGFzczogWydwYWdpbmF0aW9uLWxpbmsnLCAuLi50aGVtZUNsYXNzZXMsIHsgJ2lzLWN1cnJlbnQnOiBwYWdlLmlzQ3VycmVudCB9XSxcbiAgICAgICAgICAgICdhcmlhLWxhYmVsJzogZ2V0QXJpYUxhYmVsKHBhZ2UubnVtYmVyLCBwYWdpbmF0aW9uLm51bWJlck9mUGFnZXMudmFsdWUpLFxuICAgICAgICAgICAgJ2FyaWEtY3VycmVudCc6IHBhZ2UuaXNDdXJyZW50LFxuICAgICAgICAgICAgb25DbGljazogKGU6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICBwYWdpbmF0aW9uLnNldChwYWdlLm51bWJlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBgJHtwYWdlLm51bWJlcn1gXG4gICAgICAgIClcbiAgICAgIF1cbiAgICApO1xufVxuXG5mdW5jdGlvbiBnZXRQYWdlUmFuZ2UocHJvcHM6IEJQYWdpbmF0aW9uUHJvcHMsIHBhZ2luYXRpb246IFBhZ2luYXRpb24pOiBQYWdlW10ge1xuICBpZiAocHJvcHMuaXNTaW1wbGUpIHtcbiAgICByZXR1cm4gW107XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgY3VycmVudFZhbHVlID0gcGFnaW5hdGlvbi5jdXJyZW50LnZhbHVlO1xuICAgIGNvbnN0IG51bWJlck9mUGFnZXMgPSBwYWdpbmF0aW9uLm51bWJlck9mUGFnZXMudmFsdWU7XG4gICAgY29uc3QgbGVmdCA9IGN1cnJlbnRWYWx1ZSA9PT0gbnVtYmVyT2ZQYWdlcyA/IG51bWJlck9mUGFnZXMgLSAzIDogTWF0aC5tYXgoMCwgKGN1cnJlbnRWYWx1ZSBhcyBudW1iZXIpIC0gMik7IC8vIGludGVybmFsIHZhbHVlIGlzIDEgaW5kZXhlZFxuICAgIGNvbnN0IHJpZ2h0ID0gTWF0aC5taW4obGVmdCArIDMsIG51bWJlck9mUGFnZXMpO1xuICAgIHJldHVybiByYW5nZSgxLCBudW1iZXJPZlBhZ2VzKVxuICAgICAgLm1hcChudW1iZXIgPT4gKHtcbiAgICAgICAgbnVtYmVyLFxuICAgICAgICBpc0N1cnJlbnQ6IG51bWJlciA9PT0gY3VycmVudFZhbHVlXG4gICAgICB9KSlcbiAgICAgIC5zbGljZShsZWZ0LCByaWdodCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVQYWdpbmF0aW9uTGlzdChwcm9wczogQlBhZ2luYXRpb25Qcm9wcywgcGFnaW5hdGlvbjogUGFnaW5hdGlvbiwgdGhlbWVDbGFzc2VzOiBzdHJpbmdbXSk6IFZOb2RlIHtcbiAgY29uc3QgZ2VuZXJhdGVQYWdpbmF0aW9uTGlzdEl0ZW0gPSBnZXRHZW5lcmF0ZVBhZ2luYXRpb25MaXN0SXRlbShwYWdpbmF0aW9uLCB0aGVtZUNsYXNzZXMpO1xuICBjb25zdCBjdXJyZW50VmFsdWUgPSBwYWdpbmF0aW9uLmN1cnJlbnQudmFsdWU7XG4gIGNvbnN0IG51bWJlck9mUGFnZXMgPSBwYWdpbmF0aW9uLm51bWJlck9mUGFnZXMudmFsdWU7XG4gIGNvbnN0IG5vZGVzOiBWTm9kZVtdID0gZ2V0UGFnZVJhbmdlKHByb3BzLCBwYWdpbmF0aW9uKS5tYXAoZ2VuZXJhdGVQYWdpbmF0aW9uTGlzdEl0ZW0pO1xuICBpZiAoY3VycmVudFZhbHVlID49IDUpIHtcbiAgICBub2Rlcy51bnNoaWZ0KGVsbGlwc2lzKTtcbiAgfVxuICBpZiAoY3VycmVudFZhbHVlID49IDMpIHtcbiAgICBub2Rlcy51bnNoaWZ0KGdlbmVyYXRlUGFnaW5hdGlvbkxpc3RJdGVtKHsgbnVtYmVyOiAxLCBpc0N1cnJlbnQ6IGN1cnJlbnRWYWx1ZSA9PT0gMSB9KSk7XG4gIH1cbiAgaWYgKGN1cnJlbnRWYWx1ZSA8IG51bWJlck9mUGFnZXMgLSAzKSB7XG4gICAgbm9kZXMucHVzaChlbGxpcHNpcyk7XG4gIH1cbiAgaWYgKGN1cnJlbnRWYWx1ZSA8PSBudW1iZXJPZlBhZ2VzIC0gMikge1xuICAgIG5vZGVzLnB1c2goZ2VuZXJhdGVQYWdpbmF0aW9uTGlzdEl0ZW0oeyBudW1iZXI6IG51bWJlck9mUGFnZXMsIGlzQ3VycmVudDogY3VycmVudFZhbHVlID09PSBudW1iZXJPZlBhZ2VzIH0pKTtcbiAgfVxuICByZXR1cm4gaCgndWwnLCB7IGNsYXNzOiAncGFnaW5hdGlvbi1saXN0JyB9LCBub2Rlcyk7XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlU2ltcGxlU3VtbWFyeShwcm9wczogQlBhZ2luYXRpb25Qcm9wcywgcGFnaW5hdGlvbjogUGFnaW5hdGlvbik6IFZOb2RlIHtcbiAgcmV0dXJuIGgoXG4gICAgJ3NtYWxsJyxcbiAgICB7IGNsYXNzOiAnaW5mbycgfSxcbiAgICBwcm9wcy5wZXJQYWdlID09PSAxXG4gICAgICA/IGAke3BhZ2luYXRpb24uYWZ0ZXIudmFsdWUgKyAxfSAvICR7cHJvcHMudG90YWx9YFxuICAgICAgOiBgJHtwYWdpbmF0aW9uLmFmdGVyLnZhbHVlICsgMX0gLSAke01hdGgubWluKFxuICAgICAgICAgIHBhZ2luYXRpb24uYWZ0ZXIudmFsdWUgKyBwcm9wcy5wZXJQYWdlLFxuICAgICAgICAgIHByb3BzLnRvdGFsIHx8IDBcbiAgICAgICAgKX0gLyAke3Byb3BzLnRvdGFsIHx8IDB9YFxuICApO1xufVxuXG5mdW5jdGlvbiBnZW5lcmF0ZVBhZ2luYXRpb25Db250cm9scyhcbiAgcHJvcHM6IEJQYWdpbmF0aW9uUHJvcHMsXG4gIGNvbnRleHQ6IFNldHVwQ29udGV4dCxcbiAgcGFnaW5hdGlvbjogUGFnaW5hdGlvbixcbiAgdGhlbWVDbGFzc2VzOiBzdHJpbmdbXVxuKTogVk5vZGUge1xuICByZXR1cm4gaChcbiAgICAnc2VjdGlvbicsXG4gICAge1xuICAgICAgJ2FyaWEtbGFiZWwnOiAnUGFnaW5hdGlvbiBDb250cm9scycsXG4gICAgICBjbGFzczogWydwYWdpbmF0aW9uJywgcHJvcHMucG9zaXRpb24sIHByb3BzLnNpemUsIHsgJ2lzLXNpbXBsZSc6IHByb3BzLmlzU2ltcGxlLCAnaXMtcm91bmRlZCc6IHByb3BzLmlzUm91bmRlZCB9XVxuICAgIH0sXG4gICAgcHJvcHMuaXNTaW1wbGVcbiAgICAgID8gW1xuICAgICAgICAgIGdlbmVyYXRlUHJldmlvdXNCdXR0b24oY29udGV4dCwgcGFnaW5hdGlvbiwgdGhlbWVDbGFzc2VzKSxcbiAgICAgICAgICBnZW5lcmF0ZU5leHRCdXR0b24oY29udGV4dCwgcGFnaW5hdGlvbiwgdGhlbWVDbGFzc2VzKSxcbiAgICAgICAgICBnZW5lcmF0ZVNpbXBsZVN1bW1hcnkocHJvcHMsIHBhZ2luYXRpb24pXG4gICAgICAgIF1cbiAgICAgIDogW1xuICAgICAgICAgIGdlbmVyYXRlUHJldmlvdXNCdXR0b24oY29udGV4dCwgcGFnaW5hdGlvbiwgdGhlbWVDbGFzc2VzKSxcbiAgICAgICAgICBnZW5lcmF0ZU5leHRCdXR0b24oY29udGV4dCwgcGFnaW5hdGlvbiwgdGhlbWVDbGFzc2VzKSxcbiAgICAgICAgICBnZW5lcmF0ZVBhZ2luYXRpb25MaXN0KHByb3BzLCBwYWdpbmF0aW9uLCB0aGVtZUNsYXNzZXMpXG4gICAgICAgIF1cbiAgKTtcbn1cblxuaW50ZXJmYWNlIFBhZ2Uge1xuICBudW1iZXI6IG51bWJlcjtcbiAgaXNDdXJyZW50OiBib29sZWFuO1xufVxuXG5leHBvcnQgZGVmYXVsdCBkZWZpbmVDb21wb25lbnQoe1xuICBuYW1lOiAnYi1wYWdpbmF0aW9uJyxcbiAgcHJvcHM6IEJQYWdpbmF0aW9uUHJvcHNEZWZpbml0aW9uLFxuICBzZXR1cChwcm9wcywgY29udGV4dCkge1xuICAgIGNvbnN0IHBhZ2luYXRpb24gPSB1c2VQYWdpbmF0aW9uKHByb3BzKTtcbiAgICBjb25zdCB7IHRoZW1lQ2xhc3NlcyB9ID0gdXNlVGhlbWUocHJvcHMpO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICByZXR1cm4gY29udGV4dC5zbG90cy5kZWZhdWx0XG4gICAgICAgID8gaCgnYXJ0aWNsZScsIFtcbiAgICAgICAgICAgIGNvbnRleHQuc2xvdHMuZGVmYXVsdChleHRyYWN0UGFnaW5hdGlvblN0YXRlKHBhZ2luYXRpb24pKSxcbiAgICAgICAgICAgIGdlbmVyYXRlUGFnaW5hdGlvbkNvbnRyb2xzKHByb3BzLCBjb250ZXh0LCBwYWdpbmF0aW9uLCB0aGVtZUNsYXNzZXMudmFsdWUpXG4gICAgICAgICAgXSlcbiAgICAgICAgOiBbZ2VuZXJhdGVQYWdpbmF0aW9uQ29udHJvbHMocHJvcHMsIGNvbnRleHQsIHBhZ2luYXRpb24sIHRoZW1lQ2xhc3Nlcy52YWx1ZSldO1xuICAgIH07XG4gIH1cbn0pO1xuIl19
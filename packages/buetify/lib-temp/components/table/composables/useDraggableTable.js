import { isNone, isSome, none, some } from 'fp-ts/lib/Option';
import { shallowRef } from 'vue';
import { constant, constVoid } from 'fp-ts/lib/function';
import { eqBTableRow } from '../shared';
export const BTableDraggablePropsDefinition = {
    isDraggable: {
        type: Boolean,
        default: false
    },
    dropEffect: {
        type: String,
        default: 'move'
    },
    onDragstart: {
        type: Function,
        default: constant(constVoid)
    },
    onDragenter: {
        type: Function,
        default: constant(constVoid)
    },
    onDragover: {
        type: Function,
        default: constant(constVoid)
    },
    onDragleave: {
        type: Function,
        default: constant(constVoid)
    },
    onDragend: {
        type: Function,
        default: constant(constVoid)
    },
    onDrop: {
        type: Function,
        default: constant(constVoid)
    }
};
export function useDraggableTable(props) {
    const dragIsActive = shallowRef(false);
    const dropTarget = shallowRef(none);
    function getOnDragStartListener(row, index) {
        return (e) => {
            dragIsActive.value = true;
            if (e.dataTransfer) {
                e.dataTransfer.setData('text/plain', String(index));
                e.dataTransfer.dropEffect = props.dropEffect;
            }
            dropTarget.value = some(row);
            props.onDragstart(row, e, index);
        };
    }
    function getOnDropListener(row, index) {
        return (e) => {
            if (row.isDroppable) {
                e.preventDefault();
                props.onDrop(row, e, index);
            }
            dragIsActive.value = false;
        };
    }
    function getOnDragEnterListener(row, index) {
        return (e) => {
            if (row.isDroppable) {
                e.preventDefault();
                dropTarget.value = some(row);
                props.onDragenter(row, e, index);
            }
        };
    }
    function getOnDragOverListener(row, index) {
        return (e) => {
            if (row.isDroppable) {
                e.preventDefault();
                const target = dropTarget.value;
                if (isNone(target) || (isSome(target) && !eqBTableRow.equals(target.value, row))) {
                    dropTarget.value = some(row);
                }
                props.onDragover(row, e, index);
            }
        };
    }
    function getOnDragLeaveListener(row, index) {
        return (e) => {
            if (row.isDroppable) {
                e.preventDefault();
                const target = dropTarget.value;
                if (isSome(target) && eqBTableRow.equals(target.value, row)) {
                    dropTarget.value = none;
                }
                props.onDragleave(row, e, index);
            }
        };
    }
    function getOnDragEndListener(row, index) {
        return e => {
            props.onDragend(row, e, index);
            if (isSome(dropTarget.value)) {
                dropTarget.value = none;
            }
            dragIsActive.value = false;
        };
    }
    function getRowDragListeners(row, index) {
        if (row.isDraggable) {
            return {
                onDragstart: getOnDragStartListener(row, index),
                onDrop: getOnDropListener(row, index),
                onDragenter: getOnDragEnterListener(row, index),
                onDragleave: getOnDragLeaveListener(row, index),
                onDragover: getOnDragOverListener(row, index),
                onDragend: getOnDragEndListener(row, index)
            };
        }
        else {
            return {};
        }
    }
    return {
        getRowDragListeners,
        dragIsActive,
        dropTarget
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlRHJhZ2dhYmxlVGFibGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy90YWJsZS9jb21wb3NhYmxlcy91c2VEcmFnZ2FibGVUYWJsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQVUsSUFBSSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDdEUsT0FBTyxFQUFvQixVQUFVLEVBQUUsTUFBTSxLQUFLLENBQUM7QUFDbkQsT0FBTyxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQWEsTUFBTSxvQkFBb0IsQ0FBQztBQUdwRSxPQUFPLEVBQTRCLFdBQVcsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQVFsRSxNQUFNLENBQUMsTUFBTSw4QkFBOEIsR0FBRztJQUM1QyxXQUFXLEVBQUU7UUFDWCxJQUFJLEVBQUUsT0FBTztRQUNiLE9BQU8sRUFBRSxLQUFLO0tBQ2Y7SUFDRCxVQUFVLEVBQUU7UUFDVixJQUFJLEVBQUUsTUFBOEI7UUFDcEMsT0FBTyxFQUFFLE1BQWU7S0FDekI7SUFDRCxXQUFXLEVBQUU7UUFDWCxJQUFJLEVBQUUsUUFBa0M7UUFDeEMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxTQUFTLENBQUM7S0FDN0I7SUFDRCxXQUFXLEVBQUU7UUFDWCxJQUFJLEVBQUUsUUFBa0M7UUFDeEMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxTQUFTLENBQUM7S0FDN0I7SUFDRCxVQUFVLEVBQUU7UUFDVixJQUFJLEVBQUUsUUFBa0M7UUFDeEMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxTQUFTLENBQUM7S0FDN0I7SUFDRCxXQUFXLEVBQUU7UUFDWCxJQUFJLEVBQUUsUUFBa0M7UUFDeEMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxTQUFTLENBQUM7S0FDN0I7SUFDRCxTQUFTLEVBQUU7UUFDVCxJQUFJLEVBQUUsUUFBa0M7UUFDeEMsT0FBTyxFQUFFLFFBQVEsQ0FB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QUFNO1lBQ0wsT0FBTyxFQUFFLENBQUM7U0FDWDtJQUNILENBQUM7SUFFRCxPQUFPO1FBQ0wsbUJBQW1CO1FBQ25CLFlBQVk7UUFDWixVQUFVO0tBQ1gsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc05vbmUsIGlzU29tZSwgbm9uZSwgT3B0aW9uLCBzb21lIH0gZnJvbSAnZnAtdHMvbGliL09wdGlvbic7XG5pbXBvcnQgeyBFeHRyYWN0UHJvcFR5cGVzLCBzaGFsbG93UmVmIH0gZnJvbSAndnVlJztcbmltcG9ydCB7IGNvbnN0YW50LCBjb25zdFZvaWQsIEZ1bmN0aW9uTiB9IGZyb20gJ2ZwLXRzL2xpYi9mdW5jdGlvbic7XG5pbXBvcnQgeyBQcm9wVHlwZSB9IGZyb20gJ3Z1ZSc7XG5cbmltcG9ydCB7IEJUYWJsZVJvdywgQlRhYmxlUm93RGF0YSwgZXFCVGFibGVSb3cgfSBmcm9tICcuLi9zaGFyZWQnO1xuXG50eXBlIERyb3BFZmZlY3QgPSAnbm9uZScgfCAnY29weScgfCAnbGluaycgfCAnbW92ZSc7XG5cbnR5cGUgRHJhZ0hhbmRsZXIgPSBGdW5jdGlvbk48W0RyYWdFdmVudF0sIHZvaWQ+O1xuXG50eXBlIE9uRHJhZ0VmZmVjdCA9IEZ1bmN0aW9uTjxbQlRhYmxlUm93RGF0YSwgRHJhZ0V2ZW50LCBudW1iZXJdLCB2b2lkPjtcblxuZXhwb3J0IGNvbnN0IEJUYWJsZURyYWdnYWJsZVByb3BzRGVmaW5pdGlvbiA9IHtcbiAgaXNEcmFnZ2FibGU6IHtcbiAgICB0eXBlOiBCb29sZWFuLFxuICAgIGRlZmF1bHQ6IGZhbHNlXG4gIH0sXG4gIGRyb3BFZmZlY3Q6IHtcbiAgICB0eXBlOiBTdHJpbmcgYXMgUHJvcFR5cGU8RHJvcEVmZmVjdD4sXG4gICAgZGVmYXVsdDogJ21vdmUnIGFzIGNvbnN0XG4gIH0sXG4gIG9uRHJhZ3N0YXJ0OiB7XG4gICAgdHlwZTogRnVuY3Rpb24gYXMgUHJvcFR5cGU8T25EcmFnRWZmZWN0PixcbiAgICBkZWZhdWx0OiBjb25zdGFudChjb25zdFZvaWQpXG4gIH0sXG4gIG9uRHJhZ2VudGVyOiB7XG4gICAgdHlwZTogRnVuY3Rpb24gYXMgUHJvcFR5cGU8T25EcmFnRWZmZWN0PixcbiAgICBkZWZhdWx0OiBjb25zdGFudChjb25zdFZvaWQpXG4gIH0sXG4gIG9uRHJhZ292ZXI6IHtcbiAgICB0eXBlOiBGdW5jdGlvbiBhcyBQcm9wVHlwZTxPbkRyYWdFZmZlY3Q+LFxuICAgIGRlZmF1bHQ6IGNvbnN0YW50KGNvbnN0Vm9pZClcbiAgfSxcbiAgb25EcmFnbGVhdmU6IHtcbiAgICB0eXBlOiBGdW5jdGlvbiBhcyBQcm9wVHlwZTxPbkRyYWdFZmZlY3Q+LFxuICAgIGRlZmF1bHQ6IGNvbnN0YW50KGNvbnN0Vm9pZClcbiAgfSxcbiAgb25EcmFnZW5kOiB7XG4gICAgdHlwZTogRnVuY3Rpb24gYXMgUHJvcFR5cGU8T25EcmFnRWZmZWN0PixcbiAgICBkZWZhdWx0OiBjb25zdGFudChjb25zdFZvaWQpXG4gIH0sXG4gIG9uRHJvcDoge1xuICAgIHR5cGU6IEZ1bmN0aW9uIGFzIFByb3BUeXBlPE9uRHJhZ0VmZmVjdD4sXG4gICAgZGVmYXVsdDogY29uc3RhbnQoY29uc3RWb2lkKVxuICB9XG59O1xuXG5leHBvcnQgaW50ZXJmYWNlIEJUYWJsZURyYWdnYWJsZVByb3BzIGV4dGVuZHMgRXh0cmFjdFByb3BUeXBlczx0eXBlb2YgQlRhYmxlRHJhZ2dhYmxlUHJvcHNEZWZpbml0aW9uPiB7fVxuXG5leHBvcnQgZnVuY3Rpb24gdXNlRHJhZ2dhYmxlVGFibGUocHJvcHM6IEJUYWJsZURyYWdnYWJsZVByb3BzKSB7XG4gIGNvbnN0IGRyYWdJc0FjdGl2ZSA9IHNoYWxsb3dSZWYoZmFsc2UpO1xuICBjb25zdCBkcm9wVGFyZ2V0ID0gc2hhbGxvd1JlZihub25lIGFzIE9wdGlvbjxCVGFibGVSb3c+KTtcblxuICBmdW5jdGlvbiBnZXRPbkRyYWdTdGFydExpc3RlbmVyKHJvdzogQlRhYmxlUm93LCBpbmRleDogbnVtYmVyKTogRHJhZ0hhbmRsZXIge1xuICAgIHJldHVybiAoZTogRHJhZ0V2ZW50KSA9PiB7XG4gICAgICBkcmFnSXNBY3RpdmUudmFsdWUgPSB0cnVlO1xuICAgICAgaWYgKGUuZGF0YVRyYW5zZmVyKSB7XG4gICAgICAgIGUuZGF0YVRyYW5zZmVyLnNldERhdGEoJ3RleHQvcGxhaW4nLCBTdHJpbmcoaW5kZXgpKTtcbiAgICAgICAgZS5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9IHByb3BzLmRyb3BFZmZlY3Q7XG4gICAgICB9XG4gICAgICBkcm9wVGFyZ2V0LnZhbHVlID0gc29tZShyb3cpO1xuICAgICAgcHJvcHMub25EcmFnc3RhcnQocm93LCBlLCBpbmRleCk7XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldE9uRHJvcExpc3RlbmVyKHJvdzogQlRhYmxlUm93LCBpbmRleDogbnVtYmVyKTogRHJhZ0hhbmRsZXIge1xuICAgIHJldHVybiAoZTogRHJhZ0V2ZW50KSA9PiB7XG4gICAgICBpZiAocm93LmlzRHJvcHBhYmxlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcHJvcHMub25Ecm9wKHJvdywgZSwgaW5kZXgpO1xuICAgICAgfVxuICAgICAgZHJhZ0lzQWN0aXZlLnZhbHVlID0gZmFsc2U7XG4gICAgfTtcbiAgfVxuICBmdW5jdGlvbiBnZXRPbkRyYWdFbnRlckxpc3RlbmVyKHJvdzogQlRhYmxlUm93LCBpbmRleDogbnVtYmVyKTogRHJhZ0hhbmRsZXIge1xuICAgIHJldHVybiAoZTogRHJhZ0V2ZW50KSA9PiB7XG4gICAgICBpZiAocm93LmlzRHJvcHBhYmxlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZHJvcFRhcmdldC52YWx1ZSA9IHNvbWUocm93KTtcbiAgICAgICAgcHJvcHMub25EcmFnZW50ZXIocm93LCBlLCBpbmRleCk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuICBmdW5jdGlvbiBnZXRPbkRyYWdPdmVyTGlzdGVuZXIocm93OiBCVGFibGVSb3csIGluZGV4OiBudW1iZXIpOiBEcmFnSGFuZGxlciB7XG4gICAgcmV0dXJuIChlOiBEcmFnRXZlbnQpID0+IHtcbiAgICAgIGlmIChyb3cuaXNEcm9wcGFibGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zdCB0YXJnZXQgPSBkcm9wVGFyZ2V0LnZhbHVlO1xuICAgICAgICBpZiAoaXNOb25lKHRhcmdldCkgfHwgKGlzU29tZSh0YXJnZXQpICYmICFlcUJUYWJsZVJvdy5lcXVhbHModGFyZ2V0LnZhbHVlLCByb3cpKSkge1xuICAgICAgICAgIGRyb3BUYXJnZXQudmFsdWUgPSBzb21lKHJvdyk7XG4gICAgICAgIH1cbiAgICAgICAgcHJvcHMub25EcmFnb3Zlcihyb3csIGUsIGluZGV4KTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0T25EcmFnTGVhdmVMaXN0ZW5lcihyb3c6IEJUYWJsZVJvdywgaW5kZXg6IG51bWJlcik6IERyYWdIYW5kbGVyIHtcbiAgICByZXR1cm4gKGU6IERyYWdFdmVudCkgPT4ge1xuICAgICAgaWYgKHJvdy5pc0Ryb3BwYWJsZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNvbnN0IHRhcmdldCA9IGRyb3BUYXJnZXQudmFsdWU7XG4gICAgICAgIGlmIChpc1NvbWUodGFyZ2V0KSAmJiBlcUJUYWJsZVJvdy5lcXVhbHModGFyZ2V0LnZhbHVlLCByb3cpKSB7XG4gICAgICAgICAgZHJvcFRhcmdldC52YWx1ZSA9IG5vbmU7XG4gICAgICAgIH1cbiAgICAgICAgcHJvcHMub25EcmFnbGVhdmUocm93LCBlLCBpbmRleCk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldE9uRHJhZ0VuZExpc3RlbmVyKHJvdzogQlRhYmxlUm93LCBpbmRleDogbnVtYmVyKTogRHJhZ0hhbmRsZXIge1xuICAgIHJldHVybiBlID0+IHtcbiAgICAgIHByb3BzLm9uRHJhZ2VuZChyb3csIGUsIGluZGV4KTtcbiAgICAgIGlmIChpc1NvbWUoZHJvcFRhcmdldC52YWx1ZSkpIHtcbiAgICAgICAgZHJvcFRhcmdldC52YWx1ZSA9IG5vbmU7XG4gICAgICB9XG4gICAgICBkcmFnSXNBY3RpdmUudmFsdWUgPSBmYWxzZTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0Um93RHJhZ0xpc3RlbmVycyhyb3c6IEJUYWJsZVJvdywgaW5kZXg6IG51bWJlcik6IHsgW2tleTogc3RyaW5nXTogRHJhZ0hhbmRsZXIgfSB7XG4gICAgaWYgKHJvdy5pc0RyYWdnYWJsZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb25EcmFnc3RhcnQ6IGdldE9uRHJhZ1N0YXJ0TGlzdGVuZXIocm93LCBpbmRleCksXG4gICAgICAgIG9uRHJvcDogZ2V0T25Ecm9wTGlzdGVuZXIocm93LCBpbmRleCksXG4gICAgICAgIG9uRHJhZ2VudGVyOiBnZXRPbkRyYWdFbnRlckxpc3RlbmVyKHJvdywgaW5kZXgpLFxuICAgICAgICBvbkRyYWdsZWF2ZTogZ2V0T25EcmFnTGVhdmVMaXN0ZW5lcihyb3csIGluZGV4KSxcbiAgICAgICAgb25EcmFnb3ZlcjogZ2V0T25EcmFnT3Zlckxpc3RlbmVyKHJvdywgaW5kZXgpLFxuICAgICAgICBvbkRyYWdlbmQ6IGdldE9uRHJhZ0VuZExpc3RlbmVyKHJvdywgaW5kZXgpXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRSb3dEcmFnTGlzdGVuZXJzLFxuICAgIGRyYWdJc0FjdGl2ZSxcbiAgICBkcm9wVGFyZ2V0XG4gIH07XG59XG5cbmV4cG9ydCB0eXBlIFVzZURyYWdnYWJsZVRhYmxlID0gUmV0dXJuVHlwZTx0eXBlb2YgdXNlRHJhZ2dhYmxlVGFibGU+O1xuIl19
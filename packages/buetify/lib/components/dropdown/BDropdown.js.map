{"version":3,"sources":["../../../src/components/dropdown/BDropdown.ts"],"names":[],"mappings":"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","sourcesContent":["import './dropdown.sass';\nimport { Predicate } from 'fp-ts/lib/function';\nimport { IO } from 'fp-ts/lib/IO';\nimport { useThemePropsDefinition, useTheme } from '../../composables/theme';\nimport { getUseTogglePropsDefinition, Toggle, useToggle } from '../../composables/toggle';\nimport { FadeTransitionPropsDefinition, useTransition } from '../../composables/transition';\nimport { useWindowSize } from '../../composables/windowSize';\nimport { TransitionClasses } from '../../types/Transition';\nimport {\n  ExtractPropTypes,\n  PropType,\n  VNode,\n  defineComponent,\n  shallowRef,\n  computed,\n  Ref,\n  h,\n  withDirectives,\n  vShow,\n  Slots,\n  Transition\n} from 'vue';\nimport ClickOutside from '../../directives/clickOutside';\nimport { isString } from '../../utils/helpers';\nimport { Classes } from '../../utils/mergeClasses';\nimport { DropdownThemeMap } from './theme';\n\nexport type DropdownPosition = 'is-top-right' | 'is-top-left' | 'is-bottom-left';\n\nexport const BDropdownPropsDefinition = {\n  ...useThemePropsDefinition(DropdownThemeMap),\n  ...getUseTogglePropsDefinition('isExpanded'),\n  ...FadeTransitionPropsDefinition,\n  id: String as PropType<string>,\n  isDisabled: {\n    type: Boolean as PropType<boolean>,\n    default: false\n  },\n  isHoverable: {\n    type: Boolean as PropType<boolean>,\n    default: false\n  },\n  isInline: {\n    type: Boolean as PropType<boolean>,\n    default: false\n  },\n  position: {\n    type: String as PropType<DropdownPosition>,\n    validator: (value: unknown) => {\n      return isString(value) && ['is-top-right', 'is-top-left', 'is-bottom-left'].includes(value);\n    }\n  },\n  isMobileModal: {\n    type: Boolean as PropType<boolean>,\n    default: true\n  },\n  menuTag: {\n    type: String as PropType<string>,\n    default: 'ul'\n  }\n};\n\nexport type BDropdownProps = ExtractPropTypes<typeof BDropdownPropsDefinition>;\n\nlet id = 0;\n\nfunction generateTrigger(toggle: Toggle, id: string, slots: Slots) {\n  return h(\n    'div',\n    {\n      ref: 'trigger',\n      class: 'dropdown-trigger',\n      role: 'button',\n      'aria-owns': id,\n      'aria-haspopup': 'listbox',\n      'aria-expanded': `${toggle.isOn.value}`,\n      onClick: toggle.toggle\n    },\n    slots.trigger && slots.trigger(toggle)\n  );\n}\n\nfunction generateTransition(transition: TransitionClasses, children: IO<VNode | undefined>) {\n  return h(Transition, transition, children);\n}\n\nfunction useCloseConditional(toggle: Toggle, isInWhiteList: Predicate<HTMLElement>): Predicate<Event> {\n  return (e: Event) => {\n    const target = e.target as HTMLElement;\n    return toggle.isOn.value && isInWhiteList(target);\n  };\n}\n\nfunction generateDropdownContent(\n  menuTag: string,\n  toggle: Toggle,\n  computedId: string,\n  themeClasses: string[],\n  slots: Slots\n): VNode {\n  return h(\n    menuTag,\n    {\n      class: ['dropdown-content', ...themeClasses],\n      role: 'menu',\n      id: computedId,\n      'aria-hidden': toggle.isOff.value\n    },\n    slots.default && slots.default(toggle)\n  );\n}\n\nfunction generateDropdownMenu(\n  menuTag: string,\n  toggle: Toggle,\n  computedId: string,\n  themeClasses: string[],\n  transition: TransitionClasses,\n  slots: Slots,\n  useTransition = true\n) {\n  const menu = () =>\n    withDirectives(\n      h(\n        'div',\n        {\n          class: 'dropdown-menu'\n        },\n        [generateDropdownContent(menuTag, toggle, computedId, themeClasses, slots)]\n      ),\n      [[vShow, toggle.isOn.value]]\n    );\n  return useTransition ? generateTransition(transition, menu) : menu();\n}\n\nfunction generateMobileBackground(\n  menuTag: string,\n  toggle: Toggle,\n  computedId: string,\n  themeClasses: string[],\n  transition: TransitionClasses,\n  slots: Slots\n): VNode {\n  return generateTransition(transition, () =>\n    withDirectives(\n      h(\n        'div',\n        {\n          class: 'background',\n          'aria-hidden': toggle.isOff.value,\n          onClick: toggle.setOff\n        },\n        [generateDropdownMenu(menuTag, toggle, computedId, themeClasses, transition, slots, false)]\n      ),\n      [[vShow, toggle.isOn.value]]\n    )\n  );\n}\n\nfunction generateChildren(\n  menuTag: string,\n  isInline: boolean,\n  toggle: Toggle,\n  computedId: string,\n  transition: TransitionClasses,\n  themeClasses: string[],\n  shouldDisplayMobileBackground: boolean,\n  slots: Slots\n) {\n  const children: VNode[] = [];\n  if (!isInline) {\n    children.push(generateTrigger(toggle, computedId, slots));\n  }\n  if (shouldDisplayMobileBackground) {\n    children.push(generateMobileBackground(menuTag, toggle, computedId, themeClasses, transition, slots));\n  } else {\n    const menu = generateDropdownMenu(menuTag, toggle, computedId, themeClasses, transition, slots);\n    if (menu) {\n      children.push(menu);\n    }\n  }\n  return children;\n}\n\nexport default defineComponent({\n  name: 'b-dropdown',\n  props: BDropdownPropsDefinition,\n  setup(props) {\n    const windowSize = useWindowSize();\n    const toggle = useToggle(props, 'isExpanded');\n    const { themeClasses } = useTheme(props);\n    const transition = useTransition(props);\n    const root = shallowRef((null as unknown) as HTMLElement);\n    const trigger = shallowRef((null as unknown) as HTMLElement);\n    const dropdownMenu = shallowRef((null as unknown) as HTMLElement);\n    const computedId = computed(() => `dropdown-menu-${props.id ?? id++}`);\n    const rootClasses: Ref<Classes[]> = computed(() => [\n      props.position,\n      {\n        'is-disabled': props.isDisabled,\n        'is-hoverable': props.isHoverable,\n        'is-inline': props.isInline,\n        'is-active': toggle.isOn.value || props.isInline,\n        'is-mobile-modal': props.isMobileModal\n      }\n    ]);\n    const displayMenu = computed(\n      () => (!props.isDisabled && (toggle.isOn.value || props.isHoverable)) || props.isInline\n    );\n    const isMobileModal = computed(() => props.isMobileModal && !props.isInline && !props.isHoverable);\n    const displayMobileBackground = computed(() => isMobileModal.value && windowSize.value.isTouch);\n\n    function getDependentElements(): HTMLElement[] {\n      return Array.from(dropdownMenu.value?.querySelectorAll('*') ?? []);\n    }\n\n    function isInDropdown(el: HTMLElement): boolean {\n      return dropdownMenu.value !== undefined && dropdownMenu.value.contains(el);\n    }\n\n    function isInTrigger(el: HTMLElement): boolean {\n      return trigger.value !== undefined && trigger.value.contains(el);\n    }\n\n    function isInWhiteList(el: HTMLElement) {\n      if (el === root.value) return true;\n      if (el === dropdownMenu.value) return true;\n      if (el === trigger.value) return true;\n      return isInDropdown(el) || isInTrigger(el);\n    }\n\n    const menuToggle = {\n      ...toggle,\n      isOn: displayMenu,\n      isOff: computed(() => !displayMenu.value)\n    };\n\n    const closeConditional = useCloseConditional(menuToggle, isInWhiteList);\n\n    const clickOutsideArgs = {\n      include: getDependentElements,\n      closeConditional\n    };\n    return {\n      root,\n      rootClasses,\n      clickOutsideArgs,\n      toggle,\n      transition,\n      themeClasses,\n      dropdownMenu,\n      displayMobileBackground,\n      menuToggle,\n      trigger,\n      computedId\n    };\n  },\n  render() {\n    return withDirectives(\n      h(\n        'div',\n        { ref: 'root', class: ['dropdown', ...this.rootClasses] },\n        generateChildren(\n          this.menuTag,\n          this.isInline,\n          this.menuToggle,\n          this.computedId,\n          this.transition,\n          this.themeClasses,\n          this.displayMobileBackground,\n          this.$slots\n        )\n      ),\n      [[ClickOutside, this.toggle.setOff, (this.clickOutsideArgs as unknown) as string]]\n    );\n  }\n});\n"],"sourceRoot":"","file":"BDropdown.js"}
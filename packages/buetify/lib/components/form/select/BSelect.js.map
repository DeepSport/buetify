{"version":3,"sources":["../../../../src/components/form/select/BSelect.ts"],"names":[],"mappings":"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","sourcesContent":["import '../sass/form.sass';\nimport './select.sass';\nimport { Eq } from 'fp-ts/lib/Eq';\nimport { getUseInputPropsDefinition, Input, useInput, UseInputProps } from '../../../composables/input/useInput';\nimport { EqProps, getEqPropsDefinition } from '../../../composables/shared';\nimport { DefaultThemePropsDefinition, useTheme } from '../../../composables/theme';\nimport { Extractor, extractProp, isBoolean } from '../../../utils/helpers';\nimport { PropType, VNode, defineComponent, h, shallowRef, SetupContext, Ref, vModelSelect, withDirectives } from 'vue';\nimport { Classes } from '../../../utils/mergeClasses';\n\nexport interface SelectItem<T> {\n  value: T;\n  text: string;\n  isDisabled: boolean;\n  isSelected: boolean;\n}\n\nexport function getBSelectPropsDefinition<T>(eq?: Eq<T>) {\n  return {\n    ...getEqPropsDefinition<T>(eq),\n    ...getUseInputPropsDefinition<T>(),\n    ...DefaultThemePropsDefinition,\n    items: {\n      type: Array as PropType<T[]>,\n      required: true as const\n    },\n    isMultiple: {\n      type: Boolean as PropType<boolean>,\n      default: false\n    },\n    itemKey: {\n      type: [String, Function] as PropType<Extractor<T>>\n    },\n    itemText: {\n      type: [String, Function] as PropType<Extractor<T>>,\n      default: 'text'\n    },\n    itemValue: {\n      type: [String, Function] as PropType<Extractor<T>>,\n      default: 'value'\n    },\n    itemDisabled: {\n      type: [String, Function] as PropType<Extractor<T>>,\n      default: 'isDisabled'\n    },\n    displayCount: {\n      type: [String, Number]\n    }\n  };\n}\n\nexport type BSelectProps<T> = EqProps<T> &\n  UseInputProps<T> & {\n    items: T[];\n    isMultiple: boolean;\n    itemKey?: Extractor<T>;\n    itemText: Extractor<T>;\n    itemValue: Extractor<T>;\n    itemDisabled: Extractor<T>;\n    displayCount?: string | number;\n  };\n\nfunction getControlClasses(isExpanded: boolean, hasIcon: boolean) {\n  return {\n    'is-expanded': isExpanded,\n    'has-icons-left': hasIcon\n  };\n}\n\nfunction isMultiple<T>(props: BSelectProps<T>, input: Input) {\n  return props.isMultiple || (props.isMultiple === undefined && Array.isArray(input.modelValue.value));\n}\n\nfunction isEmpty(val: unknown) {\n  return val === null || val === undefined || (Array.isArray(val) && val.length === 0);\n}\n\nfunction getSelectClasses<T>(props: BSelectProps<T>, input: Input): Classes[] {\n  return [\n    input.size.value,\n    input.messageVariant.value,\n    {\n      'is-fullwidth': input.isFullwidth.value,\n      'is-loading': props.isLoading,\n      'is-multiple': isMultiple(props, input),\n      'is-rounded': props.isRounded,\n      'is-empty': isEmpty(input.modelValue.value)\n    }\n  ];\n}\n\nfunction generatePlaceholder<T>(props: BSelectProps<T>, context: SetupContext): VNode {\n  return h(\n    'option',\n    {\n      value: '',\n      disabled: true,\n      selected: true\n    },\n    context.slots.placeholder ? context.slots.placeholder() : props.placeholder\n  );\n}\n\nfunction getIsSelected<T>(props: BSelectProps<T>, input: Input) {\n  return (val: T) => {\n    const equals = props.eq.equals;\n    const value = input.modelValue.value;\n    if (value === null || value === undefined) {\n      return false;\n    } else if (isMultiple(props, input)) {\n      return Array.isArray(value) ? value.some(v => equals(v, val)) : false;\n    } else {\n      return equals(val, value as T);\n    }\n  };\n}\nfunction generateOptions<T>(props: BSelectProps<T>, context: SetupContext, input: Input) {\n  const isSelected = getIsSelected(props, input);\n  return props.items.map((item, index) => {\n    const isDisabled = extractProp(props.itemDisabled, item);\n    return context.slots.option\n      ? context.slots.option({ item, index })\n      : h(\n          'option',\n          {\n            key: props.itemKey ? ((extractProp(props.itemKey, item) as unknown) as string) : String(index),\n            value: extractProp(props.itemValue, item),\n            disabled: isBoolean(isDisabled) ? isDisabled : !isDisabled,\n            selected: isSelected(item)\n          },\n          context.slots.default\n            ? context.slots.default({ item, index })\n            : ((extractProp(props.itemText, item) as unknown) as string)\n        );\n  });\n}\n\nfunction generateSelect<T>(\n  props: BSelectProps<T>,\n  context: SetupContext,\n  ref: Ref<HTMLElement>,\n  input: Input,\n  themeClasses: Classes\n): VNode {\n  const value = input.modelValue.value;\n  const usePlaceholder = isEmpty(value) && (!!props.placeholder || !!context.slots.placeholder);\n  return withDirectives(\n    h(\n      'select',\n      {\n        ...context.attrs,\n        ref,\n        required: props.isRequired,\n        disabled: props.isDisabled,\n        size: props.displayCount,\n        multiple: isMultiple(props, input),\n        class: themeClasses,\n        onBlur: input.onBlur,\n        onFocus: input.onFocus,\n        'onUpdate:modelValue': input.set\n      },\n      usePlaceholder\n        ? [generatePlaceholder(props, context), ...generateOptions(props, context, input)]\n        : generateOptions(props, context, input)\n    ),\n    [[vModelSelect, value]]\n  );\n}\n\nexport function defineSelect<T>(eq?: Eq<T>) {\n  return defineComponent({\n    name: 'b-select',\n    props: getBSelectPropsDefinition<T>(eq),\n    setup(props, context) {\n      const selectRef = shallowRef((null as unknown) as HTMLElement);\n      const input = useInput(props as UseInputProps<T>, selectRef);\n      const { themeClasses } = useTheme(props);\n      return () => {\n        const nodes = [\n          h(\n            'span',\n            {\n              class: ['select', ...getSelectClasses(props as BSelectProps<T>, input as Input)]\n            },\n            [generateSelect(props as BSelectProps<T>, context, selectRef, input as Input, themeClasses.value)]\n          )\n        ];\n\n        if (input.icon && input.icon.value) {\n          nodes.push(\n            h(input.icon.value as any, {\n              class: 'is-left',\n              size: input.size.value\n            })\n          );\n        }\n\n        return h('div', { class: ['control', getControlClasses(input.isExpanded.value, !!input.icon)] }, nodes);\n      };\n    }\n  });\n}\n\n// eslint-disable-next-line\nexport const BSelect = defineSelect<any>();\n"],"sourceRoot":"","file":"BSelect.js"}
{"version":3,"sources":["../../../src/components/loading/BLoading.ts"],"names":[],"mappings":"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","sourcesContent":["import './loading.sass';\nimport { IO } from 'fp-ts/lib/IO';\nimport { usePopupController, UsePopupControllerPropsDefinition } from '../../composables/popupController';\nimport { isEscEvent } from '../../utils/eventHelpers';\nimport {\n  VNode,\n  h,\n  defineComponent,\n  ExtractPropTypes,\n  shallowRef,\n  Transition,\n  onUnmounted,\n  Slots,\n  Ref,\n  toRef,\n  toRefs,\n  reactive,\n  computed,\n  watchEffect\n} from 'vue';\nimport { constEmptyArray } from '../../utils/helpers';\n\nexport const BLoadingPropsDefinition = {\n  ...UsePopupControllerPropsDefinition,\n  isFullscreen: {\n    type: Boolean,\n    default: false\n  },\n  canCancel: {\n    type: Boolean,\n    default: false\n  }\n};\n\nexport type BLoadingProps = ExtractPropTypes<typeof BLoadingPropsDefinition>;\n\nfunction getGenerateModal(onClick: IO<void>, slots: Slots, isFullscreen: Ref<boolean>) {\n  return () => [\n    h('div', { class: ['b-loading-overlay is-active', { 'is-fullscreen': isFullscreen.value }] }, [\n      h('div', {\n        class: 'loading-background',\n        onClick\n      }),\n      slots.default ? slots.default({ close: onClick }) : h('div', { class: 'loading-icon' })\n    ])\n  ];\n}\n\nexport default defineComponent({\n  name: 'b-loading',\n  props: BLoadingPropsDefinition,\n  setup(props, { slots }) {\n    const isFullscreen = toRef(props, 'isFullscreen');\n    const isActive = computed(() => props.isFullscreen && props.isActive);\n    const render = shallowRef(constEmptyArray as IO<VNode[]>);\n    const popup = usePopupController(\n      reactive({\n        ...toRefs(props),\n        isActive\n      }),\n      render\n    );\n\n    function onClick() {\n      if (props.canCancel && props.isFullscreen ? popup.isOpen.value : props.isActive) {\n        popup.close();\n      }\n    }\n\n    render.value = getGenerateModal(onClick, slots, isFullscreen);\n\n    function onKeyup(e: KeyboardEvent) {\n      if (isEscEvent(e)) {\n        onClick();\n      }\n    }\n\n    watchEffect(() => {\n      if (window === undefined) return;\n      if (popup.isOpen.value && props.canCancel) {\n        document.addEventListener('keyup', onKeyup);\n      } else {\n        document.removeEventListener('keyup', onKeyup);\n      }\n    });\n\n    onUnmounted(() => {\n      window && window.removeEventListener('keyup', onKeyup);\n    });\n\n    return () => {\n      if (slots.trigger && props.isFullscreen) {\n        return slots.trigger(popup);\n      } else if (props.isFullscreen) {\n        return undefined;\n      } else {\n        return h(Transition as any, { name: props.transition }, () => (props.isActive ? render.value() : undefined));\n      }\n    };\n  }\n});\n"],"sourceRoot":"","file":"BLoading.js"}